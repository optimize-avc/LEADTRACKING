
> leadtracking@0.1.0 lint
> eslint . --ext .ts,.tsx --format json

[{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\components\\Badge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\components\\GlassCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\integration\\ui-interactions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\lib\\twilio-config.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\lib\\twilio-utils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\mock-data\\resources.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\services\\firebase-services.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\setup\\react-testing.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\__tests__\\types\\types.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\e2e\\app.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\scripts\\list-models-full.js","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GoogleGenerativeAI' is assigned a value but never used.","line":1,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":27},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":32,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":64},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":1,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { GoogleGenerativeAI } = require(\"@google/generative-ai\");\r\nrequire('dotenv').config({ path: '.env.local' });\r\n\r\nasync function listAllModels() {\r\n    try {\r\n        const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;\r\n        console.log(\"Using API Key Prefix:\", apiKey.substring(0, 4));\r\n\r\n        // Direct fetch to v1beta to ensure we see everything\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);\r\n        const data = await response.json();\r\n\r\n        if (data.models) {\r\n            console.log(\"--- TEXT MODELS ONLY ---\");\r\n            const textModels = data.models\r\n                .filter(m => (m.name.includes(\"gemini\") || m.name.includes(\"gemma\")) && m.supportedGenerationMethods?.includes(\"generateContent\"))\r\n                .map(m => m.name);\r\n\r\n            console.log(JSON.stringify(textModels, null, 2));\r\n        } else {\r\n            console.log(\"Error listing models:\", data);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Script failed:\", error);\r\n    }\r\n}\r\n\r\nlistAllModels();\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\scripts\\poll-reply.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":27,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":50},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":70,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":99}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { initializeApp } = require('firebase/app');\r\nconst { getFirestore, collection, getDocs, query, where, orderBy } = require('firebase/firestore');\r\n\r\n// Config\r\nconst firebaseConfig = {\r\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY || \"AIza...\",\r\n    authDomain: \"antigrav-tracking-final.firebaseapp.com\",\r\n    projectId: \"antigrav-tracking-final\",\r\n    storageBucket: \"antigrav-tracking-final.firebasestorage.app\",\r\n    messagingSenderId: \"813307578320\",\r\n    appId: \"1:813307578320:web:fb167e5ac138fe9ac91bd5\"\r\n};\r\n\r\nconst USER_ID = '4Q4AmzaE3nMo1iSBCDzBnF0vCE03';\r\n\r\nasync function poll() {\r\n    console.log('Polling for inbound messages...');\r\n    const app = initializeApp(firebaseConfig);\r\n    const db = getFirestore(app);\r\n\r\n    const messagesRef = collection(db, 'users', USER_ID, 'messages');\r\n    // Check for recent inbound messages\r\n    const q = query(messagesRef, where('direction', '==', 'inbound'), orderBy('createdAt', 'desc'));\r\n\r\n    let checks = 0;\r\n    const interval = setInterval(async () => {\r\n        process.stdout.write('.');\r\n        checks++;\r\n        if (checks > 60) { // 2 minutes\r\n            console.log('\\nTimeout waiting for reply.');\r\n            clearInterval(interval);\r\n            process.exit(1);\r\n        }\r\n\r\n        try {\r\n            const snapshot = await getDocs(q);\r\n            if (!snapshot.empty) {\r\n                // Find the latest one\r\n                const latest = snapshot.docs[0].data();\r\n                console.log('\\nResponse Received!', latest.body);\r\n                clearInterval(interval);\r\n                process.exit(0);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }, 2000);\r\n}\r\n\r\npoll();\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\scripts\\test-gemini.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":32,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":64},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":1,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { GoogleGenerativeAI } = require(\"@google/generative-ai\");\r\nrequire('dotenv').config({ path: '.env.local' });\r\n\r\nasync function test() {\r\n    console.log(\"Testing Gemini API...\");\r\n    const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;\r\n    if (!apiKey) {\r\n        console.error(\"No API Key found in .env.local\");\r\n        return;\r\n    }\r\n    console.log(\"API Key Prefix:\", apiKey.substring(0, 4));\r\n\r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n\r\n    // List available models\r\n    try {\r\n        console.log(\"\\n--- Listing Models ---\");\r\n        // Note: SDK doesn't always expose listModels on the client instance easily, \r\n        // usually it's a separate API call or manager.\r\n        // But let's try a direct fetch to the API to see what we have access to.\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);\r\n        const data = await response.json();\r\n        if (data.models) {\r\n            console.log(\"AVAILABLE MODELS (Exact Names):\");\r\n            console.log(JSON.stringify(data.models.map(m => m.name), null, 2));\r\n        } else {\r\n            console.log(\"ListModels response:\", data);\r\n        }\r\n    } catch (e) {\r\n        console.error(\"ListModels failed\", e.message);\r\n    }\r\n\r\n    // Try experimental models commonly found on new keys\r\n    const moreModels = [\"gemini-2.0-flash-exp\", \"gemini-experimental\", \"gemini-1.5-pro-latest\", \"gemma-2-9b-it\"];\r\n    for (const modelName of moreModels) {\r\n        console.log(`\\n--- Testing ${modelName} ---`);\r\n        try {\r\n            const model = genAI.getGenerativeModel({ model: modelName });\r\n            const result = await model.generateContent(\"Hello?\");\r\n            const response = await result.response;\r\n            console.log(`SUCCESS [${modelName}]:`, response.text());\r\n        } catch (error) {\r\n            console.error(`FAILED [${modelName}]:`, error.message);\r\n        }\r\n    }\r\n}\r\n\r\ntest();\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\scripts\\verify-client.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":1,"column":27,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":1,"endColumn":50},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":2,"column":82,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":2,"endColumn":111},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TWILIO_ACCOUNT_SID' is assigned a value but never used.","line":16,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TWILIO_AUTH_TOKEN' is assigned a value but never used.","line":17,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TWILIO_PHONE_NUMBER' is assigned a value but never used.","line":18,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":26}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { initializeApp } = require('firebase/app');\r\nconst { getFirestore, collection, addDoc, doc, setDoc, getDocs, query, where } = require('firebase/firestore');\r\nconst Twilio = require('twilio');\r\n\r\n// Config\r\nconst firebaseConfig = {\r\n    apiKey: \"AIzaSyDK6-V94VNzc5pTCgXzKvY9UA00Z0oCSRc\",\r\n    authDomain: \"antigrav-tracking-final.firebaseapp.com\",\r\n    projectId: \"antigrav-tracking-final\",\r\n    storageBucket: \"antigrav-tracking-final.firebasestorage.app\",\r\n    messagingSenderId: \"813307578320\",\r\n    appId: \"1:813307578320:web:fb167e5ac138fe9ac91bd5\"\r\n};\r\n\r\n// Secrets (User must set these in env or replace manually for testing)\r\nconst TWILIO_ACCOUNT_SID = process.env.TWILIO_ACCOUNT_SID || 'AC_PLACEHOLDER';\r\nconst TWILIO_AUTH_TOKEN = process.env.TWILIO_AUTH_TOKEN || 'AUTH_TOKEN_PLACEHOLDER';\r\nconst TWILIO_PHONE_NUMBER = process.env.TWILIO_PHONE_NUMBER || '+15555555555';\r\n\r\nconst USER_ID = '4Q4AmzaE3nMo1iSBCDzBnF0vCE03';\r\nconst LEAD_PHONE = '+17087013737';\r\nconst LEAD_CONTACT_NAME = 'Verification Test User';\r\n\r\nasync function run() {\r\n    console.log('Initializing Firebase Client...');\r\n    const app = initializeApp(firebaseConfig);\r\n    const db = getFirestore(app);\r\n    const client = Twilio(TWILIO_CONFIG.accountSid, TWILIO_CONFIG.authToken);\r\n\r\n    try {\r\n        // 1. Check/Create Lead\r\n        console.log('Checking for lead...');\r\n        const leadsRef = collection(db, 'users', USER_ID, 'leads');\r\n        const q = query(leadsRef, where('phone', '==', LEAD_PHONE));\r\n        const snapshot = await getDocs(q);\r\n\r\n        let leadId;\r\n        if (snapshot.empty) {\r\n            console.log('Creating new lead...');\r\n            const newLead = await addDoc(leadsRef, {\r\n                contactName: LEAD_CONTACT_NAME,\r\n                phone: LEAD_PHONE,\r\n                status: 'New',\r\n                assignedTo: USER_ID,\r\n                createdAt: Date.now(),\r\n                updatedAt: Date.now()\r\n            });\r\n            leadId = newLead.id;\r\n            console.log('Created lead:', leadId);\r\n        } else {\r\n            leadId = snapshot.docs[0].id;\r\n            console.log('Found existing lead:', leadId);\r\n        }\r\n\r\n        // 2. Send SMS via Twilio\r\n        console.log('Sending SMS via Twilio...');\r\n        const message = await client.messages.create({\r\n            to: LEAD_PHONE,\r\n            from: TWILIO_CONFIG.phoneNumber,\r\n            body: 'Hello! This is a test from the Antigravity system. Please reply to this message.',\r\n            // We use the production webhook URL here so Twilio updates the status there\r\n            statusCallback: `https://antigrav-tracking-final.web.app/api/twilio/sms-webhook?userId=${USER_ID}&leadId=${leadId}`\r\n        });\r\n\r\n        console.log('SMS Sent! SID:', message.sid);\r\n\r\n        // 3. Log to Firestore (Outbound) so it shows in UI\r\n        console.log('Logging to Firestore...');\r\n        await setDoc(doc(db, 'users', USER_ID, 'messages', message.sid), {\r\n            messageSid: message.sid,\r\n            userId: USER_ID,\r\n            leadId: leadId,\r\n            toNumber: LEAD_PHONE,\r\n            fromNumber: TWILIO_CONFIG.phoneNumber,\r\n            body: message.body,\r\n            status: message.status,\r\n            direction: 'outbound',\r\n            sentAt: new Date().toISOString(),\r\n            createdAt: new Date(),\r\n            updatedAt: new Date()\r\n        });\r\n\r\n        console.log('Done! Message logged.');\r\n        process.exit(0);\r\n    } catch (error) {\r\n        console.error('Error:', error);\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\nrun();\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\sentry.client.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\sentry.edge.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\sentry.server.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\actions\\gmail.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'db' is defined but never used.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'doc' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getDoc' is defined but never used.","line":4,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setDoc' is defined but never used.","line":4,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateDoc' is defined but never used.","line":4,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'collection' is defined but never used.","line":4,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'query' is defined but never used.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'where' is defined but never used.","line":4,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getDocs' is defined but never used.","line":4,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10054,10057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10054,10057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { db } from '@/lib/firebase/config';\r\nimport { doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs } from 'firebase/firestore';\r\nimport { GmailMessage, GmailTokens, refreshAccessToken } from '@/lib/gmail/gmail-auth';\r\nimport { getAdminDb } from '@/lib/firebase/admin';\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS (Moved from gmail-service to avoid circular deps)\r\n// ============================================\r\n\r\nexport function parseEmailHeaders(headers: { name: string; value: string }[]): {\r\n    from: string;\r\n    to: string;\r\n    subject: string;\r\n    date: string;\r\n} {\r\n    const getHeader = (name: string) =>\r\n        headers.find(h => h.name.toLowerCase() === name.toLowerCase())?.value || '';\r\n\r\n    return {\r\n        from: getHeader('From'),\r\n        to: getHeader('To'),\r\n        subject: getHeader('Subject'),\r\n        date: getHeader('Date'),\r\n    };\r\n}\r\n\r\nexport function extractEmailAddress(headerValue: string): string {\r\n    const match = headerValue.match(/<(.+?)>/) || headerValue.match(/([^\\s<>]+@[^\\s<>]+)/);\r\n    return match ? match[1] : headerValue;\r\n}\r\n\r\nexport function decodeBase64(data: string): string {\r\n    try {\r\n        // Gmail uses URL-safe base64\r\n        const base64 = data.replace(/-/g, '+').replace(/_/g, '/');\r\n        return Buffer.from(base64, 'base64').toString('utf-8');\r\n    } catch {\r\n        return '';\r\n    }\r\n}\r\n\r\nexport function getEmailBody(message: GmailMessage): string {\r\n    // Try to get body from payload directly\r\n    if (message.payload.body?.data) {\r\n        return decodeBase64(message.payload.body.data);\r\n    }\r\n\r\n    // Try to get from parts (multipart email)\r\n    if (message.payload.parts) {\r\n        const textPart = message.payload.parts.find(p => p.mimeType === 'text/plain');\r\n        if (textPart?.body?.data) {\r\n            return decodeBase64(textPart.body.data);\r\n        }\r\n        const htmlPart = message.payload.parts.find(p => p.mimeType === 'text/html');\r\n        if (htmlPart?.body?.data) {\r\n            // Strip HTML tags for plain text\r\n            return decodeBase64(htmlPart.body.data).replace(/<[^>]*>/g, '');\r\n        }\r\n    }\r\n\r\n    return message.snippet || '';\r\n}\r\n\r\n// Re-export types needed by client components\r\nexport interface EmailRecord {\r\n    id: string;\r\n    threadId: string;\r\n    leadId: string;\r\n    direction: 'sent' | 'received';\r\n    from: string;\r\n    to: string;\r\n    subject: string;\r\n    snippet: string;\r\n    body: string;\r\n    timestamp: number;\r\n}\r\n\r\n// Helper: Get Valid Token (Server-Side Only)\r\n// We rely on 'firebase-admin' or 'firebase/firestore' depending on environment. \r\n// Since this is a Server Action, we can use the Admin SDK for better permission handling if setup, \r\n// but existing code used client SDK with strict rules. We'll stick to client SDK with server env vars for consistency, \r\n// OR switch to Admin SDK if client SDK auth state is tricky in Server Actions.\r\n// Given strict \"commercial grade\" request: We should use Admin SDK for data access if possible to bypass RLS issues on server,\r\n// BUT preserving the existing 'firebase/config' usage is safer for now unless we do a full rewrite.\r\n// HOWEVER, Server Actions run in a Node context where we can use process.env secrets.\r\n\r\n// Let's stick to the logic from gmail-service.ts but ensure it runs on server.\r\n\r\nasync function getValidAccessToken(userId: string): Promise<string | null> {\r\n    // Note: In a real Server Action, we might not have a signed-in firebase user in the global scope \r\n    // unless we pass the token. However, for getting the GMAIL token stored in DB, we can just query DB.\r\n\r\n    // Using Admin DB to ensure we can read the user's secrets securely without worrying about Client Auth state\r\n    const adminDb = getAdminDb();\r\n    const tokenDoc = await adminDb.collection('users').doc(userId).collection('integrations').doc('gmail').get();\r\n\r\n    if (!tokenDoc.exists) {\r\n        return null;\r\n    }\r\n\r\n    const tokens = tokenDoc.data() as GmailTokens;\r\n\r\n    // Check if token is expired (with 5 min buffer)\r\n    if (tokens.expiresAt < Date.now() + 300000) {\r\n        try {\r\n            console.log('Refreshing Gmail access token...');\r\n            const refreshed = await refreshAccessToken(tokens.refreshToken);\r\n\r\n            await adminDb.collection('users').doc(userId).collection('integrations').doc('gmail').update({\r\n                accessToken: refreshed.accessToken,\r\n                expiresAt: refreshed.expiresAt,\r\n            });\r\n            return refreshed.accessToken;\r\n        } catch (error) {\r\n            console.error('Failed to refresh token:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return tokens.accessToken;\r\n}\r\n\r\nasync function fetchEmails(accessToken: string, queryStr: string, maxResults: number = 50): Promise<GmailMessage[]> {\r\n    const params = new URLSearchParams({\r\n        q: queryStr,\r\n        maxResults: maxResults.toString(),\r\n    });\r\n\r\n    const response = await fetch(\r\n        `https://gmail.googleapis.com/gmail/v1/users/me/messages?${params}`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n\r\n    if (!response.ok) {\r\n        throw new Error('Failed to fetch messages from Gmail API');\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (!data.messages) return [];\r\n\r\n    // Fetch full message details for each\r\n    const messages = await Promise.all(\r\n        data.messages.slice(0, maxResults).map(async (msg: { id: string }) => {\r\n            const msgResponse = await fetch(\r\n                `https://gmail.googleapis.com/gmail/v1/users/me/messages/${msg.id}`,\r\n                { headers: { Authorization: `Bearer ${accessToken}` } }\r\n            );\r\n            return msgResponse.json();\r\n        })\r\n    );\r\n\r\n    return messages;\r\n}\r\n\r\nexport async function syncEmailsForLeadAction(userId: string, leadEmail: string, leadId: string): Promise<EmailRecord[]> {\r\n    try {\r\n        const accessToken = await getValidAccessToken(userId);\r\n        if (!accessToken) {\r\n            throw new Error('Gmail not connected');\r\n        }\r\n\r\n        const queryStr = `from:${leadEmail} OR to:${leadEmail}`;\r\n        const messages = await fetchEmails(accessToken, queryStr, 30);\r\n\r\n        const adminDb = getAdminDb();\r\n        const userDoc = await adminDb.collection('users').doc(userId).collection('integrations').doc('gmail').get();\r\n        const userEmail = userDoc.exists ? userDoc.data()?.email : '';\r\n\r\n        const emailRecords: EmailRecord[] = [];\r\n        const batch = adminDb.batch();\r\n\r\n        for (const message of messages) {\r\n            const headers = parseEmailHeaders(message.payload.headers);\r\n            const fromEmail = extractEmailAddress(headers.from);\r\n            const direction = fromEmail.toLowerCase() === userEmail.toLowerCase() ? 'sent' : 'received';\r\n\r\n            const record: EmailRecord = {\r\n                id: message.id,\r\n                threadId: message.threadId,\r\n                leadId,\r\n                direction,\r\n                from: headers.from,\r\n                to: headers.to,\r\n                subject: headers.subject,\r\n                snippet: message.snippet,\r\n                body: getEmailBody(message),\r\n                timestamp: parseInt(message.internalDate),\r\n            };\r\n\r\n            emailRecords.push(record);\r\n\r\n            const docRef = adminDb.collection('users').doc(userId).collection('emailMessages').doc(message.id);\r\n            batch.set(docRef, record, { merge: true });\r\n        }\r\n\r\n        await batch.commit();\r\n\r\n        // Sort most recent first\r\n        return emailRecords.sort((a, b) => b.timestamp - a.timestamp);\r\n    } catch (error) {\r\n        console.error('Sync Emails Error:', error);\r\n        throw new Error('Failed to sync emails');\r\n    }\r\n}\r\n\r\nexport async function sendEmailAction(userId: string, to: string, subject: string, body: string, leadId: string): Promise<{ success: boolean; id?: string; error?: string }> {\r\n    try {\r\n        const accessToken = await getValidAccessToken(userId);\r\n        if (!accessToken) {\r\n            return { success: false, error: 'Gmail not connected' };\r\n        }\r\n\r\n        // Create RFC 2822 formatted email\r\n        const email = [\r\n            `To: ${to}`,\r\n            `Subject: ${subject}`,\r\n            'Content-Type: text/plain; charset=utf-8',\r\n            '',\r\n            body\r\n        ].join('\\r\\n');\r\n\r\n        const encodedEmail = Buffer.from(email)\r\n            .toString('base64')\r\n            .replace(/\\+/g, '-')\r\n            .replace(/\\//g, '_')\r\n            .replace(/=+$/, '');\r\n\r\n        const response = await fetch(\r\n            'https://gmail.googleapis.com/gmail/v1/users/me/messages/send',\r\n            {\r\n                method: 'POST',\r\n                headers: {\r\n                    Authorization: `Bearer ${accessToken}`,\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({ raw: encodedEmail }),\r\n            }\r\n        );\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            throw new Error(`Gmail API Error: ${errorText}`);\r\n        }\r\n\r\n        const result = await response.json();\r\n\r\n        // Log to Firestore using Admin SDK\r\n        const adminDb = getAdminDb();\r\n        const userDoc = await adminDb.collection('users').doc(userId).collection('integrations').doc('gmail').get();\r\n        const userEmail = userDoc.exists ? userDoc.data()?.email : '';\r\n\r\n        const record = {\r\n            id: result.id,\r\n            threadId: result.threadId,\r\n            leadId,\r\n            direction: 'sent',\r\n            from: userEmail,\r\n            to,\r\n            subject,\r\n            snippet: body.substring(0, 200),\r\n            body,\r\n            timestamp: Date.now(),\r\n        };\r\n\r\n        await adminDb.collection('users').doc(userId).collection('emailMessages').doc(result.id).set(record);\r\n\r\n        return { success: true, id: result.id };\r\n    } catch (error: any) {\r\n        console.error('Send Email Error:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\activities\\ActivitiesClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\activities\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\activities\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\activities\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\analytics\\AnalyticsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used.","line":7,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PieChart' is defined but never used.","line":8,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShieldCheck' is defined but never used.","line":9,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":9,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cell' is defined but never used.","line":20,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pie' is defined but never used.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RePieChart' is defined but never used.","line":20,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COLORS' is assigned a value but never used.","line":33,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used.","line":38,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2048,2051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2048,2051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { Badge } from '@/components/ui/Badge';\r\nimport {\r\n    TrendingUp, TrendingDown, Target, Phone, Mail,\r\n    Calendar, Users, DollarSign, BarChart3, PieChart,\r\n    Sparkles, ShieldCheck, Zap\r\n} from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport { calculateRevenueForecast, ForecastResult } from '@/lib/utils/forecasting';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { LeadsService } from '@/lib/firebase/services';\r\nimport { formatCurrency } from '@/lib/utils/formatters';\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n    AreaChart, Area, XAxis, YAxis, CartesianGrid,\r\n    Tooltip, ResponsiveContainer, BarChart, Bar,\r\n    Cell, Pie, PieChart as RePieChart\r\n} from 'recharts';\r\n\r\nconst data = [\r\n    { name: 'Mon', dials: 52, connects: 6, meetings: 2, pipeline: 4500 },\r\n    { name: 'Tue', dials: 48, connects: 5, meetings: 1, pipeline: 3200 },\r\n    { name: 'Wed', dials: 55, connects: 8, meetings: 3, pipeline: 6800 },\r\n    { name: 'Thu', dials: 45, connects: 4, meetings: 1, pipeline: 2100 },\r\n    { name: 'Fri', dials: 38, connects: 3, meetings: 2, pipeline: 5400 },\r\n    { name: 'Sat', dials: 15, connects: 1, meetings: 0, pipeline: 1200 },\r\n    { name: 'Sun', dials: 10, connects: 1, meetings: 0, pipeline: 800 },\r\n];\r\n\r\nconst COLORS = ['#3b82f6', '#10b981', '#a855f7', '#f59e0b'];\r\n\r\nexport default function AnalyticsClient() {\r\n    const { user } = useAuth();\r\n    const [forecast, setForecast] = useState<ForecastResult | null>(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const loadForecast = async () => {\r\n            if (!user) {\r\n                // Mock calculation for demo mode\r\n                const mockLeads = [\r\n                    { value: 50000, status: 'Negotiation' },\r\n                    { value: 25000, status: 'Proposal' },\r\n                    { value: 15000, status: 'Qualified' }\r\n                ] as any;\r\n                setForecast(calculateRevenueForecast(mockLeads));\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const leads = await LeadsService.getLeads(user.uid);\r\n                setForecast(calculateRevenueForecast(leads));\r\n            } catch (error) {\r\n                console.error('Forecast failed', error);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        loadForecast();\r\n    }, [user]);\r\n    return (\r\n        <div className=\"p-8 min-h-screen\">\r\n            <header className=\"mb-8 flex justify-between items-end\">\r\n                <div>\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                        <BarChart3 className=\"text-cyan-400 w-5 h-5\" />\r\n                        <span className=\"text-xs font-bold text-cyan-400 uppercase tracking-widest\">Performance Intelligence</span>\r\n                    </div>\r\n                    <h1 className=\"text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-cyan-400 to-blue-400\">\r\n                        Analytics Dashboard\r\n                    </h1>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">Real-time performance metrics and predictive trends</p>\r\n                </div>\r\n\r\n                {forecast && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, x: 20 }}\r\n                        animate={{ opacity: 1, x: 0 }}\r\n                        className=\"hidden lg:block\"\r\n                    >\r\n                        <GlassCard className=\"!py-3 !px-6 border-cyan-500/30 bg-cyan-500/5 relative overflow-hidden group\">\r\n                            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-500/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000\" />\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className=\"p-2 bg-cyan-500/10 rounded-lg\">\r\n                                    <Target className=\"w-5 h-5 text-cyan-400 animate-pulse\" />\r\n                                </div>\r\n                                <div>\r\n                                    <p className=\"text-[10px] text-cyan-500 uppercase font-bold tracking-widest\">Q1 Risk-Adjusted Forecast</p>\r\n                                    <p className=\"text-2xl font-bold text-white leading-none mt-1\">{formatCurrency(forecast.weightedForecast)}</p>\r\n                                </div>\r\n                                <div className=\"flex flex-col items-end border-l border-slate-700/50 pl-4 ml-2\">\r\n                                    <span className=\"text-[10px] text-slate-500 uppercase font-bold\">Confidence</span>\r\n                                    <div className=\"flex gap-1 mt-1\">\r\n                                        {[1, 2, 3].map(i => (\r\n                                            <div key={i} className={`h-1 w-3 rounded-full ${forecast.confidence === 'high' ? 'bg-cyan-400' :\r\n                                                forecast.confidence === 'medium' && i <= 2 ? 'bg-amber-400' :\r\n                                                    forecast.confidence === 'low' && i === 1 ? 'bg-red-400' : 'bg-slate-700'\r\n                                                }`} />\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </GlassCard>\r\n                    </motion.div>\r\n                )}\r\n            </header>\r\n\r\n            {/* Summary Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n                {[\r\n                    { title: 'Weekly Dials', value: '238', change: '+12%', icon: Phone, color: 'blue', trend: 'up' },\r\n                    { title: 'Connect Rate', value: '10.9%', change: '+2.1%', icon: Users, color: 'green', trend: 'up' },\r\n                    { title: 'Meetings Booked', value: '9', change: '-2', icon: Calendar, color: 'purple', trend: 'down' },\r\n                    { title: 'Pipeline Created', value: '$45.2k', change: '+$12k', icon: DollarSign, color: 'amber', trend: 'up' },\r\n                ].map((stat, i) => (\r\n                    <GlassCard key={i} className=\"group hover:border-white/20 transition-all\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"text-sm text-slate-400\">{stat.title}</p>\r\n                                <p className=\"text-3xl font-bold text-white mt-1\">{stat.value}</p>\r\n                                <div className=\"flex items-center gap-1 mt-2\">\r\n                                    {stat.trend === 'up' ? <TrendingUp className=\"w-4 h-4 text-green-400\" /> : <TrendingDown className=\"w-4 h-4 text-red-400\" />}\r\n                                    <span className={`text-xs font-medium ${stat.trend === 'up' ? 'text-green-400' : 'text-red-400'}`}>\r\n                                        {stat.change} vs last week\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                            <div className={`p-4 bg-${stat.color}-500/10 rounded-2xl group-hover:scale-110 transition-transform`}>\r\n                                <stat.icon className={`w-6 h-6 text-${stat.color}-400`} />\r\n                            </div>\r\n                        </div>\r\n                    </GlassCard>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* Revenue/Pipeline Volume (Area Chart) */}\r\n                <GlassCard className=\"lg:col-span-2\">\r\n                    <div className=\"flex items-center justify-between mb-8\">\r\n                        <div>\r\n                            <h3 className=\"text-lg font-bold text-white\">Pipeline Volume</h3>\r\n                            <p className=\"text-xs text-slate-500 uppercase tracking-tighter\">7-Day Revenue Velocity</p>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <Badge variant=\"info\">Live Feed</Badge>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"h-[300px] w-full\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={data}>\r\n                                <defs>\r\n                                    <linearGradient id=\"colorPipeline\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.3} />\r\n                                        <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#1e293b\" />\r\n                                <XAxis dataKey=\"name\" stroke=\"#64748b\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                <YAxis stroke=\"#64748b\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(value) => `$${value}`} />\r\n                                <Tooltip\r\n                                    contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '12px' }}\r\n                                    itemStyle={{ color: '#f8fafc' }}\r\n                                />\r\n                                <Area type=\"monotone\" dataKey=\"pipeline\" stroke=\"#3b82f6\" fillOpacity={1} fill=\"url(#colorPipeline)\" strokeWidth={3} />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </GlassCard>\r\n\r\n                {/* Performance Metrics (Bar Chart) */}\r\n                <GlassCard>\r\n                    <h3 className=\"text-lg font-bold text-white mb-6\">Activity Efficiency</h3>\r\n                    <div className=\"h-[300px] w-full\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <BarChart data={data.slice(0, 5)}>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#1e293b\" />\r\n                                <XAxis dataKey=\"name\" stroke=\"#64748b\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                <YAxis stroke=\"#64748b\" fontSize={12} tickLine={false} axisLine={false} />\r\n                                <Tooltip\r\n                                    cursor={{ fill: '#1e293b', opacity: 0.4 }}\r\n                                    contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '12px' }}\r\n                                />\r\n                                <Bar dataKey=\"connects\" fill=\"#10b981\" radius={[4, 4, 0, 0]} barSize={20} />\r\n                                <Bar dataKey=\"meetings\" fill=\"#a855f7\" radius={[4, 4, 0, 0]} barSize={20} />\r\n                            </BarChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-center gap-6\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-3 h-3 rounded-full bg-green-500\"></div>\r\n                            <span className=\"text-xs text-slate-400\">Connects</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"w-3 h-3 rounded-full bg-purple-500\"></div>\r\n                            <span className=\"text-xs text-slate-400\">Meetings</span>\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n            </div>\r\n\r\n            {/* Team Performance Leaderboard */}\r\n            <GlassCard className=\"mt-6 relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 p-8 opacity-5\">\r\n                    <Target size={120} />\r\n                </div>\r\n                <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\r\n                    <Users className=\"text-blue-400\" size={20} />\r\n                    Elite Performance Leaderboard\r\n                </h3>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                        <thead>\r\n                            <tr className=\"text-left text-slate-500 uppercase text-[10px] tracking-widest border-b border-slate-800\">\r\n                                <th className=\"pb-4 font-bold\">Rank</th>\r\n                                <th className=\"pb-4 font-bold\">Sales Professional</th>\r\n                                <th className=\"pb-4 font-bold\">Activity Vol.</th>\r\n                                <th className=\"pb-4 font-bold\">Conversion</th>\r\n                                <th className=\"pb-4 font-bold\">Revenue Contrib.</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-800/50\">\r\n                            {[\r\n                                { rank: 1, name: 'Sarah Chen', dials: 285, conv: '11.2%', rev: '$125,000', badge: 'MVP' },\r\n                                { rank: 2, name: 'Alex Rep', dials: 238, conv: '10.9%', rev: '$98,400', badge: 'Top Gun' },\r\n                                { rank: 3, name: 'Mike Johnson', dials: 212, conv: '9.9%', rev: '$82,100', badge: null },\r\n                                { rank: 4, name: 'Emily Davis', dials: 198, conv: '9.6%', rev: '$65,000', badge: null },\r\n                            ].map((rep) => (\r\n                                <tr key={rep.rank} className=\"group hover:bg-blue-500/5 transition-all\">\r\n                                    <td className=\"py-4\">\r\n                                        <div className={`w-8 h-8 rounded-xl flex items-center justify-center font-bold ${rep.rank === 1 ? 'bg-amber-500/20 text-amber-400 border border-amber-500/30 shadow-[0_0_15px_rgba(245,158,11,0.2)]' :\r\n                                            rep.rank === 2 ? 'bg-slate-400/20 text-slate-300 border border-slate-700' :\r\n                                                'text-slate-500'\r\n                                            }`}>\r\n                                            {rep.rank}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"py-4\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <span className=\"text-white font-semibold\">{rep.name}</span>\r\n                                            {rep.badge && (\r\n                                                <Badge className=\"bg-blue-500/10 text-blue-400 border-blue-500/20 text-[9px] px-1.5 py-0\">\r\n                                                    {rep.badge}\r\n                                                </Badge>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"py-4 font-mono text-slate-400\">{rep.dials} dials</td>\r\n                                    <td className=\"py-4\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <div className=\"flex-1 h-1.5 w-16 bg-slate-800 rounded-full overflow-hidden\">\r\n                                                <div className=\"h-full bg-green-500\" style={{ width: rep.conv }} />\r\n                                            </div>\r\n                                            <span className=\"text-xs text-green-400 font-bold\">{rep.conv}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"py-4 text-amber-400 font-bold font-mono\">{rep.rev}</td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </GlassCard>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\analytics\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\analytics\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\analytics\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\ai\\generate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[373,376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[373,376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[607,610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[607,610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { verifyIdToken } from '@/lib/firebase/admin';\r\n\r\n// For local development fallback\r\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || process.env.NEXT_PUBLIC_GEMINI_API_KEY || '';\r\n\r\n// Vertex AI client (lazy initialized)\r\nlet vertexAIClient: any = null;\r\nlet vertexInitAttempted = false;\r\nlet vertexInitError: string | null = null;\r\n\r\n// Google GenAI client (lazy initialized)  \r\nlet genAI: GoogleGenerativeAI | null = null;\r\n\r\nasync function tryInitializeVertexAI(): Promise<any> {\r\n    if (vertexAIClient) return vertexAIClient;\r\n    if (vertexInitAttempted) return null; // Don't retry if already failed\r\n\r\n    vertexInitAttempted = true;\r\n\r\n    try {\r\n        const { VertexAI } = await import('@google-cloud/vertexai');\r\n        const projectId = process.env.GOOGLE_CLOUD_PROJECT ||\r\n            process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID ||\r\n            'antigrav-tracking-final';\r\n        vertexAIClient = new VertexAI({ project: projectId, location: 'us-central1' });\r\n        return vertexAIClient;\r\n    } catch (e) {\r\n        vertexInitError = e instanceof Error ? e.message : 'Unknown error';\r\n        console.warn('[AI Route] Vertex AI initialization failed:', vertexInitError);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { prompt, modelName = \"gemini-2.0-flash\" } = body;\r\n\r\n        if (!prompt) {\r\n            return NextResponse.json({ error: \"Prompt is required\" }, { status: 400 });\r\n        }\r\n\r\n        // --- AUTHENTICATION CHECK ---\r\n        // For production, we must verify the user is authenticated\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n            // Local dev exception (optional, but better to be strict)\r\n            if (process.env.NODE_ENV !== 'development') {\r\n                return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n            }\r\n        } else {\r\n            const token = authHeader.split('Bearer ')[1];\r\n            const decodedToken = await verifyIdToken(token);\r\n            if (!decodedToken) {\r\n                return NextResponse.json({ error: \"Invalid token\" }, { status: 401 });\r\n            }\r\n            // User is authenticated\r\n        }\r\n\r\n        // ALWAYS try Vertex AI first (works in App Hosting with ADC)\r\n\r\n        // ALWAYS try Vertex AI first (works in App Hosting with ADC)\r\n        try {\r\n            const vertexAI = await tryInitializeVertexAI();\r\n            if (vertexAI) {\r\n                const model = vertexAI.getGenerativeModel({ model: modelName });\r\n                const result = await model.generateContent(prompt);\r\n                const text = result.response?.candidates?.[0]?.content?.parts?.[0]?.text || '';\r\n                return NextResponse.json({ text });\r\n            }\r\n        } catch (e) {\r\n            const errorMsg = e instanceof Error ? e.message : 'Unknown error';\r\n            console.warn('[AI Route] Vertex AI generation failed:', errorMsg);\r\n            // Fall through to API key fallback\r\n        }\r\n\r\n        // Fallback to Google Generative AI SDK with API key\r\n        if (!GEMINI_API_KEY) {\r\n            console.error('[AI Route] No API key available for fallback');\r\n            return NextResponse.json(\r\n                {\r\n                    error: \"AI service unavailable. Vertex AI failed to initialize and no API key is configured.\",\r\n                    vertexError: vertexInitError\r\n                },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        if (!genAI) {\r\n            genAI = new GoogleGenerativeAI(GEMINI_API_KEY);\r\n        }\r\n\r\n        const model = genAI.getGenerativeModel({ model: modelName });\r\n        const result = await model.generateContent(prompt);\r\n        const response = await result.response;\r\n        const text = response.text();\r\n\r\n        return NextResponse.json({ text });\r\n    } catch (error: unknown) {\r\n        const errorMessage = error instanceof Error ? error.message : 'Internal Server Error';\r\n        console.error('[AI Route] Fatal error:', error);\r\n        return NextResponse.json(\r\n            { error: errorMessage },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\auth\\gmail\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\auth\\gmail\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\email\\send\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\resources\\upload\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1899,1902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1899,1902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { getAdminAuth, getAdminDb } from '@/lib/firebase/admin';\r\n\r\n/**\r\n * Resource Upload Endpoint (Dec 2025)\r\n * Handles document ingestion for Gemini File Search (Managed RAG).\r\n */\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // 1. Authenticate Request\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const token = authHeader.split('Bearer ')[1];\r\n        const adminAuth = getAdminAuth();\r\n        const decodedToken = await adminAuth.verifyIdToken(token);\r\n        const userId = decodedToken.uid;\r\n\r\n        // 2. Parse Multipart Data\r\n        const formData = await req.formData();\r\n        const file = formData.get('file') as File;\r\n        const category = formData.get('category') as string || 'General';\r\n\r\n        if (!file) {\r\n            return NextResponse.json({ error: 'No file uploaded' }, { status: 400 });\r\n        }\r\n\r\n        // 3. Log Ingestion in Firestore\r\n        // In production, you would upload to Firebase Storage and trigger a Vertex AI index update.\r\n        const db = getAdminDb();\r\n        const resourceRef = await db.collection('resources').add({\r\n            title: file.name,\r\n            category,\r\n            fileName: file.name,\r\n            fileType: file.type,\r\n            fileSize: file.size,\r\n            ownerId: userId,\r\n            uploadedAt: Date.now(),\r\n            status: 'processing' // Simulate managed RAG indexing status\r\n        });\r\n\r\n        // 4. Return success to UI\r\n        return NextResponse.json({\r\n            success: true,\r\n            resourceId: resourceRef.id,\r\n            message: 'Document received and queued for RAG indexing.'\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Upload Error:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\stripe\\checkout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\stripe\\portal\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1185,1188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1185,1188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport { stripe } from '@/lib/stripe/server';\r\n// import { ProfileService } from '@/lib/firebase/services';\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { userId, customerId } = await req.json();\r\n\r\n        if (!userId) {\r\n            return new NextResponse('Unauthorized', { status: 401 });\r\n        }\r\n\r\n        // 1. In prod: Get Stripe Customer ID from Firestore if it exists\r\n        // If not, search Stripe by email or create one.\r\n        // For now, let's assume we need to search or create to get a valid Portal link\r\n\r\n        // Mocking behavior:\r\n        // const customer = await stripe.customers.create({ metadata: { userId }});\r\n        // const customerId = customer.id;\r\n\r\n        if (!customerId) {\r\n            // If no customer yet, send them to pricing\r\n            return NextResponse.json({ url: '/pricing' });\r\n        }\r\n\r\n        const session = await stripe.billingPortal.sessions.create({\r\n            customer: customerId,\r\n            return_url: `${req.headers.get('origin')}/settings`,\r\n        });\r\n\r\n        return NextResponse.json({ url: session.url });\r\n    } catch (error: any) {\r\n        console.error('[STRIPE_PORTAL_ERROR]', error);\r\n        return new NextResponse('Internal Error', { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\stripe\\webhook\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\call\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\incoming-message\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextResponse' is defined but never used.","line":1,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { db } from '@/lib/firebase/config';\r\nimport { collection, query, where, getDocs, addDoc } from 'firebase/firestore';\r\n\r\n/**\r\n * Twilio Inbound Webhook (Dec 2025)\r\n * Captures replies and routes them to the correct lead history.\r\n */\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const formData = await req.formData();\r\n        const from = formData.get('From') as string;\r\n        const body = formData.get('Body') as string;\r\n        const messageSid = formData.get('MessageSid') as string;\r\n\r\n        if (!from || !body) {\r\n            return new Response('Invalid Request', { status: 400 });\r\n        }\r\n\r\n        // 1. Find the lead associated with this phone number\r\n        // We search across all users since webhooks are global\r\n        // In production, you'd use a more efficient lookup index\r\n        const leadsQuery = query(collection(db, 'leads'), where('phone', '==', from));\r\n        const leadsSnapshot = await getDocs(leadsQuery);\r\n\r\n        if (leadsSnapshot.empty) {\r\n            console.log(`No lead found for number: ${from}`);\r\n            return new Response('Lead not found', { status: 200 }); // Still return 200 to Twilio\r\n        }\r\n\r\n        // 2. Log the activity for each user/lead matching this number\r\n        const logPromises = leadsSnapshot.docs.map(async (leadDoc) => {\r\n            const leadData = leadDoc.data();\r\n            const userId = leadData.ownerId; // Assuming ownerId exists on lead\r\n\r\n            if (userId) {\r\n                return addDoc(collection(db, 'users', userId, 'activities'), {\r\n                    type: 'social',\r\n                    outcome: 'connected',\r\n                    timestamp: Date.now(),\r\n                    repId: userId,\r\n                    leadId: leadDoc.id,\r\n                    notes: `Inbound Message: ${body}`,\r\n                    channel: 'sms',\r\n                    messageSid\r\n                });\r\n            }\r\n        });\r\n\r\n        await Promise.all(logPromises);\r\n\r\n        // 3. Respond with empty TwiML to acknowledge receipt\r\n        return new Response('<Response></Response>', {\r\n            headers: { 'Content-Type': 'text/xml' }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Webhook Error:', error);\r\n        return new Response('Internal error', { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\lookup\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'withAuth' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { lookupPhoneNumber } from '@/lib/twilio/lookup-service';\r\nimport { isTwilioConfigured } from '@/lib/twilio/twilio-config';\r\nimport { withAuth } from '@/lib/auth';\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        if (!isTwilioConfigured()) {\r\n            return NextResponse.json(\r\n                { error: 'Twilio not configured' },\r\n                { status: 503 }\r\n            );\r\n        }\r\n\r\n        const body = await request.json();\r\n        const { phoneNumber } = body;\r\n\r\n        if (!phoneNumber) {\r\n            return NextResponse.json(\r\n                { error: 'Phone number is required' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const result = await lookupPhoneNumber(phoneNumber);\r\n\r\n        return NextResponse.json(result);\r\n\r\n    } catch (error) {\r\n        console.error('Lookup API Error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to verify phone number' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\sms-webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'leadId' is assigned a value but never used.","line":13,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[750,753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[750,753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { updateSMSStatus } from '@/lib/twilio/sms-service';\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const formData = await request.formData();\r\n\r\n        const messageSid = formData.get('MessageSid') as string;\r\n        const messageStatus = formData.get('MessageStatus') as string;\r\n\r\n        // Get generic params\r\n        const userId = request.nextUrl.searchParams.get('userId');\r\n        const leadId = request.nextUrl.searchParams.get('leadId');\r\n\r\n\r\n\r\n        // Map Twilio status\r\n        const validStatuses = ['queued', 'sent', 'delivered', 'failed', 'undelivered'];\r\n        const status = validStatuses.includes(messageStatus) ? messageStatus as any : 'sent';\r\n\r\n        if (userId && messageSid) {\r\n            try {\r\n                await updateSMSStatus(messageSid, userId, status);\r\n                await updateSMSStatus(messageSid, userId, status);\r\n            } catch (error) {\r\n                console.error(`Failed to update SMS status:`, error);\r\n            }\r\n        } else {\r\n            console.warn('Missing userId or messageSid in SMS webhook');\r\n        }\r\n\r\n        return new NextResponse(\r\n            '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response></Response>',\r\n            {\r\n                status: 200,\r\n                headers: { 'Content-Type': 'text/xml' }\r\n            }\r\n        );\r\n    } catch (error) {\r\n        console.error('Error processing SMS webhook:', error);\r\n        return new NextResponse(\r\n            '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response></Response>',\r\n            {\r\n                status: 200,\r\n                headers: { 'Content-Type': 'text/xml' }\r\n            }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\sms\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1578,1581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1578,1581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { sendSMSWithLogging } from '@/lib/twilio/twilio-service';\r\nimport { getAdminAuth } from '@/lib/firebase/admin';\r\n\r\n/**\r\n * Enterprise-grade SMS Endpoint (Dec 2025)\r\n * Securely handles outbound messaging with full audit logging.\r\n */\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // 1. Authenticate Request (JWT Verification)\r\n        const authHeader = req.headers.get('Authorization');\r\n        if (!authHeader?.startsWith('Bearer ')) {\r\n            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n        }\r\n\r\n        const token = authHeader.split('Bearer ')[1];\r\n        const adminAuth = getAdminAuth();\r\n        const decodedToken = await adminAuth.verifyIdToken(token);\r\n        const userId = decodedToken.uid;\r\n\r\n        // 2. Parse and Validate Payload\r\n        const body = await req.json();\r\n        const { to, body: messageBody, leadId } = body;\r\n\r\n        if (!to || !messageBody || !leadId) {\r\n            return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });\r\n        }\r\n\r\n        // 3. Dispatch SMS via Service Layer\r\n        const result = await sendSMSWithLogging(userId, leadId, to, messageBody);\r\n\r\n        if (!result.success) {\r\n            return NextResponse.json({ error: result.error }, { status: 500 });\r\n        }\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            messageSid: result.messageSid,\r\n            note: 'Message queued for delivery'\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('API SMS Error:', error);\r\n        return NextResponse.json({\r\n            error: error.message || 'Internal server error'\r\n        }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\status\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\api\\twilio\\webhook\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'leadId' is assigned a value but never used.","line":38,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2103,2106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2103,2106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server';\r\nimport { updateCallStatus } from '@/lib/twilio/call-service';\r\nimport { validateRequest } from 'twilio';\r\n\r\n/**\r\n * Twilio webhook for call status updates\r\n * Twilio sends POST requests here when call status changes\r\n */\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const formData = await request.formData();\r\n\r\n        // 1. Security Check: Validate Request Signature\r\n        const twilioSignature = request.headers.get('x-twilio-signature');\r\n        const authToken = process.env.TWILIO_AUTH_TOKEN;\r\n        const url = `${process.env.NEXT_PUBLIC_APP_URL}/api/twilio/webhook`;\r\n\r\n        // Convert formData to object for validation\r\n        const params: Record<string, string> = {};\r\n        formData.forEach((value, key) => {\r\n            params[key] = value as string;\r\n        });\r\n\r\n        if (process.env.NODE_ENV === 'production') {\r\n            if (!twilioSignature || !authToken || !validateRequest(authToken, twilioSignature, url, params)) {\r\n                console.error('Security Alert: Invalid Twilio Signature');\r\n                return new NextResponse('Unauthorized', { status: 403 });\r\n            }\r\n        }\r\n\r\n        const callSid = params['CallSid'];\r\n        const callStatus = params['CallStatus'];\r\n        const callDuration = params['CallDuration'];\r\n        const recordingUrl = params['RecordingUrl'];\r\n\r\n        // Get userId from query params (passed in statusCallback)\r\n        const userId = request.nextUrl.searchParams.get('userId');\r\n        const leadId = request.nextUrl.searchParams.get('leadId');\r\n\r\n\r\n\r\n        // Map Twilio status to our status type\r\n        const statusMap: Record<string, string> = {\r\n            'queued': 'queued',\r\n            'ringing': 'ringing',\r\n            'in-progress': 'in-progress',\r\n            'completed': 'completed',\r\n            'busy': 'busy',\r\n            'failed': 'failed',\r\n            'no-answer': 'no-answer',\r\n            'canceled': 'canceled',\r\n        };\r\n\r\n        const status = (statusMap[callStatus] || 'failed') as any;\r\n        const duration = callDuration ? parseInt(callDuration) : undefined;\r\n\r\n        if (userId) {\r\n            try {\r\n                await updateCallStatus(callSid, userId, status, duration, recordingUrl);\r\n                console.log(`Updated call ${callSid} status to ${status} for user ${userId}`);\r\n            } catch (error) {\r\n                console.error(`Failed to update call status for ${callSid}:`, error);\r\n                // Don't fail the webhook response, just log the error\r\n            }\r\n        } else {\r\n            console.warn(`Received webhook for call ${callSid} without userId`);\r\n        }\r\n\r\n        // Return TwiML response (required by Twilio)\r\n        return new NextResponse(\r\n            '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response></Response>',\r\n            {\r\n                status: 200,\r\n                headers: {\r\n                    'Content-Type': 'text/xml',\r\n                },\r\n            }\r\n        );\r\n    } catch (error) {\r\n        console.error('Error processing Twilio webhook:', error);\r\n        return new NextResponse(\r\n            '<?xml version=\"1.0\" encoding=\"UTF-8\"?><Response></Response>',\r\n            {\r\n                status: 200,\r\n                headers: {\r\n                    'Content-Type': 'text/xml',\r\n                },\r\n            }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\leads\\LeadsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":17,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Info' is defined but never used.","line":17,"column":108,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":112},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowRightCircle' is defined but never used.","line":17,"column":176,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":192},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VelocityResult' is defined but never used.","line":19,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getAIStatus' is defined but never used.","line":20,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getActivityIcon' is assigned a value but never used.","line":238,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":238,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatDuration' is assigned a value but never used.","line":247,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":247,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":421,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18550,18597],"text":"\r\n                                            &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18550,18597],"text":"\r\n                                            &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18550,18597],"text":"\r\n                                            &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18550,18597],"text":"\r\n                                            &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":421,"column":80,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[18631,18674],"text":"&quot;\r\n                                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[18631,18674],"text":"&ldquo;\r\n                                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[18631,18674],"text":"&#34;\r\n                                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[18631,18674],"text":"&rdquo;\r\n                                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26662,26665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26662,26665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":131,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":134,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26686,26689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26686,26689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":540,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":540,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27355,27358],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27355,27358],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":540,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":540,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27379,27382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27379,27382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { Badge } from '@/components/ui/Badge';\r\nimport { Lead, Activity, LeadStatus } from '@/types';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { AddLeadModal } from '@/components/leads/AddLeadModal';\r\nimport { LogCallModal } from '@/components/leads/LogCallModal';\r\nimport { LogMeetingModal } from '@/components/leads/LogMeetingModal';\r\nimport { LogReplyModal } from '@/components/leads/LogReplyModal';\r\nimport { AIEmailDraft } from '@/components/ai/AIEmailDraft';\r\nimport { LeadsService, ActivitiesService } from '@/lib/firebase/services';\r\nimport { formatCurrency } from '@/lib/utils/formatters';\r\nimport { toast } from 'sonner';\r\nimport { analytics } from '@/lib/analytics';\r\nimport { Zap, Gauge, Sparkles, AlertCircle, TrendingUp as VelocityUp, Minus, TrendingDown as VelocityDown, Info, Activity as PulseIcon, Download, CheckSquare, Square, Trash2, ArrowRightCircle, Mail as MailIcon } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { calculateLeadVelocity, VelocityResult } from '@/lib/utils/scoring';\r\nimport { analyzeLeadIntelligence, getAIStatus } from '@/lib/firebase/ai-service';\r\nimport { getLeadEmails, EmailRecord, isGmailConnected } from '@/lib/gmail/gmail-service';\r\n\r\n// Fallback mock data when not logged in\r\nconst MOCK_LEADS: Lead[] = [\r\n    {\r\n        id: '1',\r\n        companyName: 'Tech Corp Global',\r\n        contactName: 'John Doe',\r\n        email: 'john@techcorp.com',\r\n        phone: '555-0123',\r\n        value: 5000,\r\n        status: 'New',\r\n        assignedTo: 'demo',\r\n        industry: 'SaaS',\r\n        createdAt: Date.now(),\r\n        updatedAt: Date.now(),\r\n    },\r\n    {\r\n        id: '2',\r\n        companyName: 'AI Solutions Inc',\r\n        contactName: 'Jane Smith',\r\n        email: 'jane@aisolutions.io',\r\n        phone: '555-9876',\r\n        value: 12000,\r\n        status: 'Qualified',\r\n        assignedTo: 'demo',\r\n        industry: 'Generative AI',\r\n        createdAt: Date.now() - 86400000,\r\n        updatedAt: Date.now(),\r\n    },\r\n    {\r\n        id: '3',\r\n        companyName: 'Enterprise Logistics',\r\n        contactName: 'Bob Wilson',\r\n        email: 'bob@logisticsco.com',\r\n        phone: '555-4567',\r\n        value: 35000,\r\n        status: 'Negotiation',\r\n        assignedTo: 'demo',\r\n        industry: 'Logistics',\r\n        createdAt: Date.now() - 172800000,\r\n        updatedAt: Date.now(),\r\n    }\r\n];\r\n\r\nexport default function LeadsClient() {\r\n    const { user, loading: authLoading } = useAuth();\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [leads, setLeads] = useState<Lead[]>([]);\r\n    const [activities, setActivities] = useState<Record<string, Activity[]>>({});\r\n    const [leadIntel, setLeadIntel] = useState<Record<string, { score: number; signal: string; justification: string }>>({});\r\n    const [selectedLeadIds, setSelectedLeadIds] = useState<Set<string>>(new Set());\r\n    const [gmailHistory, setGmailHistory] = useState<Record<string, EmailRecord[]>>({});\r\n    const [gmailConnected, setGmailConnected] = useState(false);\r\n\r\n    // Modal states\r\n    const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n    const [selectedLead, setSelectedLead] = useState<Lead | null>(null);\r\n    const [isEmailDraftOpen, setIsEmailDraftOpen] = useState(false);\r\n    const [isCallModalOpen, setIsCallModalOpen] = useState(false);\r\n    const [isMeetingModalOpen, setIsMeetingModalOpen] = useState(false);\r\n    const [isReplyModalOpen, setIsReplyModalOpen] = useState(false);\r\n\r\n    const [expandedLeadId, setExpandedLeadId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            isGmailConnected(user.uid).then(setGmailConnected);\r\n        }\r\n    }, [user]);\r\n\r\n    const loadLeads = useCallback(async () => {\r\n        if (!user) return;\r\n        setIsLoading(true);\r\n        try {\r\n            const data = await LeadsService.getLeads(user.uid);\r\n            setLeads(data.length > 0 ? data : MOCK_LEADS);\r\n        } catch (error) {\r\n            console.error('Error loading leads:', error);\r\n            toast.error('Failed to load leads');\r\n            setLeads(MOCK_LEADS);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [user]);\r\n\r\n    const loadLeadActivities = useCallback(async (leadId: string) => {\r\n        if (!user) return;\r\n        try {\r\n            const data = await ActivitiesService.getLeadActivities(user.uid, leadId);\r\n            setActivities(prev => ({ ...prev, [leadId]: data }));\r\n        } catch (error) {\r\n            console.error('Error loading activities:', error);\r\n        }\r\n    }, [user]);\r\n\r\n    // Load leads\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n\r\n        if (!user) {\r\n            setLeads(MOCK_LEADS);\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n\r\n        loadLeads();\r\n    }, [user, authLoading, loadLeads]);\r\n\r\n    const handleAddLead = async (leadData: Omit<Lead, 'id' | 'createdAt' | 'updatedAt' | 'assignedTo'>) => {\r\n        if (!user) {\r\n            const newLead: Lead = {\r\n                ...leadData,\r\n                id: `lead_${Date.now()}`,\r\n                assignedTo: 'demo',\r\n                createdAt: Date.now(),\r\n                updatedAt: Date.now(),\r\n            };\r\n            setLeads([newLead, ...leads]);\r\n            toast.success('Lead added (demo mode)');\r\n            analytics.track('lead_added', { mode: 'demo', industry: leadData.industry });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await LeadsService.createLead(user.uid, leadData);\r\n            toast.success('Lead created successfully!');\r\n            analytics.track('lead_added', { mode: 'prod', industry: leadData.industry });\r\n            loadLeads();\r\n        } catch (error) {\r\n            console.error('Error creating lead:', error);\r\n            toast.error('Failed to create lead');\r\n        }\r\n    };\r\n\r\n    const handleExpandLead = (leadId: string) => {\r\n        // Only expand if NOT in selection mode or clicking the same expanded lead\r\n        if (selectedLeadIds.size > 0 && !selectedLeadIds.has(leadId)) return;\r\n\r\n        if (expandedLeadId === leadId) {\r\n            setExpandedLeadId(null);\r\n        } else {\r\n            setExpandedLeadId(leadId);\r\n            if (leadId && !activities[leadId]) {\r\n                loadLeadActivities(leadId);\r\n            }\r\n\r\n            if (leadId && gmailConnected && !gmailHistory[leadId]) {\r\n                loadGmailHistory(leadId);\r\n            }\r\n        }\r\n    };\r\n\r\n    const loadGmailHistory = async (leadId: string) => {\r\n        if (!user) return;\r\n        try {\r\n            const emails = await getLeadEmails(user.uid, leadId);\r\n            setGmailHistory(prev => ({ ...prev, [leadId]: emails }));\r\n        } catch (error) {\r\n            console.error('Gmail history load failed', error);\r\n        }\r\n    };\r\n\r\n    const handleActivitySuccess = () => {\r\n        loadLeads();\r\n        if (selectedLead) {\r\n            loadLeadActivities(selectedLead.id);\r\n            // Re-run AI intel on activity update\r\n            handleIntelRequest(selectedLead);\r\n        }\r\n    };\r\n\r\n    const handleIntelRequest = async (lead: Lead) => {\r\n        if (!user) return;\r\n        try {\r\n            const leadActivities = activities[lead.id] || await ActivitiesService.getLeadActivities(user.uid, lead.id);\r\n            const intel = await analyzeLeadIntelligence(lead, leadActivities);\r\n            setLeadIntel(prev => ({ ...prev, [lead.id]: intel }));\r\n        } catch (error) {\r\n            console.error('Intelligence analysis failed', error);\r\n        }\r\n    };\r\n\r\n    const handleExportCSV = () => {\r\n        if (leads.length === 0) {\r\n            toast.error('No leads to export');\r\n            return;\r\n        }\r\n\r\n        const headers = ['Company', 'Contact', 'Email', 'Phone', 'Value', 'Status', 'Industry', 'Created At'];\r\n        const csvContent = [\r\n            headers.join(','),\r\n            ...leads.map(lead => [\r\n                `\"${lead.companyName}\"`,\r\n                `\"${lead.contactName}\"`,\r\n                `\"${lead.email}\"`,\r\n                `\"${lead.phone || ''}\"`,\r\n                lead.value,\r\n                `\"${lead.status}\"`,\r\n                `\"${lead.industry || ''}\"`,\r\n                new Date(lead.createdAt).toLocaleDateString()\r\n            ].join(','))\r\n        ].join('\\n');\r\n\r\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n        const link = document.createElement('a');\r\n        const url = URL.createObjectURL(blob);\r\n        link.setAttribute('href', url);\r\n        link.setAttribute('download', `leads_export_${new Date().toISOString().split('T')[0]}.csv`);\r\n        link.style.visibility = 'hidden';\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        toast.success('Leads exported successfully');\r\n        analytics.track('leads_exported', { count: leads.length });\r\n    };\r\n\r\n    const getActivityIcon = (type: string) => {\r\n        switch (type) {\r\n            case 'email': return '';\r\n            case 'call': return '';\r\n            case 'meeting': return '';\r\n            default: return '';\r\n        }\r\n    };\r\n\r\n    const formatDuration = (seconds?: number) => {\r\n        if (!seconds) return '';\r\n        const mins = Math.floor(seconds / 60);\r\n        return ` (${mins} min)`;\r\n    };\r\n\r\n    const toggleSelectLead = (leadId: string, e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        const newSelected = new Set(selectedLeadIds);\r\n        if (newSelected.has(leadId)) {\r\n            newSelected.delete(leadId);\r\n        } else {\r\n            newSelected.add(leadId);\r\n        }\r\n        setSelectedLeadIds(newSelected);\r\n    };\r\n\r\n    const handleBulkDelete = async () => {\r\n        if (!user) {\r\n            setLeads(leads.filter(l => !selectedLeadIds.has(l.id)));\r\n            setSelectedLeadIds(new Set());\r\n            toast.success('Leads removed (demo mode)');\r\n            return;\r\n        }\r\n\r\n        const confirm = window.confirm(`Are you sure you want to delete ${selectedLeadIds.size} leads?`);\r\n        if (!confirm) return;\r\n\r\n        try {\r\n            await Promise.all(\r\n                Array.from(selectedLeadIds).map(id => LeadsService.deleteLead(user.uid, id))\r\n            );\r\n            toast.success('Leads deleted successfully');\r\n            setSelectedLeadIds(new Set());\r\n            loadLeads();\r\n        } catch (error) {\r\n            console.error('Bulk delete failed', error);\r\n            toast.error('Failed to delete some leads');\r\n        }\r\n    };\r\n\r\n    const handleBulkStatusUpdate = async (newStatus: LeadStatus) => {\r\n        if (!user) {\r\n            setLeads(leads.map(l => selectedLeadIds.has(l.id) ? { ...l, status: newStatus } : l));\r\n            setSelectedLeadIds(new Set());\r\n            toast.success('Status updated (demo mode)');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await Promise.all(\r\n                Array.from(selectedLeadIds).map(id => LeadsService.updateLead(user.uid, id, { status: newStatus }))\r\n            );\r\n            toast.success(`Leads moved to ${newStatus}`);\r\n            setSelectedLeadIds(new Set());\r\n            loadLeads();\r\n        } catch (error) {\r\n            console.error('Bulk update failed', error);\r\n        }\r\n    };\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"p-8 min-h-screen flex items-center justify-center\">\r\n                <div className=\"text-slate-500\">Loading leads...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-8 min-h-screen\">\r\n            <header className=\"flex justify-between items-center mb-8\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400\">\r\n                        Leads Pipeline\r\n                    </h1>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">\r\n                        {user ? `${leads.length} leads` : 'Demo Mode - Log in to save data'}\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex gap-3\">\r\n                    <button\r\n                        onClick={handleExportCSV}\r\n                        className=\"glass-button flex items-center gap-2 border-slate-700 text-slate-400 hover:text-white\"\r\n                        title=\"Export leads to CSV\"\r\n                    >\r\n                        <Download size={16} /> Export CSV\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setIsAddModalOpen(true)}\r\n                        className=\"glass-button\"\r\n                    >\r\n                        + Add New Lead\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                {leads.map((lead) => (\r\n                    <GlassCard\r\n                        key={lead.id}\r\n                        onClick={() => expandedLeadId !== lead.id && handleExpandLead(lead.id)}\r\n                        className={`cursor-pointer group relative overflow-hidden transition-all border-l-4 ${selectedLeadIds.has(lead.id) ? 'border-l-blue-500 bg-blue-500/5' : 'border-l-transparent'\r\n                            } ${expandedLeadId === lead.id ? 'md:col-span-2 lg:col-span-2' : ''}`}\r\n                    >\r\n                        {/* Multi-select checkbox */}\r\n                        <div\r\n                            onClick={(e) => toggleSelectLead(lead.id, e)}\r\n                            className=\"absolute top-2 left-2 z-20 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                        >\r\n                            {selectedLeadIds.has(lead.id) ? (\r\n                                <CheckSquare size={16} className=\"text-blue-400\" />\r\n                            ) : (\r\n                                <Square size={16} className=\"text-slate-600 hover:text-blue-400\" />\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-blue-500/10 to-purple-500/10 opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n\r\n                        {/* Velocity Gauge Overlay */}\r\n                        {(() => {\r\n                            const velocity = calculateLeadVelocity(lead, activities[lead.id]);\r\n                            return (\r\n                                <div className=\"absolute top-0 right-0 p-2 opacity-30 group-hover:opacity-100 transition-all\">\r\n                                    <div className={`px-2 py-0.5 rounded-full text-[9px] font-bold border flex items-center gap-1 ${velocity.status === 'hot' ? 'bg-red-500/20 text-red-400 border-red-500/30' :\r\n                                        velocity.status === 'warm' ? 'bg-amber-500/20 text-amber-400 border-amber-500/30' :\r\n                                            'bg-slate-500/20 text-slate-400 border-slate-500/30'\r\n                                        }`}>\r\n                                        <Gauge size={10} />\r\n                                        Velocity: {velocity.score}%\r\n                                        {velocity.momentum === 'rising' ? <VelocityUp size={10} /> : velocity.momentum === 'dropping' ? <VelocityDown size={10} /> : <Minus size={10} />}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })()}\r\n\r\n                        <div className=\"relative z-10\">\r\n                            {/* Lead Header */}\r\n                            <div\r\n                                className=\"flex justify-between items-start mb-3\"\r\n                                onClick={() => handleExpandLead(lead.id)}\r\n                            >\r\n                                <h3 className=\"text-lg font-semibold text-white group-hover:text-blue-300 transition-colors\">\r\n                                    {lead.companyName}\r\n                                </h3>\r\n                                <Badge variant={lead.status === 'New' ? 'info' : lead.status === 'Qualified' ? 'success' : lead.status === 'Closed' ? 'success' : 'warning'}>\r\n                                    {lead.status}\r\n                                </Badge>\r\n                            </div>\r\n\r\n                            {/* Lead Info */}\r\n                            <div className=\"mb-4\">\r\n                                <p className=\"text-slate-300 text-sm font-medium\">{lead.contactName}</p>\r\n                                <p className=\"text-slate-500 text-xs\">{lead.email}</p>\r\n                                {lead.industry && (\r\n                                    <span className=\"inline-block mt-2 text-[10px] uppercase tracking-wider text-slate-500 border border-slate-700 px-1.5 py-0.5 rounded\">\r\n                                        {lead.industry}\r\n                                    </span>\r\n                                )}\r\n                                {lead.nextStep && (\r\n                                    <p className=\"text-xs text-amber-400 mt-2 font-medium flex items-center gap-1\">\r\n                                        <PulseIcon size={12} /> {lead.nextStep}\r\n                                    </p>\r\n                                )}\r\n\r\n                                {/* AI Intelligence Signal */}\r\n                                {leadIntel[lead.id] ? (\r\n                                    <div className=\"mt-3 p-2 rounded-lg bg-blue-500/5 border border-blue-500/10 relative group/intel animate-in fade-in zoom-in-95 duration-300\">\r\n                                        <div className=\"flex items-center gap-1.5 mb-1\">\r\n                                            <Sparkles size={12} className=\"text-blue-400\" />\r\n                                            <span className=\"text-[10px] font-bold text-blue-400 uppercase tracking-tighter\">AI Intelligence</span>\r\n                                            <Badge variant=\"info\" className=\"ml-auto text-[8px] py-0 px-1 border-blue-500/20\">{leadIntel[lead.id].signal}</Badge>\r\n                                        </div>\r\n                                        <p className=\"text-[11px] text-slate-400 leading-tight italic line-clamp-2\">\r\n                                            \"{leadIntel[lead.id].justification}\"\r\n                                        </p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={(e) => { e.stopPropagation(); handleIntelRequest(lead); }}\r\n                                        className=\"mt-3 w-full py-1 text-[10px] text-slate-500 hover:text-blue-400 border border-dashed border-slate-700 hover:border-blue-500/40 rounded transition-all italic flex items-center justify-center gap-1\"\r\n                                    >\r\n                                        <Sparkles size={10} /> Analyze Deal Sentiment\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Value & Date */}\r\n                            <div className=\"flex justify-between items-center border-t border-slate-700/50 pt-3 mt-2\">\r\n                                <span className=\"text-xl font-bold text-emerald-400\">\r\n                                    {formatCurrency(lead.value)}\r\n                                </span>\r\n                                <span className=\"text-xs text-slate-600\">\r\n                                    {lead.lastContact\r\n                                        ? `Last: ${new Date(lead.lastContact).toLocaleDateString()}`\r\n                                        : new Date(lead.updatedAt).toLocaleDateString()\r\n                                    }\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Action Buttons */}\r\n                            <div className=\"mt-3 flex gap-2\">\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        setSelectedLead(lead);\r\n                                        setIsEmailDraftOpen(true);\r\n                                    }}\r\n                                    className=\"flex-1 py-2 text-xs bg-gradient-to-r from-violet-600/20 to-fuchsia-600/20 hover:from-violet-600/40 hover:to-fuchsia-600/40 border border-violet-500/30 rounded-lg text-violet-300 transition-all flex items-center justify-center gap-1\"\r\n                                >\r\n                                     Email\r\n                                </button>\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        if (!user) { toast.info('Log in to track calls'); return; }\r\n                                        setSelectedLead(lead);\r\n                                        setIsCallModalOpen(true);\r\n                                    }}\r\n                                    className=\"px-3 py-2 text-xs bg-green-500/10 hover:bg-green-500/20 border border-green-500/30 rounded-lg text-green-400 transition-all\"\r\n                                    title=\"Log Call\"\r\n                                >\r\n                                    \r\n                                </button>\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        if (!user) { toast.info('Log in to track meetings'); return; }\r\n                                        setSelectedLead(lead);\r\n                                        setIsMeetingModalOpen(true);\r\n                                    }}\r\n                                    className=\"px-3 py-2 text-xs bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 rounded-lg text-blue-400 transition-all\"\r\n                                    title=\"Log Meeting\"\r\n                                >\r\n                                    \r\n                                </button>\r\n                                <button\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        if (!user) { toast.info('Log in to track replies'); return; }\r\n                                        setSelectedLead(lead);\r\n                                        setIsReplyModalOpen(true);\r\n                                    }}\r\n                                    className=\"px-3 py-2 text-xs bg-amber-500/10 hover:bg-amber-500/20 border border-amber-500/30 rounded-lg text-amber-400 transition-all\"\r\n                                    title=\"Log Reply Received\"\r\n                                >\r\n                                    \r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Expanded Activity Timeline */}\r\n                            {expandedLeadId === lead.id && (\r\n                                <div className=\"mt-4 pt-4 border-t border-slate-700/50\">\r\n                                    <div className=\"flex items-center gap-2 mb-4\">\r\n                                        <PulseIcon size={14} className=\"text-blue-400\" />\r\n                                        <h4 className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">Unified Engagement History</h4>\r\n                                    </div>\r\n\r\n                                    <div className=\"space-y-3\">\r\n                                        {/* Combined Timeline: Activities + Gmail */}\r\n                                        {(() => {\r\n                                            const leadActivities = activities[lead.id] || [];\r\n                                            const leadEmails = gmailHistory[lead.id] || [];\r\n\r\n                                            const timeline = [\r\n                                                ...leadActivities.map(a => ({ ...a, sortKey: a.timestamp, timelineType: 'activity' as const })),\r\n                                                ...leadEmails.map(e => ({ ...e, sortKey: e.timestamp, timelineType: 'email' as const }))\r\n                                            ].sort((a, b) => b.sortKey - a.sortKey);\r\n\r\n                                            if (timeline.length === 0) {\r\n                                                return <p className=\"text-xs text-slate-600 italic py-4\">No recent engagement recorded.</p>;\r\n                                            }\r\n\r\n                                            return timeline.map((item, idx) => (\r\n                                                <div key={idx} className=\"flex gap-3 group/item\">\r\n                                                    <div className=\"flex flex-col items-center\">\r\n                                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center border ${item.timelineType === 'email' ? 'bg-purple-500/10 border-purple-500/20 text-purple-400' :\r\n                                                                'bg-blue-500/10 border-blue-500/20 text-blue-400'\r\n                                                            }`}>\r\n                                                            {item.timelineType === 'email' ? <MailIcon size={12} /> : <PulseIcon size={12} />}\r\n                                                        </div>\r\n                                                        {idx < timeline.length - 1 && <div className=\"w-px flex-1 bg-slate-800 my-1\" />}\r\n                                                    </div>\r\n                                                    <div className=\"flex-1 pb-4\">\r\n                                                        <div className=\"flex justify-between items-start mb-1\">\r\n                                                            <span className=\"text-[10px] font-bold text-slate-300 uppercase tracking-tight\">\r\n                                                                {item.timelineType === 'email' ? (item as any).subject : (item as any).type}\r\n                                                            </span>\r\n                                                            <span className=\"text-[9px] text-slate-500\">\r\n                                                                {new Date(item.sortKey).toLocaleDateString()}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <p className=\"text-[11px] text-slate-400 leading-relaxed line-clamp-2 italic\">\r\n                                                            {item.timelineType === 'email' ? (item as any).snippet : (item as any).notes}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ));\r\n                                        })()}\r\n                                    </div>\r\n\r\n                                    {!gmailConnected && (\r\n                                        <div className=\"mt-4 p-3 bg-purple-500/5 border border-purple-500/10 rounded-xl flex items-center justify-between\">\r\n                                            <div className=\"flex items-center gap-2 text-purple-400\">\r\n                                                <MailIcon size={14} />\r\n                                                <span className=\"text-[10px] font-medium\">Connect Gmail for live thread sync</span>\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => window.location.href = `/api/auth/gmail?userId=${user?.uid}`}\r\n                                                className=\"px-2 py-1 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 text-[10px] rounded-lg transition-all\"\r\n                                            >\r\n                                                Connect\r\n                                            </button>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </GlassCard>\r\n                ))}\r\n            </div>\r\n\r\n            {leads.length === 0 && (\r\n                <div className=\"text-center py-20\">\r\n                    <p className=\"text-slate-500 mb-4\">No leads yet. Add your first lead to get started!</p>\r\n                    <button\r\n                        onClick={() => setIsAddModalOpen(true)}\r\n                        className=\"glass-button\"\r\n                    >\r\n                        + Add New Lead\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Bulk Action Bar */}\r\n            <AnimatePresence>\r\n                {selectedLeadIds.size > 0 && (\r\n                    <motion.div\r\n                        initial={{ y: 100, opacity: 0 }}\r\n                        animate={{ y: 0, opacity: 1 }}\r\n                        exit={{ y: 100, opacity: 0 }}\r\n                        className=\"fixed bottom-8 left-1/2 -translate-x-1/2 z-50 px-6 py-3 bg-slate-900/90 backdrop-blur-xl border border-blue-500/30 rounded-full shadow-2xl flex items-center gap-6\"\r\n                    >\r\n                        <div className=\"flex items-center gap-2 border-r border-slate-700 pr-6\">\r\n                            <span className=\"text-blue-400 font-bold\">{selectedLeadIds.size}</span>\r\n                            <span className=\"text-slate-300 text-xs uppercase tracking-widest font-medium\">Selected</span>\r\n                        </div>\r\n\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-[10px] text-slate-500 uppercase font-bold\">Move to:</span>\r\n                                <div className=\"flex gap-1\">\r\n                                    {(['Qualified', 'Proposal', 'Negotiation'] as LeadStatus[]).map(status => (\r\n                                        <button\r\n                                            key={status}\r\n                                            onClick={() => handleBulkStatusUpdate(status)}\r\n                                            className=\"px-2 py-1 text-[10px] bg-slate-800 hover:bg-blue-600/20 border border-slate-700 hover:border-blue-500/40 rounded-md text-slate-300 hover:text-blue-300 transition-all font-medium\"\r\n                                        >\r\n                                            {status}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleBulkDelete}\r\n                                className=\"p-2 text-slate-500 hover:text-red-400 transition-colors\"\r\n                                title=\"Bulk Delete\"\r\n                            >\r\n                                <Trash2 size={18} />\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={() => setSelectedLeadIds(new Set())}\r\n                                className=\"text-xs text-slate-500 hover:text-white transition-colors ml-2\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Modals */}\r\n            <AddLeadModal\r\n                isOpen={isAddModalOpen}\r\n                onClose={() => setIsAddModalOpen(false)}\r\n                onSave={handleAddLead}\r\n            />\r\n\r\n            {selectedLead && (\r\n                <>\r\n                    <AIEmailDraft\r\n                        lead={selectedLead}\r\n                        isOpen={isEmailDraftOpen}\r\n                        onClose={() => {\r\n                            setIsEmailDraftOpen(false);\r\n                            setSelectedLead(null);\r\n                        }}\r\n                    />\r\n\r\n                    {user && (\r\n                        <>\r\n                            <LogCallModal\r\n                                lead={selectedLead}\r\n                                userId={user.uid}\r\n                                isOpen={isCallModalOpen}\r\n                                onClose={() => {\r\n                                    setIsCallModalOpen(false);\r\n                                    setSelectedLead(null);\r\n                                }}\r\n                                onSuccess={handleActivitySuccess}\r\n                            />\r\n\r\n                            <LogMeetingModal\r\n                                lead={selectedLead}\r\n                                userId={user.uid}\r\n                                isOpen={isMeetingModalOpen}\r\n                                onClose={() => {\r\n                                    setIsMeetingModalOpen(false);\r\n                                    setSelectedLead(null);\r\n                                }}\r\n                                onSuccess={handleActivitySuccess}\r\n                            />\r\n\r\n                            <LogReplyModal\r\n                                lead={selectedLead}\r\n                                userId={user.uid}\r\n                                isOpen={isReplyModalOpen}\r\n                                onClose={() => {\r\n                                    setIsReplyModalOpen(false);\r\n                                    setSelectedLead(null);\r\n                                }}\r\n                                onSuccess={handleActivitySuccess}\r\n                            />\r\n                        </>\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\leads\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\leads\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\leads\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { useRouter } from 'next/navigation';\r\nimport { toast } from 'sonner';\r\n\r\nexport default function LoginPage() {\r\n    const { user, loading, signInWithGoogle } = useAuth();\r\n    const router = useRouter();\r\n\r\n    // If already logged in, redirect to dashboard\r\n    React.useEffect(() => {\r\n        if (user && !loading) {\r\n            router.push('/');\r\n        }\r\n    }, [user, loading, router]);\r\n\r\n    const handleGoogleSignIn = async () => {\r\n        try {\r\n            await signInWithGoogle();\r\n            toast.success('Signed in successfully!');\r\n            router.push('/');\r\n        } catch (error: any) {\r\n            // Ignore if user closed the popup\r\n            if (error?.code === 'auth/popup-closed-by-user' || error?.message?.includes('closed-by-user')) {\r\n                return;\r\n            }\r\n            console.error('Sign in error:', error);\r\n            toast.error('Failed to sign in. Please try again.');\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-slate-950\">\r\n                <div className=\"w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-950 p-4\">\r\n            {/* Background Effects */}\r\n            <div className=\"absolute inset-0 overflow-hidden\">\r\n                <div className=\"absolute -top-40 -right-40 w-96 h-96 rounded-full bg-indigo-500/10 blur-3xl\" />\r\n                <div className=\"absolute -bottom-40 -left-40 w-96 h-96 rounded-full bg-violet-500/10 blur-3xl\" />\r\n            </div>\r\n\r\n            {/* Login Card */}\r\n            <div className=\"relative z-10 w-full max-w-md\">\r\n                <div className=\"bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl\">\r\n                    {/* Logo */}\r\n                    <div className=\"text-center mb-8\">\r\n                        <h1 className=\"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-violet-400\">\r\n                            SalesTracker\r\n                        </h1>\r\n                        <p className=\"text-slate-400 mt-2\">AI-Powered Sales Performance</p>\r\n                    </div>\r\n\r\n                    {/* Welcome Message */}\r\n                    <div className=\"text-center mb-8\">\r\n                        <h2 className=\"text-xl font-semibold text-white mb-2\">Welcome Back</h2>\r\n                        <p className=\"text-slate-400 text-sm\">\r\n                            Sign in to access your leads, activities, and AI-powered email tools.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Sign In Button */}\r\n                    <button\r\n                        onClick={handleGoogleSignIn}\r\n                        className=\"w-full flex items-center justify-center gap-3 px-6 py-4 bg-white hover:bg-gray-100 text-gray-800 font-medium rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl group\"\r\n                    >\r\n                        {/* Google Logo */}\r\n                        <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                            <path\r\n                                fill=\"#4285F4\"\r\n                                d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\r\n                            />\r\n                            <path\r\n                                fill=\"#34A853\"\r\n                                d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\r\n                            />\r\n                            <path\r\n                                fill=\"#FBBC05\"\r\n                                d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\r\n                            />\r\n                            <path\r\n                                fill=\"#EA4335\"\r\n                                d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\r\n                            />\r\n                        </svg>\r\n                        <span>Sign in with Google</span>\r\n                    </button>\r\n\r\n                    {/* Demo Mode Notice */}\r\n                    <div className=\"mt-6 p-4 bg-slate-800/50 border border-slate-700 rounded-lg\">\r\n                        <p className=\"text-sm text-slate-400 text-center\">\r\n                            <span className=\"text-amber-400\"> Tip:</span> Use your Google account to get started instantly.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Features Preview */}\r\n                    <div className=\"mt-8 pt-6 border-t border-slate-700\">\r\n                        <p className=\"text-xs text-slate-500 text-center mb-4\">WHAT YOU&apos;LL GET ACCESS TO</p>\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            {[\r\n                                { icon: '', label: 'Lead Pipeline' },\r\n                                { icon: '', label: 'Gmail Sync' },\r\n                                { icon: '', label: 'AI Emails' },\r\n                                { icon: '', label: 'Analytics' },\r\n                            ].map((feature) => (\r\n                                <div\r\n                                    key={feature.label}\r\n                                    className=\"flex items-center gap-2 p-2 bg-slate-800/30 rounded-lg text-sm text-slate-300\"\r\n                                >\r\n                                    <span>{feature.icon}</span>\r\n                                    <span>{feature.label}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <p className=\"text-center text-slate-600 text-xs mt-6\">\r\n                    By signing in, you agree to our Terms of Service\r\n                </p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadMetrics'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [user, authLoading, loadMetrics]","fix":{"range":[1760,1779],"text":"[user, authLoading, loadMetrics]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { DashboardService } from '@/lib/firebase/services';\r\nimport { formatCurrency } from '@/lib/utils/formatters';\r\nimport { TrendingUp, TrendingDown, Phone, Users, DollarSign, Calendar } from 'lucide-react';\r\n\r\n// Fallback mock data when not logged in\r\nconst MOCK_ACTIVITY_DATA = [\r\n  { day: 'Mon', dials: 52, connects: 6 },\r\n  { day: 'Tue', dials: 48, connects: 5 },\r\n  { day: 'Wed', dials: 55, connects: 8 },\r\n  { day: 'Thu', dials: 45, connects: 4 },\r\n  { day: 'Fri', dials: 38, connects: 3 },\r\n  { day: 'Sat', dials: 12, connects: 1 },\r\n  { day: 'Sun', dials: 0, connects: 0 },\r\n];\r\n\r\nconst MOCK_PIPELINE_STAGES = [\r\n  { stage: 'New Leads', count: 12, color: 'bg-blue-500' },\r\n  { stage: 'Contacted', count: 8, color: 'bg-cyan-500' },\r\n  { stage: 'Qualified', count: 6, color: 'bg-purple-500' },\r\n  { stage: 'Proposal', count: 4, color: 'bg-amber-500' },\r\n  { stage: 'Negotiation', count: 2, color: 'bg-green-500' },\r\n];\r\n\r\ninterface DashboardMetrics {\r\n  dials: number;\r\n  pipelineValue: number;\r\n  meetingsHeld: number;\r\n  pipelineStatusCounts: Record<string, number>;\r\n  totalLeads: number;\r\n  emailsSent: number;\r\n  activityChart: { day: string; dials: number; connects: number }[];\r\n}\r\n\r\nexport default function Dashboard() {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [metrics, setMetrics] = useState<DashboardMetrics | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (authLoading) return;\r\n\r\n    if (!user) {\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    loadMetrics();\r\n  }, [user, authLoading]);\r\n\r\n  const loadMetrics = async () => {\r\n    if (!user) return;\r\n    setIsLoading(true);\r\n    try {\r\n      const data = await DashboardService.getMetrics(user.uid);\r\n      setMetrics(data);\r\n    } catch (error) {\r\n      console.error('Error loading metrics:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <main className=\"min-h-screen p-8 flex items-center justify-center\">\r\n        <div className=\"text-slate-500\">Loading dashboard...</div>\r\n      </main>\r\n    );\r\n  }\r\n\r\n  // Use real data if available, otherwise use mock data\r\n  const activityData = metrics?.activityChart || MOCK_ACTIVITY_DATA;\r\n  const pipelineStages = metrics ? [\r\n    { stage: 'New Leads', count: metrics.pipelineStatusCounts['New'] || 0, color: 'bg-blue-500' },\r\n    { stage: 'Contacted', count: metrics.pipelineStatusCounts['Contacted'] || 0, color: 'bg-cyan-500' },\r\n    { stage: 'Qualified', count: metrics.pipelineStatusCounts['Qualified'] || 0, color: 'bg-purple-500' },\r\n    { stage: 'Proposal', count: metrics.pipelineStatusCounts['Proposal'] || 0, color: 'bg-amber-500' },\r\n    { stage: 'Negotiation', count: metrics.pipelineStatusCounts['Negotiation'] || 0, color: 'bg-green-500' },\r\n  ] : MOCK_PIPELINE_STAGES;\r\n\r\n  const maxDials = Math.max(...activityData.map(d => d.dials));\r\n  const totalDials = metrics?.dials ?? activityData.reduce((sum, d) => sum + d.dials, 0);\r\n  const totalConnects = activityData.reduce((sum, d) => sum + d.connects, 0);\r\n  const connectRate = totalDials > 0 ? ((totalConnects / totalDials) * 100).toFixed(1) : '0';\r\n  const pipelineValue = metrics?.pipelineValue ?? 124000;\r\n  const meetingsHeld = metrics?.meetingsHeld ?? 12;\r\n  const totalLeads = metrics?.totalLeads ?? pipelineStages.reduce((sum, s) => sum + s.count, 0);\r\n\r\n  return (\r\n    <main className=\"min-h-screen p-8\">\r\n      <header className=\"mb-8\">\r\n        <h1 className=\"text-4xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-violet-400\">\r\n          Sales &amp; Lead Tracking\r\n        </h1>\r\n        <p className=\"text-slate-400\">\r\n          {user ? 'Real-time performance metrics' : 'Demo Mode - Log in to see your data'}\r\n        </p>\r\n      </header>\r\n\r\n      {/* KPI Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n        <GlassCard>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-sm text-slate-400 font-medium\">Today&apos;s Dials</h3>\r\n              <div className=\"text-3xl font-bold text-blue-400 mt-2\">{totalDials}</div>\r\n              <div className=\"flex items-center gap-1 mt-1\">\r\n                <TrendingUp className=\"w-3 h-3 text-green-400\" />\r\n                <span className=\"text-xs text-green-400\">Keep it up!</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-blue-500/20 rounded-lg\">\r\n              <Phone className=\"w-6 h-6 text-blue-400\" />\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n\r\n        <GlassCard>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-sm text-slate-400 font-medium\">Connect Rate</h3>\r\n              <div className=\"text-3xl font-bold text-green-400 mt-2\">{connectRate}%</div>\r\n              <div className=\"flex items-center gap-1 mt-1\">\r\n                <TrendingUp className=\"w-3 h-3 text-green-400\" />\r\n                <span className=\"text-xs text-green-400\">Above target (3-10%)</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-green-500/20 rounded-lg\">\r\n              <Users className=\"w-6 h-6 text-green-400\" />\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n\r\n        <GlassCard>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-sm text-slate-400 font-medium\">Pipeline Value</h3>\r\n              <div className=\"text-3xl font-bold text-violet-400 mt-2\">{formatCurrency(pipelineValue, { compact: true })}</div>\r\n              <div className=\"flex items-center gap-1 mt-1\">\r\n                <TrendingDown className=\"w-3 h-3 text-amber-400\" />\r\n                <span className=\"text-xs text-slate-500\">Forecast: {formatCurrency(pipelineValue * 0.7, { compact: true })}</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-violet-500/20 rounded-lg\">\r\n              <DollarSign className=\"w-6 h-6 text-violet-400\" />\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n\r\n        <GlassCard>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"text-sm text-slate-400 font-medium\">Meetings This Week</h3>\r\n              <div className=\"text-3xl font-bold text-amber-400 mt-2\">{meetingsHeld}</div>\r\n              <div className=\"flex items-center gap-1 mt-1\">\r\n                <TrendingUp className=\"w-3 h-3 text-green-400\" />\r\n                <span className=\"text-xs text-green-400\">Great progress!</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-amber-500/20 rounded-lg\">\r\n              <Calendar className=\"w-6 h-6 text-amber-400\" />\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n      </div>\r\n\r\n      {/* Main Content Grid */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        {/* Activity Chart */}\r\n        <GlassCard className=\"lg:col-span-2 min-h-[400px]\">\r\n          <h2 className=\"text-xl font-semibold mb-6\">Activity Performance</h2>\r\n          <div className=\"flex items-end justify-between h-64 gap-2 px-4\">\r\n            {activityData.map((data) => (\r\n              <div key={data.day} className=\"flex-1 flex flex-col items-center gap-2\">\r\n                <div className=\"w-full flex flex-col items-center gap-1\" style={{ height: '200px' }}>\r\n                  {/* Connects bar (smaller, on top) */}\r\n                  <div\r\n                    className=\"w-3 bg-green-500 rounded-t transition-all\"\r\n                    style={{\r\n                      height: maxDials > 0 ? `${(data.connects / maxDials) * 200}px` : '0px',\r\n                      marginTop: 'auto'\r\n                    }}\r\n                    title={`${data.connects} connects`}\r\n                  />\r\n                  {/* Dials bar */}\r\n                  <div\r\n                    className=\"w-full max-w-[40px] bg-gradient-to-t from-blue-600 to-blue-400 rounded-t transition-all\"\r\n                    style={{\r\n                      height: maxDials > 0 ? `${(data.dials / maxDials) * 200}px` : '0px',\r\n                    }}\r\n                    title={`${data.dials} dials`}\r\n                  />\r\n                </div>\r\n                <span className=\"text-xs text-slate-500\">{data.day}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex justify-center gap-6 mt-4 pt-4 border-t border-slate-800\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"w-3 h-3 bg-blue-500 rounded\" />\r\n              <span className=\"text-xs text-slate-400\">Dials</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"w-3 h-3 bg-green-500 rounded\" />\r\n              <span className=\"text-xs text-slate-400\">Connects</span>\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n\r\n        {/* Lead Status */}\r\n        <GlassCard className=\"min-h-[400px]\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">Pipeline Status</h2>\r\n          <div className=\"space-y-4\">\r\n            {pipelineStages.map((item) => (\r\n              <div key={item.stage} className=\"group\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <span className=\"text-sm font-medium text-slate-300\">{item.stage}</span>\r\n                  <span className=\"text-sm font-bold text-white\">{item.count}</span>\r\n                </div>\r\n                <div className=\"h-2 bg-slate-800 rounded-full overflow-hidden\">\r\n                  <div\r\n                    className={`h-full ${item.color} transition-all group-hover:opacity-80`}\r\n                    style={{ width: `${totalLeads > 0 ? (item.count / totalLeads) * 100 : 0}%` }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"mt-6 pt-4 border-t border-slate-800\">\r\n            <div className=\"flex justify-between text-sm\">\r\n              <span className=\"text-slate-400\">Total in Pipeline</span>\r\n              <span className=\"text-white font-bold\">\r\n                {totalLeads} leads\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </GlassCard>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\pricing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\privacy\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (&quot;we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (&ldquo;we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (&#34;we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (&rdquo;we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":46,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,&quot; \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,&ldquo; \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,&#34; \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,&rdquo; \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":48,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" &quot;our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" &ldquo;our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" &#34;our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" &rdquo;our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,&quot; or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,&ldquo; or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,&#34; or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,&rdquo; or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":58,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or &quot;us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or &ldquo;us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or &#34;us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or &rdquo;us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":23,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or \"us&quot;) is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or \"us&ldquo;) is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or \"us&#34;) is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[978,1230],"text":"\r\n                        SalesTracker AI (\"we,\" \"our,\" or \"us&rdquo;) is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\n\r\nexport const metadata = {\r\n    title: 'Privacy Policy',\r\n    description: 'Our commitment to protecting your data and privacy.',\r\n};\r\n\r\nexport default function PrivacyPage() {\r\n    const lastUpdated = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });\r\n\r\n    return (\r\n        <div className=\"p-8 max-w-4xl mx-auto min-h-screen\">\r\n            <header className=\"mb-12 text-center\">\r\n                <h1 className=\"text-4xl font-bold text-white mb-4\">Privacy Policy</h1>\r\n                <p className=\"text-slate-500\">Last Updated: {lastUpdated}</p>\r\n            </header>\r\n\r\n            <GlassCard className=\"prose prose-invert max-w-none\">\r\n                <section className=\"mb-8\">\r\n                    <h2 className=\"text-xl font-semibold text-blue-400 mb-4\">1. Introduction</h2>\r\n                    <p className=\"text-slate-300 leading-relaxed\">\r\n                        SalesTracker AI (\"we,\" \"our,\" or \"us\") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our web application.\r\n                    </p>\r\n                </section>\r\n\r\n                <section className=\"mb-8 border-t border-white/5 pt-8\">\r\n                    <h2 className=\"text-xl font-semibold text-blue-400 mb-4\">2. Information Collection</h2>\r\n                    <p className=\"text-slate-300 leading-relaxed\">\r\n                        We collect information that you provide directly to us when you create an account, update your profile, or use our features. This may include:\r\n                    </p>\r\n                    <ul className=\"list-disc list-inside text-slate-400 mt-2 space-y-1\">\r\n                        <li>Contact information (Name, Email, Phone)</li>\r\n                        <li>Professional information (Company, Industry, Lead data)</li>\r\n                        <li>Usage data and interactions with AI features</li>\r\n                    </ul>\r\n                </section>\r\n\r\n                <section className=\"mb-8 border-t border-white/5 pt-8\">\r\n                    <h2 className=\"text-xl font-semibold text-blue-400 mb-4\">3. Use of Information</h2>\r\n                    <p className=\"text-slate-300 leading-relaxed\">\r\n                        We use the information we collect to:\r\n                    </p>\r\n                    <ul className=\"list-disc list-inside text-slate-400 mt-2 space-y-1\">\r\n                        <li>Provide and maintain our AI-powered sales tools</li>\r\n                        <li>Personalize your training and simulation experiences</li>\r\n                        <li>Process transactions and manage billing</li>\r\n                        <li>Analyze usage trends to improve our services</li>\r\n                    </ul>\r\n                </section>\r\n\r\n                <section className=\"mb-8 border-t border-white/5 pt-8\">\r\n                    <h2 className=\"text-xl font-semibold text-blue-400 mb-4\">4. Data Security</h2>\r\n                    <p className=\"text-slate-300 leading-relaxed\">\r\n                        We implement industrial-standard security measures including TLS 1.3 encryption and secure server-side processing to protect your data. However, no method of transmission over the internet is 100% secure.\r\n                    </p>\r\n                </section>\r\n\r\n                <section className=\"mb-8 border-t border-white/5 pt-8\">\r\n                    <h2 className=\"text-xl font-semibold text-blue-400 mb-4\">5. Your Rights</h2>\r\n                    <p className=\"text-slate-300 leading-relaxed\">\r\n                        Depending on your location, you may have rights regarding your personal data, including the right to access, correct, or delete your information. Contact us to exercise these rights.\r\n                    </p>\r\n                </section>\r\n\r\n                <footer className=\"mt-12 text-sm text-slate-500 italic\">\r\n                    For privacy-related inquiries, please contact privacy@salestracker-ai.com\r\n                </footer>\r\n            </GlassCard>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\reality-link\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mic' is defined but never used.","line":9,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Radio' is defined but never used.","line":9,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":9,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":10,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":10,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setActiveLead' is assigned a value but never used.","line":22,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":23,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { ResourcesService } from '@/lib/firebase/resources';\r\nimport { Resource } from '@/types';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport {\r\n    Mic, MicOff, Radio, Zap, ExternalLink,\r\n    AlertTriangle, Shield, CheckCircle, Search,\r\n    Terminal, Activity, Sparkles, XCircle\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nexport default function RealityLinkPage() {\r\n    const { user } = useAuth();\r\n    const [isListening, setIsListening] = useState(false);\r\n    const [transcript, setTranscript] = useState('');\r\n    const [companyResources, setCompanyResources] = useState<Resource[]>([]);\r\n    const [activeCards, setActiveCards] = useState<Resource[]>([]);\r\n    const [aiTactics, setAiTactics] = useState<string[]>([]);\r\n    const [activeLead, setActiveLead] = useState({ name: 'Jordan Smith', company: 'Global Tech Inc.', value: '$45,000', status: 'Negotiation' });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Simulating \"Live\" typing\r\n    const typingInterval = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    // Fetch resources on mount\r\n    useEffect(() => {\r\n        async function fetchResources() {\r\n            if (!user) return;\r\n            try {\r\n                // Determine potential \"Battle Cards\" from shared resources\r\n                const data = await ResourcesService.getCompanyResources();\r\n                setCompanyResources(data);\r\n            } catch (e) {\r\n                console.error(e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n        fetchResources();\r\n    }, [user]);\r\n\r\n    // Matching Logic\r\n    useEffect(() => {\r\n        if (!transcript) return;\r\n\r\n        // Simple fuzzy match: Check if resource title or key words appear in transcript\r\n        const lastSentence = transcript.split('.').pop()?.toLowerCase() || '';\r\n\r\n        const matched = companyResources.filter(res => {\r\n            // Match against title\r\n            if (lastSentence.includes(res.title.toLowerCase())) return true;\r\n            // Match against category\r\n            if (lastSentence.includes(res.category.toLowerCase())) return true;\r\n\r\n            // Heuristic matches (hardcoded for demo flair)\r\n            if (res.title.toLowerCase().includes('competitor') && lastSentence.includes('competitor')) return true;\r\n            if (res.title.toLowerCase().includes('security') && lastSentence.includes('security')) return true;\r\n            if (res.title.toLowerCase().includes('pricing') && (lastSentence.includes('price') || lastSentence.includes('cost'))) return true;\r\n\r\n            return false;\r\n        });\r\n\r\n        // Add matches to active cards if not already present\r\n        if (matched.length > 0) {\r\n            setActiveCards(prev => {\r\n                const newCards = matched.filter(m => !prev.find(p => p.id === m.id));\r\n                if (newCards.length > 0) {\r\n                    // Flash effect\r\n                    toast(`${newCards.length} Battle Card${newCards.length > 1 ? 's' : ''} Detected!`);\r\n                }\r\n                return [...newCards, ...prev].slice(0, 5); // Keep top 5\r\n            });\r\n\r\n            // Generate \"Tactics\" based on matches\r\n            const newTactics: string[] = [];\r\n            matched.forEach(res => {\r\n                if (res.title.toLowerCase().includes('competitor')) {\r\n                    newTactics.push(\"Strategy: Use 'The Differentiator' script to highlight our unique AI moat.\");\r\n                }\r\n                if (res.category.toLowerCase().includes('pricing')) {\r\n                    newTactics.push(\"Tactic: Shift focus to 'Cost of Inaction' rather than Implementation Fee.\");\r\n                }\r\n                if (res.title.toLowerCase().includes('security')) {\r\n                    newTactics.push(\"Advice: Mention our dual-layer encryption and ISO compliance immediately.\");\r\n                }\r\n            });\r\n            if (newTactics.length > 0) {\r\n                setAiTactics(prev => [...new Set([...newTactics, ...prev])].slice(0, 3));\r\n            }\r\n        }\r\n\r\n    }, [transcript, companyResources]);\r\n\r\n    // Simuation Scripts\r\n    const startSimulation = (type: 'competitor' | 'security' | 'pricing') => {\r\n        setIsListening(true);\r\n        setTranscript('');\r\n        setActiveCards([]);\r\n\r\n        let script = '';\r\n        if (type === 'competitor') {\r\n            script = \"Yeah so we've been looking at Competitor X recently. They seem to have good features. Also I heard their pricing is lower.\";\r\n        } else if (type === 'security') {\r\n            script = \"My main concern right now is compliance. We have strict ISO 27001 requirements. How do you handle data security?\";\r\n        } else if (type === 'pricing') {\r\n            script = \"Basically we don't have budget for this. Your implementation costs are just too high compared to what we're paying now.\";\r\n        }\r\n\r\n        let i = 0;\r\n        if (typingInterval.current) clearInterval(typingInterval.current);\r\n\r\n        typingInterval.current = setInterval(() => {\r\n            if (i < script.length) {\r\n                setTranscript(prev => prev + script.charAt(i));\r\n                i++;\r\n            } else {\r\n                if (typingInterval.current) clearInterval(typingInterval.current);\r\n                setIsListening(false);\r\n            }\r\n        }, 50); // Typing speed\r\n    };\r\n\r\n    const toggleListening = () => {\r\n        setIsListening(!isListening);\r\n        if (!isListening) {\r\n            setTranscript('');\r\n            setActiveCards([]);\r\n        } else {\r\n            if (typingInterval.current) clearInterval(typingInterval.current);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-[#050b14] text-slate-200 font-sans p-6 overflow-hidden flex flex-col relative\">\r\n\r\n            {/* Background Effects */}\r\n            <div className=\"absolute inset-0 z-0 opacity-20 pointer-events-none\">\r\n                <div className=\"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-blue-500 to-transparent\"></div>\r\n                <div className=\"absolute bottom-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-purple-500 to-transparent\"></div>\r\n                <div className=\"absolute inset-y-0 left-0 w-px bg-gradient-to-b from-transparent via-blue-500 to-transparent\"></div>\r\n                <div className=\"absolute inset-y-0 right-0 w-px bg-gradient-to-b from-transparent via-purple-500 to-transparent\"></div>\r\n            </div>\r\n\r\n            {/* Header HUD */}\r\n            <header className=\"relative z-10 flex justify-between items-center mb-8 pb-4 border-b border-white/5\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"relative\">\r\n                        <div className={`w-3 h-3 rounded-full ${isListening ? 'bg-red-500 animate-pulse' : 'bg-slate-600'}`}></div>\r\n                        {isListening && <div className=\"absolute inset-0 rounded-full bg-red-500 animate-ping opacity-50\"></div>}\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-white tracking-widest uppercase flex items-center gap-2\">\r\n                            Reality Link <span className=\"text-xs bg-blue-900/50 text-blue-400 px-2 py-0.5 rounded border border-blue-500/30\">V.1.0</span>\r\n                        </h1>\r\n                        <p className=\"text-xs text-slate-500 font-mono\">LIVE AUDIO INTELLIGENCE FEED</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"hidden md:flex items-center gap-6 px-4 py-2 bg-slate-900/50 border border-white/5 rounded-full\">\r\n                        <div className=\"text-center\">\r\n                            <div className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Latency</div>\r\n                            <div className=\"text-sm font-mono text-green-400\">12ms</div>\r\n                        </div>\r\n                        <div className=\"w-px h-6 bg-white/10\"></div>\r\n                        <div className=\"text-center\">\r\n                            <div className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Resources</div>\r\n                            <div className=\"text-sm font-mono text-blue-400\">{companyResources.length}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex-1 grid grid-cols-1 lg:grid-cols-12 gap-6 relative z-10 min-h-0\">\r\n\r\n                {/* Visualizer & Transcript (Left) */}\r\n                <div className=\"lg:col-span-6 flex flex-col gap-6\">\r\n\r\n                    {/* Visualizer Area */}\r\n                    <div className=\"h-48 rounded-2xl border border-white/10 bg-slate-900/50 backdrop-blur relative overflow-hidden flex items-center justify-center group\">\r\n                        {isListening ? (\r\n                            <div className=\"flex items-center gap-1 h-20\">\r\n                                {[...Array(20)].map((_, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        className=\"w-2 bg-blue-500/80 rounded-full animate-wave\"\r\n                                        style={{\r\n                                            height: `${Math.random() * 100}%`,\r\n                                            animationDuration: `${0.5 + Math.random() * 0.5}s`\r\n                                        }}\r\n                                    ></div>\r\n                                ))}\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"text-center\">\r\n                                <MicOff className=\"w-12 h-12 text-slate-700 mx-auto mb-2\" />\r\n                                <div className=\"text-slate-500 font-mono text-sm\">AUDIO FEED OFFLINE</div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Status Overlay */}\r\n                        <div className=\"absolute top-4 left-4 flex gap-2\">\r\n                            <button\r\n                                onClick={toggleListening}\r\n                                className={`px-3 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider border transition-all ${isListening\r\n                                    ? 'bg-red-500/20 text-red-400 border-red-500/50 hover:bg-red-500/30'\r\n                                    : 'bg-green-500/20 text-green-400 border-green-500/50 hover:bg-green-500/30'}`}\r\n                            >\r\n                                {isListening ? 'Stop Feed' : 'Start Feed'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Simulation Controls (Demo) */}\r\n                    <div className=\"flex gap-3 overflow-x-auto pb-2\">\r\n                        <button onClick={() => startSimulation('competitor')} className=\"px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:border-blue-500 hover:text-blue-400 text-xs font-mono uppercase transition-colors whitespace-nowrap\">\r\n                            Simulate: Competitor Mention\r\n                        </button>\r\n                        <button onClick={() => startSimulation('security')} className=\"px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:border-orange-500 hover:text-orange-400 text-xs font-mono uppercase transition-colors whitespace-nowrap\">\r\n                            Simulate: Security Audit\r\n                        </button>\r\n                        <button onClick={() => startSimulation('pricing')} className=\"px-4 py-2 rounded-lg bg-slate-800 border border-slate-700 hover:border-green-500 hover:text-green-400 text-xs font-mono uppercase transition-colors whitespace-nowrap\">\r\n                            Simulate: Pricing Objection\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Transcript Log */}\r\n                    <div className=\"flex-1 bg-black/40 border border-white/5 rounded-2xl p-6 relative overflow-hidden\">\r\n                        <div className=\"absolute top-4 right-4 text-[10px] font-mono text-slate-600 uppercase tracking-widest flex items-center gap-2\">\r\n                            <Terminal size={12} /> Transcript Log\r\n                        </div>\r\n                        <div className=\"font-mono text-lg text-slate-300 leading-relaxed whitespace-pre-wrap\">\r\n                            {transcript || <span className=\"text-slate-700 animate-pulse\">Waiting for audio speech...</span>}\r\n                            {isListening && <span className=\"inline-block w-2.5 h-5 bg-blue-500 ml-1 animate-blink align-middle\"></span>}\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n\r\n                {/* AI Strategy Stream & Lead Context (Center/Right) */}\r\n                <div className=\"lg:col-span-3 flex flex-col gap-6 h-full min-h-0\">\r\n                    <h2 className=\"text-sm font-bold text-slate-400 opacity-50 uppercase tracking-widest flex items-center gap-2\">\r\n                        <Activity size={14} className=\"text-blue-500\" />\r\n                        AI Strategy Stream\r\n                    </h2>\r\n\r\n                    <div className=\"flex flex-col gap-4\">\r\n                        {aiTactics.length === 0 ? (\r\n                            <div className=\"p-4 rounded-xl border border-white/5 bg-white/5 text-slate-600 text-xs font-mono italic animate-pulse\">\r\n                                ANALYZING DEAL DYNAMICS...\r\n                            </div>\r\n                        ) : (\r\n                            aiTactics.map((tactic, i) => (\r\n                                <div key={i} className=\"p-4 rounded-xl border border-blue-500/20 bg-blue-500/5 animate-in slide-in-from-top-2\">\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <Sparkles size={12} className=\"text-blue-400\" />\r\n                                        <span className=\"text-[10px] font-bold text-blue-400 uppercase\">Live Intelligence</span>\r\n                                    </div>\r\n                                    <p className=\"text-xs text-slate-300 font-medium leading-relaxed\">{tactic}</p>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n\r\n                    <h2 className=\"text-sm font-bold text-slate-400 opacity-50 uppercase tracking-widest mt-4\">Active Lead Context</h2>\r\n                    <GlassCard className=\"!p-4 border-l-2 border-l-blue-500\">\r\n                        <div className=\"flex items-center gap-3 mb-4\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-white font-bold\">\r\n                                JS\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-sm font-bold text-white\">{activeLead.name}</div>\r\n                                <div className=\"text-[10px] text-slate-500\">{activeLead.company}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div>\r\n                                <div className=\"text-[10px] text-slate-500 uppercase\">Deal Value</div>\r\n                                <div className=\"text-sm font-mono text-green-400 font-bold\">{activeLead.value}</div>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"text-[10px] text-slate-500 uppercase\">Stage</div>\r\n                                <div className=\"text-sm text-blue-400 font-bold\">{activeLead.status}</div>\r\n                            </div>\r\n                        </div>\r\n                    </GlassCard>\r\n                </div>\r\n\r\n                {/* Battle Cards (Right) */}\r\n                <div className=\"lg:col-span-3 flex flex-col h-full min-h-0\">\r\n                    <h2 className=\"text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center justify-between\">\r\n                        <span>Live Battle Cards</span>\r\n                        <span className=\"bg-blue-600 text-white text-[10px] px-1.5 py-0.5 rounded-full\">{activeCards.length}</span>\r\n                    </h2>\r\n\r\n                    <div className=\"flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar\">\r\n                        {activeCards.length === 0 ? (\r\n                            <div className=\"h-64 border-2 border-dashed border-slate-800 rounded-xl flex flex-col items-center justify-center text-center p-6 opacity-50\">\r\n                                <Search className=\"w-12 h-12 text-slate-700 mb-2\" />\r\n                                <div className=\"text-slate-500 font-medium\">Scanning for Context...</div>\r\n                                <p className=\"text-xs text-slate-600 mt-2\">AI will surface relevant enablement materials here automatically.</p>\r\n                            </div>\r\n                        ) : (\r\n                            activeCards.map((card, idx) => (\r\n                                <div\r\n                                    key={card.id}\r\n                                    className=\"animate-in slide-in-from-right-4 fade-in duration-500 fill-mode-forwards\"\r\n                                    style={{ animationDelay: `${idx * 100}ms` }}\r\n                                >\r\n                                    <div className=\"bg-slate-900/80 border border-blue-500/30 rounded-xl p-4 shadow-[0_0_20px_rgba(59,130,246,0.15)] relative overflow-hidden group hover:border-blue-500/60 transition-colors\">\r\n\r\n                                        {/* Glow Effect */}\r\n                                        <div className=\"absolute top-0 right-0 w-24 h-24 bg-blue-500/10 blur-2xl -translate-y-1/2 translate-x-1/2 rounded-full pointer-events-none\"></div>\r\n\r\n                                        <div className=\"flex justify-between items-start mb-2 relative z-10\">\r\n                                            <div className=\"px-2 py-0.5 rounded bg-blue-500/10 text-blue-400 text-[10px] font-bold uppercase border border-blue-500/20\">\r\n                                                {card.category} Match\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => setActiveCards(prev => prev.filter(p => p.id !== card.id))}\r\n                                                className=\"text-slate-600 hover:text-white transition-colors\"\r\n                                            >\r\n                                                <XCircle size={16} />\r\n                                            </button>\r\n                                        </div>\r\n\r\n                                        <h3 className=\"text-lg font-bold text-white mb-1 group-hover:text-blue-300 transition-colors\">{card.title}</h3>\r\n                                        <p className=\"text-xs text-slate-400 mb-4 line-clamp-2\">{card.description}</p>\r\n\r\n                                        <a\r\n                                            href={card.url}\r\n                                            target=\"_blank\"\r\n                                            rel=\"noreferrer\"\r\n                                            className=\"w-full flex items-center justify-center gap-2 py-2 bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold uppercase rounded-lg transition-all shadow-lg hover:shadow-blue-500/25\"\r\n                                        >\r\n                                            <ExternalLink size={14} /> Open Resource\r\n                                        </a>\r\n\r\n                                    </div>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            <style jsx>{`\r\n                @keyframes blink {\r\n                    0%, 100% { opacity: 1; }\r\n                    50% { opacity: 0; }\r\n                }\r\n                .animate-blink {\r\n                    animation: blink 1s step-end infinite;\r\n                }\r\n                @keyframes wave {\r\n                    0%, 100% { height: 10%; }\r\n                    50% { height: 100%; }\r\n                }\r\n                .animate-wave {\r\n                    animation-iteration-count: infinite;\r\n                    animation-timing-function: ease-in-out;\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\resources\\ResourcesClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":27,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { Badge } from '@/components/ui/Badge';\r\nimport { Resource, ResourceCategory } from '@/types';\r\nimport { MOCK_RESOURCES } from '@/lib/mock-data/resources'; // Keep for defaults\r\nimport { ResourcesService } from '@/lib/firebase/resources';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { Search, FileText, Video, Link as LinkIcon, Download, FileSpreadsheet, Presentation, Plus, X, UploadCloud, Loader2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\nconst CATEGORIES: ResourceCategory[] = [\r\n    'Playbook', 'Learning', 'Prospecting', 'Templates',\r\n    'Competitive', 'Operational', 'Scheduling', 'Brand', 'Insights'\r\n];\r\n\r\nexport default function ResourcesClient() {\r\n    const { user } = useAuth();\r\n    const [activeTab, setActiveTab] = useState<'mine' | 'company'>('mine');\r\n    const [activeCategory, setActiveCategory] = useState<ResourceCategory | 'All'>('All');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    const [userResources, setUserResources] = useState<Resource[]>([]);\r\n    const [companyResources, setCompanyResources] = useState<Resource[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isUploadOpen, setIsUploadOpen] = useState(false);\r\n\r\n    // Upload State\r\n    const [uploadFile, setUploadFile] = useState<File | null>(null);\r\n    const [uploadCategory, setUploadCategory] = useState<ResourceCategory>('Playbook');\r\n    const [uploadDesc, setUploadDesc] = useState('');\r\n    const [uploadVisibility, setUploadVisibility] = useState<'private' | 'company'>('private');\r\n    const [isUploading, setIsUploading] = useState(false);\r\n\r\n    // Fetch Resources\r\n    useEffect(() => {\r\n        async function fetchResources() {\r\n            setLoading(true);\r\n            try {\r\n                // Always fetch company resources\r\n                const companyData = await ResourcesService.getCompanyResources();\r\n                setCompanyResources(companyData);\r\n\r\n                // Fetch user resources if logged in\r\n                if (user?.uid) {\r\n                    const userData = await ResourcesService.getUserResources(user.uid);\r\n                    setUserResources(userData);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch resources:\", error);\r\n                toast.error(\"Failed to load resources.\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n\r\n        fetchResources();\r\n    }, [user?.uid]);\r\n\r\n    const handleUpload = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!uploadFile || !user?.uid) return;\r\n\r\n        setIsUploading(true);\r\n        try {\r\n            await ResourcesService.uploadResource(user.uid, uploadFile, uploadCategory, uploadDesc, uploadVisibility);\r\n            toast.success(\"Resource uploaded successfully!\");\r\n\r\n            // Refresh list\r\n            if (user?.uid) {\r\n                const userData = await ResourcesService.getUserResources(user.uid);\r\n                setUserResources(userData);\r\n            }\r\n            const companyData = await ResourcesService.getCompanyResources();\r\n            setCompanyResources(companyData);\r\n\r\n            // Reset form\r\n            setUploadFile(null);\r\n            setUploadDesc('');\r\n            setUploadVisibility('private');\r\n            setIsUploadOpen(false);\r\n        } catch (error) {\r\n            console.error(\"Upload failed:\", error);\r\n            toast.error(\"Failed to upload resource.\");\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    const displayResources = activeTab === 'mine' ? userResources : companyResources;\r\n\r\n    // Merge Mock data (System Resources) with User Resources ONLY if in Company View? \r\n    // Actually, MOCK_RESOURCES are usually global, so let's put them in Company view.\r\n    const allResources = activeTab === 'company' ? [...displayResources, ...MOCK_RESOURCES] : displayResources;\r\n\r\n    const filteredResources = allResources.filter(resource => {\r\n        const matchesCategory = activeCategory === 'All' || resource.category === activeCategory;\r\n        const matchesSearch = resource.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            resource.description.toLowerCase().includes(searchQuery.toLowerCase());\r\n        return matchesCategory && matchesSearch;\r\n    });\r\n\r\n    const getIcon = (type: string) => {\r\n        switch (type) {\r\n            case 'video': return <Video className=\"w-5 h-5 text-red-400\" />;\r\n            case 'deck': return <Presentation className=\"w-5 h-5 text-orange-400\" />;\r\n            case 'sheet': return <FileSpreadsheet className=\"w-5 h-5 text-green-400\" />;\r\n            case 'link': return <LinkIcon className=\"w-5 h-5 text-blue-400\" />;\r\n            default: return <FileText className=\"w-5 h-5 text-slate-300\" />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex h-screen bg-[#0b1121]\">\r\n            {/* Category Sidebar */}\r\n            <aside className=\"w-64 border-r border-slate-800 p-6 flex-shrink-0\">\r\n                <h2 className=\"text-xl font-bold text-white mb-6 px-2\">Knowledge Hub</h2>\r\n                <div className=\"space-y-1\">\r\n                    <button\r\n                        onClick={() => setActiveCategory('All')}\r\n                        className={`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${activeCategory === 'All' ? 'bg-blue-600/20 text-blue-300' : 'text-slate-400 hover:text-white hover:bg-white/5'\r\n                            }`}\r\n                    >\r\n                        All Resources\r\n                    </button>\r\n\r\n                    <div className=\"my-4 border-t border-slate-800\" />\r\n\r\n                    {CATEGORIES.map(category => (\r\n                        <button\r\n                            key={category}\r\n                            onClick={() => setActiveCategory(category)}\r\n                            className={`w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${activeCategory === category ? 'bg-blue-600/20 text-blue-300' : 'text-slate-400 hover:text-white hover:bg-white/5'\r\n                                }`}\r\n                        >\r\n                            {category}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"flex-1 overflow-y-auto p-8 relative\">\r\n                <header className=\"mb-8 flex flex-col md:flex-row justify-between items-start gap-4\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-pink-400 to-purple-400 mb-2\">\r\n                            Enablement & Resources\r\n                        </h1>\r\n                        <p className=\"text-slate-400 mb-6\">Access all sales materials, training, and operational tools.</p>\r\n\r\n                        <div className=\"flex items-center gap-4 mb-4\">\r\n                            <div className=\"p-1 bg-slate-800 rounded-lg flex items-center\">\r\n                                <button\r\n                                    onClick={() => setActiveTab('mine')}\r\n                                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${activeTab === 'mine' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}\r\n                                >\r\n                                    My Resources\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setActiveTab('company')}\r\n                                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${activeTab === 'company' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}\r\n                                >\r\n                                    Company Depo\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"relative max-w-md\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500\" />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search guides, scripts, videos...\"\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                className=\"glass-input pl-10 h-10 text-base w-full\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setIsUploadOpen(true)}\r\n                        className=\"glass-button flex items-center gap-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 whitespace-nowrap\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" /> Upload Resource\r\n                    </button>\r\n                </header>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {filteredResources.map(resource => (\r\n                        <GlassCard key={resource.id} className=\"group hover:bg-slate-800/60 transition-colors flex flex-col h-full\">\r\n                            <div className=\"flex justify-between items-start mb-4\">\r\n                                <div className=\"p-2 bg-slate-800 rounded-lg group-hover:bg-slate-700 transition-colors\">\r\n                                    {getIcon(resource.type)}\r\n                                </div>\r\n                                <Badge variant=\"default\">{resource.category}</Badge>\r\n                            </div>\r\n\r\n                            <h3 className=\"font-semibold text-lg text-white mb-2 group-hover:text-blue-300 transition-colors\">\r\n                                {resource.title}\r\n                            </h3>\r\n                            <p className=\"text-slate-400 text-sm mb-4 line-clamp-2 flex-grow\">\r\n                                {resource.description}\r\n                            </p>\r\n\r\n                            <div className=\"flex items-center justify-between mt-auto pt-4 border-t border-slate-700/50\">\r\n                                <span className=\"text-xs text-slate-500\">\r\n                                    {new Date(resource.updatedAt).toLocaleDateString()}\r\n                                </span>\r\n                                <a\r\n                                    href={resource.url}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"text-blue-400 hover:text-blue-300 text-sm font-medium flex items-center gap-1\"\r\n                                >\r\n                                    Access <Download className=\"w-3 h-3\" />\r\n                                </a>\r\n                            </div>\r\n                        </GlassCard>\r\n                    ))}\r\n                </div>\r\n\r\n                {filteredResources.length === 0 && (\r\n                    <div className=\"text-center py-20 text-slate-500\">\r\n                        <p>No resources found matching your search.</p>\r\n                    </div>\r\n                )}\r\n            </main>\r\n\r\n            {/* Upload Modal */}\r\n            {isUploadOpen && (\r\n                <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\r\n                    <GlassCard className=\"w-full max-w-md relative animate-in fade-in zoom-in-95 duration-200\">\r\n                        <button\r\n                            onClick={() => setIsUploadOpen(false)}\r\n                            className=\"absolute top-4 right-4 text-slate-400 hover:text-white\"\r\n                        >\r\n                            <X className=\"w-5 h-5\" />\r\n                        </button>\r\n\r\n                        <h2 className=\"text-xl font-bold text-white mb-1\">Upload Resource</h2>\r\n                        <p className=\"text-sm text-slate-400 mb-6\">Add a document to your knowledge hub.</p>\r\n\r\n                        <form onSubmit={handleUpload} className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-300 mb-1\">Category</label>\r\n                                <select\r\n                                    value={uploadCategory}\r\n                                    onChange={(e) => setUploadCategory(e.target.value as ResourceCategory)}\r\n                                    className=\"glass-input w-full\"\r\n                                >\r\n                                    {CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-slate-300 mb-1\">Description</label>\r\n                                <textarea\r\n                                    value={uploadDesc}\r\n                                    onChange={(e) => setUploadDesc(e.target.value)}\r\n                                    className=\"glass-input w-full min-h-[80px]\"\r\n                                    placeholder=\"Brief summary...\"\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center hover:border-blue-500/50 transition-colors\">\r\n                                <input\r\n                                    type=\"file\"\r\n                                    id=\"file-upload\"\r\n                                    className=\"hidden\"\r\n                                    onChange={(e) => setUploadFile(e.target.files?.[0] || null)}\r\n                                    accept=\".pdf,.doc,.docx,.txt,.md\"\r\n                                />\r\n                                <label htmlFor=\"file-upload\" className=\"cursor-pointer block\">\r\n                                    <CloudIconOrText file={uploadFile} />\r\n                                </label>\r\n                            </div>\r\n\r\n                            <button\r\n                                type=\"submit\"\r\n                                disabled={isUploading || !uploadFile}\r\n                                className=\"glass-button w-full bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 flex justify-center\"\r\n                            >\r\n                                {isUploading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : 'Upload Resource'}\r\n                            </button>\r\n                        </form>\r\n                    </GlassCard>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction CloudIconOrText({ file }: { file: File | null }) {\r\n    if (file) {\r\n        return (\r\n            <div className=\"text-blue-400\">\r\n                <FileText className=\"w-8 h-8 mx-auto mb-2\" />\r\n                <p className=\"text-sm font-medium\">{file.name}</p>\r\n                <p className=\"text-xs text-slate-500 mt-1\">Click to change</p>\r\n            </div>\r\n        );\r\n    }\r\n    return (\r\n        <div className=\"text-slate-400\">\r\n            <UploadCloud className=\"w-8 h-8 mx-auto mb-2\" />\r\n            <p className=\"text-sm\">Click to select file</p>\r\n            <p className=\"text-xs text-slate-500 mt-1\">PDF, Docs, Text (Max 10MB)</p>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\resources\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\resources\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\resources\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\settings\\SettingsClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShieldCheck' is defined but never used.","line":7,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":47},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkConnections'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [user, authLoading, checkConnections]","fix":{"range":[1461,1480],"text":"[user, authLoading, checkConnections]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2695,2698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2695,2698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { Badge } from '@/components/ui/Badge';\r\nimport { CreditCard, ExternalLink, ShieldCheck } from 'lucide-react';\r\nimport { isGmailConnected } from '@/lib/gmail/gmail-service';\r\nimport { toast } from 'sonner';\r\n\r\nasync function checkTwilioStatusViaAPI(userId: string): Promise<{ connected: boolean; phoneNumber: string | null }> {\r\n    try {\r\n        const response = await fetch(`/api/twilio/status?userId=${userId}`);\r\n        if (!response.ok) {\r\n            return { connected: false, phoneNumber: null };\r\n        }\r\n        return await response.json();\r\n    } catch {\r\n        return { connected: false, phoneNumber: null };\r\n    }\r\n}\r\n\r\nexport default function SettingsClient() {\r\n    const { user, profile, loading: authLoading } = useAuth();\r\n    const [gmailConnected, setGmailConnected] = useState(false);\r\n    const [twilioConnected, setTwilioConnected] = useState(false);\r\n    const [twilioPhone, setTwilioPhone] = useState<string | null>(null);\r\n    const [isPortalLoading, setIsPortalLoading] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n        if (!user) {\r\n            setIsLoading(false);\r\n            return;\r\n        }\r\n        checkConnections();\r\n    }, [user, authLoading]);\r\n\r\n    const checkConnections = async () => {\r\n        if (!user) return;\r\n        try {\r\n            const [gmailStatus, twilioStatus] = await Promise.all([\r\n                isGmailConnected(user.uid),\r\n                checkTwilioStatusViaAPI(user.uid),\r\n            ]);\r\n            setGmailConnected(gmailStatus);\r\n            setTwilioConnected(twilioStatus?.connected ?? false);\r\n            setTwilioPhone(twilioStatus?.phoneNumber ?? null);\r\n        } catch (error) {\r\n            console.error('Error checking connections:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleConnectGmail = () => {\r\n        if (!user) {\r\n            toast.error('Please log in first');\r\n            return;\r\n        }\r\n        window.location.href = `/api/auth/gmail?userId=${user.uid}`;\r\n    };\r\n\r\n    const handleManageBilling = async () => {\r\n        if (!user) return;\r\n        setIsPortalLoading(true);\r\n        try {\r\n            const response = await fetch('/api/stripe/portal', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ userId: user.uid, customerId: (profile as any)?.stripeCustomerId }),\r\n            });\r\n            const data = await response.json();\r\n            if (data.url) {\r\n                window.location.href = data.url;\r\n            } else {\r\n                toast.error('Could not open billing portal');\r\n            }\r\n        } catch (error) {\r\n            toast.error('Billing portal service unavailable');\r\n            console.error(error);\r\n        } finally {\r\n            setIsPortalLoading(false);\r\n        }\r\n    };\r\n\r\n    if (authLoading || isLoading) {\r\n        return (\r\n            <div className=\"p-8 min-h-screen flex items-center justify-center\">\r\n                <div className=\"text-slate-500 italic animate-pulse\">Synchronizing configurations...</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!user) return null;\r\n\r\n    return (\r\n        <div className=\"p-8 min-h-screen\">\r\n            <header className=\"mb-8\">\r\n                <h1 className=\"text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400\">\r\n                    Settings & Account\r\n                </h1>\r\n                <p className=\"text-slate-500 text-sm mt-1\">Configure your professional workspace and commercial integrations</p>\r\n            </header>\r\n\r\n            <div className=\"grid gap-6 max-w-2xl\">\r\n                {/* Billing Logic... (Previous cards remain same) */}\r\n                <GlassCard className=\"border-l-4 border-l-indigo-500\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center text-white\">\r\n                                <CreditCard size={24} />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-white\">Subscription & Billing</h3>\r\n                                <div className=\"flex items-center gap-2 mt-1\">\r\n                                    <span className=\"text-sm text-slate-400\">Current Plan:</span>\r\n                                    <Badge className=\"bg-indigo-500/20 text-indigo-300 border-indigo-500/30 uppercase text-[10px] font-bold tracking-wider\">\r\n                                        {profile?.tier || 'Free'}\r\n                                    </Badge>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleManageBilling}\r\n                            disabled={isPortalLoading}\r\n                            className=\"flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 text-white rounded-lg text-sm font-medium border border-white/10 transition-all disabled:opacity-50\"\r\n                        >\r\n                            {isPortalLoading ? 'Loading...' : 'Manage Billing'}\r\n                            <ExternalLink size={14} />\r\n                        </button>\r\n                    </div>\r\n                </GlassCard>\r\n\r\n                <GlassCard>\r\n                    <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center text-2xl\"></div>\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-white\">Gmail Integration</h3>\r\n                                <p className=\"text-sm text-slate-400\">Sync emails with leads, track replies, and send emails directly</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {gmailConnected ? (\r\n                                <span className=\"text-sm text-green-400 font-medium\">Connected</span>\r\n                            ) : (\r\n                                <button onClick={handleConnectGmail} className=\"glass-button px-4 py-2 text-xs\">Connect Gmail</button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n\r\n                <GlassCard>\r\n                    <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center text-2xl\"></div>\r\n                            <div>\r\n                                <h3 className=\"text-lg font-semibold text-white\">Twilio Telephony</h3>\r\n                                <p className=\"text-sm text-slate-400\">Omnichannel communication hub for professional outreach</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                            {twilioConnected ? (\r\n                                <Badge variant=\"success\">Active: {twilioPhone}</Badge>\r\n                            ) : (\r\n                                <Badge variant=\"warning\">Setup Required</Badge>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\settings\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\settings\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\terms\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\training\\TrainingClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toast' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { toast } from 'sonner';\r\nimport { analytics } from '@/lib/analytics';\r\nimport { Badge } from '@/components/ui/Badge';\r\nimport { Play, CheckCircle, Clock, BookOpen, Video, FileText, Award, ChevronRight, ShieldAlert, Target, Mic, Zap, Users } from 'lucide-react';\r\nimport { WarRoomRunner } from '@/components/training/WarRoomRunner';\r\nimport { DojoRunner } from '@/components/training/DojoRunner';\r\nimport { PitchRecorder } from '@/components/training/PitchRecorder';\r\nimport { BoardroomRunner } from '@/components/training/BoardroomRunner';\r\n\r\ninterface TrainingModule {\r\n    id: string;\r\n    title: string;\r\n    description: string;\r\n    duration: string;\r\n    type: 'video' | 'quiz' | 'reading';\r\n    completed: boolean;\r\n    progress: number;\r\n}\r\n\r\ninterface TrainingCourse {\r\n    id: string;\r\n    title: string;\r\n    category: string;\r\n    modules: TrainingModule[];\r\n    totalDuration: string;\r\n}\r\n\r\nconst TRAINING_COURSES: TrainingCourse[] = [\r\n    {\r\n        id: '1',\r\n        title: 'Cold Calling Mastery',\r\n        category: 'Prospecting',\r\n        totalDuration: '2h 15m',\r\n        modules: [\r\n            { id: '1-1', title: 'The Psychology of Cold Calls', description: 'Understand buyer mindset', duration: '15m', type: 'video', completed: true, progress: 100 },\r\n            { id: '1-2', title: 'Opening Lines That Work', description: 'First 10-second strategies', duration: '20m', type: 'video', completed: true, progress: 100 },\r\n            { id: '1-3', title: 'Handling Gatekeepers', description: 'Navigate to decision makers', duration: '25m', type: 'video', completed: false, progress: 60 },\r\n            { id: '1-4', title: 'Objection Handling', description: 'Turn no into next step', duration: '30m', type: 'video', completed: false, progress: 0 },\r\n            { id: '1-5', title: 'Cold Calling Quiz', description: 'Test your knowledge', duration: '10m', type: 'quiz', completed: false, progress: 0 },\r\n        ],\r\n    },\r\n    {\r\n        id: '2',\r\n        title: 'Discovery Call Framework',\r\n        category: 'Sales Process',\r\n        totalDuration: '1h 45m',\r\n        modules: [\r\n            { id: '2-1', title: 'Setting the Agenda', description: 'Control the conversation', duration: '15m', type: 'video', completed: true, progress: 100 },\r\n            { id: '2-2', title: 'SPIN Questioning', description: 'Advanced questioning techniques', duration: '25m', type: 'video', completed: false, progress: 30 },\r\n            { id: '2-3', title: 'Pain Point Discovery', description: 'Uncover true needs', duration: '20m', type: 'reading', completed: false, progress: 0 },\r\n            { id: '2-4', title: 'Next Steps & Close', description: 'Always advance', duration: '20m', type: 'video', completed: false, progress: 0 },\r\n        ],\r\n    },\r\n    {\r\n        id: '3',\r\n        title: 'Product Knowledge',\r\n        category: 'Product',\r\n        totalDuration: '3h 00m',\r\n        modules: [\r\n            { id: '3-1', title: 'Platform Overview', description: 'Core features and benefits', duration: '30m', type: 'video', completed: true, progress: 100 },\r\n            { id: '3-2', title: 'Use Cases by Industry', description: 'Tailored value propositions', duration: '45m', type: 'reading', completed: true, progress: 100 },\r\n            { id: '3-3', title: 'Competitive Positioning', description: 'Win against competitors', duration: '30m', type: 'video', completed: false, progress: 0 },\r\n            { id: '3-4', title: 'Pricing & Packaging', description: 'Navigate deal structures', duration: '20m', type: 'video', completed: false, progress: 0 },\r\n            { id: '3-5', title: 'Product Certification', description: 'Earn your badge', duration: '30m', type: 'quiz', completed: false, progress: 0 },\r\n        ],\r\n    },\r\n];\r\n\r\ntype ActiveTool = 'war-room' | 'dojo' | 'pitch' | 'boardroom' | null;\r\n\r\nexport default function TrainingClient() {\r\n    const [selectedCourse, setSelectedCourse] = useState<TrainingCourse | null>(null);\r\n    const [activeTool, setActiveTool] = useState<ActiveTool>(null);\r\n\r\n    const handleToolSelect = (tool: ActiveTool) => {\r\n        setActiveTool(tool);\r\n        if (tool) {\r\n            analytics.track('simulation_started', { tool });\r\n        }\r\n    };\r\n\r\n    const getTypeIcon = (type: string) => {\r\n        switch (type) {\r\n            case 'video': return <Video className=\"w-4 h-4\" />;\r\n            case 'quiz': return <Award className=\"w-4 h-4\" />;\r\n            case 'reading': return <FileText className=\"w-4 h-4\" />;\r\n            default: return <BookOpen className=\"w-4 h-4\" />;\r\n        }\r\n    };\r\n\r\n    const getCourseProgress = (course: TrainingCourse) => {\r\n        const totalProgress = course.modules.reduce((sum, m) => sum + m.progress, 0);\r\n        return Math.round(totalProgress / course.modules.length);\r\n    };\r\n\r\n    // Render Active Tool Modal/Overlay\r\n    if (activeTool === 'war-room') {\r\n        return <WarRoomRunner onClose={() => setActiveTool(null)} />;\r\n    }\r\n    if (activeTool === 'dojo') {\r\n        return <DojoRunner onClose={() => setActiveTool(null)} />;\r\n    }\r\n    if (activeTool === 'pitch') {\r\n        return <PitchRecorder onClose={() => setActiveTool(null)} />;\r\n    }\r\n    if (activeTool === 'boardroom') {\r\n        return <BoardroomRunner onClose={() => setActiveTool(null)} />;\r\n    }\r\n\r\n    return (\r\n        <div className=\"p-8 min-h-screen\">\r\n            <header className=\"mb-8\">\r\n                <h1 className=\"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-amber-400 to-orange-400\">\r\n                    Sales Training Academy\r\n                </h1>\r\n                <p className=\"text-slate-500 text-sm mt-1\">Level up your skills with guided learning paths and AI tools</p>\r\n            </header>\r\n\r\n            {/* AI Training Tools Section */}\r\n            <div className=\"mb-8\">\r\n                <h2 className=\"text-lg font-semibold text-white mb-4 flex items-center gap-2\">\r\n                    <Zap className=\"w-5 h-5 text-amber-400\" />\r\n                    AI Training Tools\r\n                </h2>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                    <GlassCard\r\n                        className=\"cursor-pointer hover:bg-white/5 transition-all group border-l-4 border-l-red-500\"\r\n                        onClick={() => handleToolSelect('war-room')}\r\n                    >\r\n                        <div className=\"flex items-start justify-between mb-4\">\r\n                            <div className=\"p-3 bg-red-500/20 rounded-lg group-hover:bg-red-500/30 transition-colors\">\r\n                                <ShieldAlert className=\"w-6 h-6 text-red-400\" />\r\n                            </div>\r\n                            <Badge variant=\"warning\">Hard Mode</Badge>\r\n                        </div>\r\n                        <h3 className=\"font-bold text-lg text-white mb-1\">The War Room</h3>\r\n                        <p className=\"text-sm text-slate-400\">Simulate high-stakes deal negotiations with an aggressive AI buyer.</p>\r\n                    </GlassCard>\r\n\r\n                    <GlassCard\r\n                        className=\"cursor-pointer hover:bg-white/5 transition-all group border-l-4 border-l-blue-500\"\r\n                        onClick={() => handleToolSelect('dojo')}\r\n                    >\r\n                        <div className=\"flex items-start justify-between mb-4\">\r\n                            <div className=\"p-3 bg-blue-500/20 rounded-lg group-hover:bg-blue-500/30 transition-colors\">\r\n                                <Target className=\"w-6 h-6 text-blue-400\" />\r\n                            </div>\r\n                            <Badge variant=\"default\">Practice</Badge>\r\n                        </div>\r\n                        <h3 className=\"font-bold text-lg text-white mb-1\">Objection Dojo</h3>\r\n                        <p className=\"text-sm text-slate-400\">Master common objections with rapid-fire repetition and feedback.</p>\r\n                    </GlassCard>\r\n\r\n                    <GlassCard\r\n                        className=\"cursor-pointer hover:bg-white/5 transition-all group border-l-4 border-l-purple-500\"\r\n                        onClick={() => handleToolSelect('pitch')}\r\n                    >\r\n                        <div className=\"flex items-start justify-between mb-4\">\r\n                            <div className=\"p-3 bg-purple-500/20 rounded-lg group-hover:bg-purple-500/30 transition-colors\">\r\n                                <Mic className=\"w-6 h-6 text-purple-400\" />\r\n                            </div>\r\n                            <Badge variant=\"default\">Analysis</Badge>\r\n                        </div>\r\n                        <h3 className=\"font-bold text-lg text-white mb-1\">Pitch Recorder</h3>\r\n                        <p className=\"text-sm text-slate-400\">Record your elevator pitch and get instant AI coaching on delivery.</p>\r\n                    </GlassCard>\r\n\r\n                    <GlassCard\r\n                        className=\"cursor-pointer hover:bg-white/5 transition-all group border-l-4 border-l-amber-500\"\r\n                        onClick={() => handleToolSelect('boardroom')}\r\n                    >\r\n                        <div className=\"flex items-start justify-between mb-4\">\r\n                            <div className=\"p-3 bg-amber-500/20 rounded-lg group-hover:bg-amber-500/30 transition-colors\">\r\n                                <Users className=\"w-6 h-6 text-amber-400\" />\r\n                            </div>\r\n                            <Badge variant=\"warning\">Venture Scale</Badge>\r\n                        </div>\r\n                        <h3 className=\"font-bold text-lg text-white mb-1\">The Boardroom</h3>\r\n                        <p className=\"text-sm text-slate-400\">Multi-agent simulation. Win over the CFO, CTO, and Champion simultaneously.</p>\r\n                    </GlassCard>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Progress Overview */}\r\n            <h2 className=\"text-lg font-semibold text-white mb-4\">Your Progress</h2>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n                <GlassCard>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-green-500/20 rounded-lg\">\r\n                            <CheckCircle className=\"w-6 h-6 text-green-400\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-white\">5</p>\r\n                            <p className=\"text-sm text-slate-400\">Modules Completed</p>\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n\r\n                <GlassCard>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-blue-500/20 rounded-lg\">\r\n                            <Clock className=\"w-6 h-6 text-blue-400\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-white\">4h 30m</p>\r\n                            <p className=\"text-sm text-slate-400\">Total Learning Time</p>\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n\r\n                <GlassCard>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-3 bg-amber-500/20 rounded-lg\">\r\n                            <Award className=\"w-6 h-6 text-amber-400\" />\r\n                        </div>\r\n                        <div>\r\n                            <p className=\"text-2xl font-bold text-white\">1</p>\r\n                            <p className=\"text-sm text-slate-400\">Certifications Earned</p>\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* Course List */}\r\n                <div className=\"lg:col-span-1 space-y-4\">\r\n                    <h2 className=\"text-lg font-semibold text-white mb-4\">Learning Paths</h2>\r\n                    {TRAINING_COURSES.map((course) => {\r\n                        const progress = getCourseProgress(course);\r\n                        return (\r\n                            <GlassCard\r\n                                key={course.id}\r\n                                className={`cursor-pointer transition-all ${selectedCourse?.id === course.id ? 'ring-2 ring-blue-500' : 'hover:bg-white/5'}`}\r\n                                onClick={() => setSelectedCourse(course)}\r\n                            >\r\n                                <div className=\"flex justify-between items-start mb-3\">\r\n                                    <div>\r\n                                        <h3 className=\"font-medium text-white\">{course.title}</h3>\r\n                                        <p className=\"text-xs text-slate-500\">{course.category}  {course.totalDuration}</p>\r\n                                    </div>\r\n                                    <Badge variant={progress === 100 ? 'success' : progress > 0 ? 'warning' : 'default'}>\r\n                                        {progress}%\r\n                                    </Badge>\r\n                                </div>\r\n                                <div className=\"h-1.5 bg-slate-800 rounded-full overflow-hidden\">\r\n                                    <div\r\n                                        className=\"h-full bg-gradient-to-r from-blue-500 to-cyan-400 transition-all\"\r\n                                        style={{ width: `${progress}%` }}\r\n                                    />\r\n                                </div>\r\n                            </GlassCard>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Course Content */}\r\n                <div className=\"lg:col-span-2\">\r\n                    {selectedCourse ? (\r\n                        <GlassCard>\r\n                            <div className=\"flex justify-between items-start mb-6\">\r\n                                <div>\r\n                                    <h2 className=\"text-xl font-bold text-white\">{selectedCourse.title}</h2>\r\n                                    <p className=\"text-sm text-slate-400\">{selectedCourse.modules.length} modules  {selectedCourse.totalDuration}</p>\r\n                                </div>\r\n                                <button className=\"glass-button flex items-center gap-2\">\r\n                                    <Play className=\"w-4 h-4\" /> Continue\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-3\">\r\n                                {selectedCourse.modules.map((module, index) => (\r\n                                    <div\r\n                                        key={module.id}\r\n                                        className={`flex items-center gap-4 p-4 rounded-lg transition-colors ${module.completed ? 'bg-green-500/10' : 'bg-slate-800/50 hover:bg-slate-800'\r\n                                            }`}\r\n                                    >\r\n                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${module.completed ? 'bg-green-500/20 text-green-400' :\r\n                                            module.progress > 0 ? 'bg-blue-500/20 text-blue-400' :\r\n                                                'bg-slate-700 text-slate-400'\r\n                                            }`}>\r\n                                            {module.completed ? <CheckCircle className=\"w-4 h-4\" /> : index + 1}\r\n                                        </div>\r\n\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <h4 className=\"font-medium text-white truncate\">{module.title}</h4>\r\n                                                <span className=\"text-slate-500\">{getTypeIcon(module.type)}</span>\r\n                                            </div>\r\n                                            <p className=\"text-xs text-slate-500\">{module.description}  {module.duration}</p>\r\n                                            {module.progress > 0 && module.progress < 100 && (\r\n                                                <div className=\"h-1 bg-slate-700 rounded-full mt-2 overflow-hidden w-32\">\r\n                                                    <div className=\"h-full bg-blue-500\" style={{ width: `${module.progress}%` }} />\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        <ChevronRight className=\"w-5 h-5 text-slate-500\" />\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </GlassCard>\r\n                    ) : (\r\n                        <GlassCard className=\"flex items-center justify-center min-h-[400px]\">\r\n                            <div className=\"text-center\">\r\n                                <BookOpen className=\"w-12 h-12 text-slate-600 mx-auto mb-4\" />\r\n                                <p className=\"text-slate-500\">Select a course to view modules</p>\r\n                            </div>\r\n                        </GlassCard>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\training\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\training\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\app\\training\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ai\\AIEmailDraft.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'email' and 'handleGenerate'. Either include them or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [email, handleGenerate, isOpen]","fix":{"range":[1694,1702],"text":"[email, handleGenerate, isOpen]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":51,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":66,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Lead } from '@/types';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { generateEmail, enhanceEmail, EnhancementAction } from '@/lib/firebase/ai-service';\r\nimport { ActivitiesService, EmailThreadsService } from '@/lib/firebase/services';\r\nimport { toast } from 'sonner';\r\n\r\ninterface AIEmailDraftProps {\r\n    lead: Lead;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nconst ENHANCEMENT_ACTIONS: { action: EnhancementAction; icon: string; label: string }[] = [\r\n    { action: 'shorter', icon: '', label: 'Shorter' },\r\n    { action: 'professional', icon: '', label: 'Professional' },\r\n    { action: 'friendly', icon: '', label: 'Friendly' },\r\n    { action: 'urgency', icon: '', label: 'Add Urgency' },\r\n    { action: 'social-proof', icon: '', label: 'Add Proof' },\r\n];\r\n\r\nexport function AIEmailDraft({ lead, isOpen, onClose }: AIEmailDraftProps) {\r\n    const { user } = useAuth();\r\n    const [subject, setSubject] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [customPrompt, setCustomPrompt] = useState('');\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [isEnhancing, setIsEnhancing] = useState<EnhancementAction | null>(null);\r\n    const [copied, setCopied] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [showCustomPrompt, setShowCustomPrompt] = useState(false);\r\n\r\n    const senderName = user?.displayName || 'Sales Team';\r\n    const senderEmail = user?.email || '';\r\n\r\n    useEffect(() => {\r\n        if (isOpen && !email) {\r\n            handleGenerate();\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const handleGenerate = async (prompt?: string) => {\r\n        setIsGenerating(true);\r\n        setError(null);\r\n        try {\r\n            const result = await generateEmail(lead, senderName, prompt);\r\n            setSubject(result.subject);\r\n            setEmail(result.body);\r\n        } catch (err) {\r\n            setError('Failed to generate email. Using template instead.');\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    const handleEnhance = async (action: EnhancementAction) => {\r\n        if (!email) return;\r\n        setIsEnhancing(action);\r\n        setError(null);\r\n        try {\r\n            const enhanced = await enhanceEmail(email, action, lead);\r\n            setEmail(enhanced);\r\n            toast.success(`Email made ${action}`);\r\n        } catch (err) {\r\n            setError('Enhancement failed. Please try again.');\r\n        } finally {\r\n            setIsEnhancing(null);\r\n        }\r\n    };\r\n\r\n    const handleCopy = () => {\r\n        navigator.clipboard.writeText(`Subject: ${subject}\\n\\n${email}`);\r\n        setCopied(true);\r\n        toast.success('Copied to clipboard');\r\n        setTimeout(() => setCopied(false), 2000);\r\n    };\r\n\r\n    const handleSendEmail = async () => {\r\n        // Log the email activity if user is logged in\r\n        if (user) {\r\n            try {\r\n                // Create email thread record\r\n                await EmailThreadsService.createThread(user.uid, {\r\n                    leadId: lead.id,\r\n                    subject,\r\n                    body: email,\r\n                    status: 'sent',\r\n                    sentAt: Date.now(),\r\n                    aiGenerated: true\r\n                });\r\n\r\n                // Log activity\r\n                await ActivitiesService.logEmail(user.uid, lead.id, subject, email.substring(0, 200));\r\n                toast.success('Email logged to activity history');\r\n            } catch (error) {\r\n                console.error('Failed to log email:', error);\r\n            }\r\n        }\r\n\r\n        // Open email client\r\n        const mailtoUrl = `mailto:${lead.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(email)}`;\r\n        window.open(mailtoUrl, '_blank');\r\n    };\r\n\r\n    const handleCustomGenerate = () => {\r\n        if (customPrompt.trim()) {\r\n            handleGenerate(customPrompt);\r\n            setShowCustomPrompt(false);\r\n            setCustomPrompt('');\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n            {/* Backdrop */}\r\n            <div\r\n                className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\"\r\n                onClick={onClose}\r\n            />\r\n\r\n            {/* Modal */}\r\n            <div className=\"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-800\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center\">\r\n                                <span className=\"text-lg\"></span>\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-xl font-bold text-white\">AI Email Draft</h2>\r\n                                <p className=\"text-sm text-slate-400\">For {lead.companyName}  {lead.status}</p>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"text-slate-400 hover:text-white transition-colors text-2xl\"\r\n                        >\r\n                            \r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Sender/Recipient Info */}\r\n                    <div className=\"mt-4 flex items-center gap-4 text-sm\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-slate-500\">From:</span>\r\n                            <span className=\"text-slate-300\">{senderEmail || 'Not logged in'}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-slate-500\">To:</span>\r\n                            <span className=\"text-slate-300\">{lead.email}</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6\">\r\n                    {isGenerating ? (\r\n                        <div className=\"h-64 flex items-center justify-center\">\r\n                            <div className=\"text-center\">\r\n                                <div className=\"w-10 h-10 border-2 border-violet-500 border-t-transparent rounded-full animate-spin mx-auto mb-3\" />\r\n                                <p className=\"text-slate-400\">AI is crafting your email...</p>\r\n                                <p className=\"text-xs text-slate-600 mt-1\">Using company playbooks & lead context</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            {error && (\r\n                                <div className=\"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg text-amber-400 text-sm\">\r\n                                    {error}\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Custom Prompt Input */}\r\n                            {showCustomPrompt && (\r\n                                <div className=\"mb-4 p-4 bg-slate-800/50 border border-slate-700 rounded-lg\">\r\n                                    <label className=\"block text-sm text-slate-400 mb-2\">What should the email focus on?</label>\r\n                                    <textarea\r\n                                        value={customPrompt}\r\n                                        onChange={(e) => setCustomPrompt(e.target.value)}\r\n                                        placeholder=\"E.g., 'Focus on cost savings and mention their Q1 budget planning'\"\r\n                                        className=\"glass-input w-full h-20 resize-none text-sm\"\r\n                                    />\r\n                                    <div className=\"flex gap-2 mt-2\">\r\n                                        <button\r\n                                            onClick={handleCustomGenerate}\r\n                                            className=\"glass-button px-4 py-1.5 text-xs\"\r\n                                        >\r\n                                            Generate\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setShowCustomPrompt(false)}\r\n                                            className=\"text-slate-400 hover:text-white text-xs\"\r\n                                        >\r\n                                            Cancel\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {/* Subject Line */}\r\n                            <div className=\"mb-4\">\r\n                                <label className=\"block text-sm text-slate-400 mb-2\">Subject Line</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={subject}\r\n                                    onChange={(e) => setSubject(e.target.value)}\r\n                                    className=\"glass-input w-full\"\r\n                                />\r\n                            </div>\r\n\r\n                            {/* AI Enhancement Buttons */}\r\n                            <div className=\"mb-4\">\r\n                                <div className=\"flex items-center justify-between mb-2\">\r\n                                    <label className=\"text-sm text-slate-400\">AI Enhancements</label>\r\n                                    <button\r\n                                        onClick={() => setShowCustomPrompt(true)}\r\n                                        className=\"text-xs text-violet-400 hover:text-violet-300\"\r\n                                    >\r\n                                        + Custom prompt\r\n                                    </button>\r\n                                </div>\r\n                                <div className=\"flex flex-wrap gap-2\">\r\n                                    {ENHANCEMENT_ACTIONS.map(({ action, icon, label }) => (\r\n                                        <button\r\n                                            key={action}\r\n                                            onClick={() => handleEnhance(action)}\r\n                                            disabled={isEnhancing !== null}\r\n                                            className={`px-3 py-1.5 text-xs rounded-lg border transition-all flex items-center gap-1.5\r\n                                                ${isEnhancing === action\r\n                                                    ? 'bg-violet-500/20 border-violet-500/50 text-violet-300'\r\n                                                    : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-700 hover:text-white hover:border-slate-600'}\r\n                                                ${isEnhancing !== null && isEnhancing !== action ? 'opacity-50 cursor-not-allowed' : ''}\r\n                                            `}\r\n                                        >\r\n                                            {isEnhancing === action ? (\r\n                                                <div className=\"w-3 h-3 border border-violet-300 border-t-transparent rounded-full animate-spin\" />\r\n                                            ) : (\r\n                                                <span>{icon}</span>\r\n                                            )}\r\n                                            {label}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Email Body */}\r\n                            <div className=\"mb-4\">\r\n                                <label className=\"block text-sm text-slate-400 mb-2\">Email Body</label>\r\n                                <textarea\r\n                                    value={email}\r\n                                    onChange={(e) => setEmail(e.target.value)}\r\n                                    className=\"glass-input w-full h-56 resize-none font-mono text-sm leading-relaxed\"\r\n                                />\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Actions Footer */}\r\n                {!isGenerating && (\r\n                    <div className=\"p-6 border-t border-slate-800 bg-slate-900/80\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <button\r\n                                onClick={() => handleGenerate()}\r\n                                className=\"px-4 py-2 text-slate-400 hover:text-white transition-colors flex items-center gap-2\"\r\n                            >\r\n                                <span></span> Regenerate\r\n                            </button>\r\n                            <div className=\"flex gap-3\">\r\n                                <button\r\n                                    onClick={handleCopy}\r\n                                    className=\"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors\"\r\n                                >\r\n                                    {copied ? ' Copied!' : ' Copy'}\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleSendEmail}\r\n                                    disabled={!lead.email}\r\n                                    className=\"glass-button px-6 py-2 flex items-center gap-2\"\r\n                                >\r\n                                     Send & Log\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-xs text-slate-600 mt-3 text-center\">\r\n                            {user ? 'Email will be logged to this lead\\'s activity timeline' : 'Log in to track email activity'}\r\n                        </p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\dashboard\\ActivityPerformanceChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\dashboard\\DashboardClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Skeleton' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useMemo } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { useLeads } from '@/lib/api/hooks/useLeads';\r\nimport { useActivities } from '@/lib/api/hooks/useActivities';\r\nimport { Skeleton } from '@/components/ui/Skeleton';\r\nimport { EmptyState } from '@/components/ui/EmptyState';\r\nimport { Activity, Lead } from '@/types';\r\nimport { ActivityPerformanceChart } from '@/components/dashboard/ActivityPerformanceChart';\r\n\r\nexport default function DashboardClient() {\r\n    const router = useRouter();\r\n    const { user, loading: authLoading } = useAuth();\r\n\r\n    // 1. Fetch Data via Hooks (Deduplicated & Cached)\r\n    const { leads, isLoading: leadsLoading } = useLeads();\r\n    const { activities, isLoading: activitiesLoading } = useActivities();\r\n\r\n    const isLoading = authLoading || leadsLoading || activitiesLoading;\r\n\r\n    // 2. Client-Side Aggregation (Memoized)\r\n    // Since we now fetch raw lists once, we calculate stats on the fly.\r\n    // This is fast for <5k items. For >5k, we would need server-side aggregation.\r\n    const metrics = useMemo(() => {\r\n        if (!user || isLoading) return null;\r\n\r\n        const now = new Date();\r\n        const startOfDay = new Date(now.setHours(0, 0, 0, 0)).getTime();\r\n        const startOfWeek = new Date();\r\n        startOfWeek.setDate(now.getDate() - 6);\r\n        startOfWeek.setHours(0, 0, 0, 0);\r\n\r\n        // Daily Activities\r\n        const todayActivities = activities.filter((a: Activity) => a.timestamp >= startOfDay);\r\n        const dials = todayActivities.filter((a: Activity) => a.type === 'call').length;\r\n        const meetingsHeld = todayActivities.filter((a: Activity) => a.type === 'meeting').length;\r\n\r\n        // Connect Rate (Simple version for now)\r\n        const calls = todayActivities.filter((a: Activity) => a.type === 'call');\r\n        const connects = calls.filter((a: Activity) => ['connected', 'meeting_set', 'qualified'].includes(a.outcome)).length;\r\n        const connectRate = calls.length > 0 ? (connects / calls.length) * 100 : 0;\r\n\r\n        // Pipeline Value\r\n        const activeLeads = leads.filter((l: Lead) => !['Lost', 'Closed'].includes(l.status));\r\n        const pipelineValue = activeLeads.reduce((sum: number, lead: Lead) => sum + (lead.value || 0), 0);\r\n\r\n        // Pipeline Distribution\r\n        const pipelineStatusCounts: Record<string, number> = {};\r\n        activeLeads.forEach((lead: Lead) => {\r\n            pipelineStatusCounts[lead.status] = (pipelineStatusCounts[lead.status] || 0) + 1;\r\n        });\r\n\r\n        return {\r\n            dials,\r\n            connectRate,\r\n            pipelineValue,\r\n            meetingsHeld,\r\n            pipelineStatusCounts\r\n        };\r\n    }, [user, isLoading, leads, activities]);\r\n\r\n    const hasData = leads.length > 0 || activities.length > 0;\r\n\r\n    // Loading State\r\n    if (isLoading) {\r\n        return <DashboardSkeleton />;\r\n    }\r\n\r\n    // Empty State (New User)\r\n    if (!hasData) {\r\n        return (\r\n            <div className=\"py-12\">\r\n                <EmptyState\r\n                    title=\"Welcome to SalesTracker\"\r\n                    description=\"Your dashboard is looking a bit empty. Start by adding your first lead to track your sales pipeline.\"\r\n                    actionLabel=\"Add Lead\"\r\n                    actionLink=\"/leads\"\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Pipeline Status Display Data\r\n    const pipelineRows = Object.entries(metrics?.pipelineStatusCounts || {}).map(([status, count]) => ({\r\n        label: status,\r\n        count: count,\r\n        color: getColorForStatus(status)\r\n    })).sort((a, b) => b.count - a.count);\r\n\r\n    return (\r\n        <>\r\n            {/* KPI Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10\">\r\n                <KpiCard\r\n                    title=\"Daily Dials\"\r\n                    value={metrics?.dials || 0}\r\n                    subvalue=\"/50\"\r\n                    glowColor=\"bg-blue-500\"\r\n                    percent={(metrics?.dials || 0) / 50 * 100}\r\n                />\r\n                <KpiCard\r\n                    title=\"Connect Rate\"\r\n                    value={`${(metrics?.connectRate || 0).toFixed(1)}%`}\r\n                    subtext=\"Target: 15%\"\r\n                    glowColor=\"bg-emerald-500\"\r\n                    textColor=\"text-emerald-400\"\r\n                />\r\n                <KpiCard\r\n                    title=\"Pipeline Value\"\r\n                    value={`$${((metrics?.pipelineValue || 0) / 1000).toFixed(1)}k`}\r\n                    subtext={`${leads.length} Active Leads`}\r\n                    glowColor=\"bg-violet-500\"\r\n                    textColor=\"text-violet-400\"\r\n                />\r\n                <KpiCard\r\n                    title=\"Meetings Held\"\r\n                    value={metrics?.meetingsHeld || 0}\r\n                    subtext=\"Today\"\r\n                    glowColor=\"bg-amber-500\"\r\n                    textColor=\"text-amber-400\"\r\n                />\r\n            </div>\r\n\r\n            {/* Main Content Grid */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Activity Feed / Chart */}\r\n                <div className=\"glass-card lg:col-span-2 min-h-[500px] flex flex-col\">\r\n                    <h2 className=\"text-xl font-bold text-slate-100 mb-6 flex items-center gap-2\">\r\n                        Activity Performance\r\n                        <span className=\"px-2 py-0.5 rounded-full bg-slate-800 text-xs text-slate-400 font-normal border border-white/5\">This Week</span>\r\n                    </h2>\r\n\r\n                    {/* Placeholder for Recharts implementation - utilizing data prop later */}\r\n                    <div className=\"flex-1 flex items-center justify-center border-2 border-dashed border-slate-800/50 rounded-2xl bg-slate-900/20\">\r\n                        <ActivityPerformanceChart data={activities} />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Lead Status */}\r\n                <div className=\"glass-card flex flex-col\">\r\n                    <h2 className=\"text-xl font-bold text-slate-100 mb-6\">Pipeline Status</h2>\r\n                    <div className=\"space-y-3\">\r\n                        {pipelineRows.length === 0 ? (\r\n                            <div className=\"text-slate-500 text-sm text-center py-4\">No active opportunities</div>\r\n                        ) : (\r\n                            pipelineRows.map((stage) => (\r\n                                <div key={stage.label} className=\"group flex items-center justify-between p-4 bg-slate-900/40 border border-white/5 rounded-xl hover:border-white/10 hover:bg-slate-800/60 transition-all cursor-pointer\" onClick={() => router.push('/leads')}>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={`w-2 h-2 rounded-full ${stage.color} shadow-[0_0_8px_currentColor] opacity-80 group-hover:opacity-100`} />\r\n                                        <span className=\"text-sm font-medium text-slate-300 group-hover:text-white transition-colors\">{stage.label}</span>\r\n                                    </div>\r\n                                    <span className=\"text-xs font-bold bg-slate-950 px-2.5 py-1 rounded-md text-slate-400 border border-white/5 group-hover:border-white/10 group-hover:text-white transition-all\">\r\n                                        {stage.count}\r\n                                    </span>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => router.push('/leads')}\r\n                        className=\"mt-6 w-full glass-button py-3 text-sm\"\r\n                    >\r\n                        View Full Pipeline\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\n// --- Subcomponents for Cleanliness ---\r\n\r\ninterface KpiCardProps {\r\n    title: string;\r\n    value: string | number;\r\n    subvalue?: string;\r\n    subtext?: string;\r\n    glowColor: string;\r\n    percent?: number;\r\n    textColor?: string;\r\n}\r\n\r\nfunction KpiCard({ title, value, subvalue, subtext, glowColor, percent, textColor = \"text-slate-100\" }: KpiCardProps) {\r\n    return (\r\n        <div className=\"glass-card group relative overflow-hidden\">\r\n            <div className=\"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity\">\r\n                <div className={`w-24 h-24 ${glowColor} rounded-full blur-3xl`}></div>\r\n            </div>\r\n            <h3 className=\"text-sm text-slate-400 font-medium uppercase tracking-wider\">{title}</h3>\r\n            <div className={`text-4xl font-bold ${textColor} mt-4`}>\r\n                {value}\r\n                {subvalue && <span className=\"text-slate-500 text-xl font-normal\">{subvalue}</span>}\r\n            </div>\r\n\r\n            {percent !== undefined ? (\r\n                <div className=\"mt-4 flex items-center gap-2\">\r\n                    <div className=\"flex-1 h-1.5 bg-slate-800 rounded-full overflow-hidden\">\r\n                        <div className={`h-full ${glowColor.replace('bg-', 'bg-')} shadow-[0_0_12px_rgba(59,130,246,0.5)]`} style={{ width: `${percent}%` }}></div>\r\n                    </div>\r\n                    <span className=\"text-xs text-blue-400 font-bold\">{percent.toFixed(0)}%</span>\r\n                </div>\r\n            ) : (\r\n                <p className=\"text-xs text-slate-500 mt-2 font-medium\">{subtext}</p>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction DashboardSkeleton() {\r\n    return (\r\n        <div className=\"animate-pulse\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-10\">\r\n                {[1, 2, 3, 4].map(i => <div key={i} className=\"h-40 bg-slate-800/50 rounded-2xl\" />)}\r\n            </div>\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                <div className=\"lg:col-span-2 h-[500px] bg-slate-800/50 rounded-2xl\" />\r\n                <div className=\"h-[500px] bg-slate-800/50 rounded-2xl\" />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction getColorForStatus(status: string) {\r\n    switch (status) {\r\n        case 'New': return 'bg-blue-500';\r\n        case 'Contacted': return 'bg-indigo-500';\r\n        case 'Qualified': return 'bg-emerald-500';\r\n        case 'Proposal': return 'bg-violet-500';\r\n        case 'Negotiation': return 'bg-amber-500';\r\n        case 'Closed': return 'bg-green-500';\r\n        default: return 'bg-slate-500';\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\layout\\ClientLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":28,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1538,1541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1538,1541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":306,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16159,16162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16159,16162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport Image from 'next/image';\r\nimport {\r\n    LayoutDashboard, Target, Activity, Database, BarChart3, GraduationCap,\r\n    ChevronLeft, ChevronRight, Menu, LogOut, Settings, LogIn\r\n} from 'lucide-react';\r\nimport { AuthProvider, useAuth } from '@/components/providers/AuthProvider';\r\nimport { QueryProvider } from '@/components/providers/QueryProvider';\r\nimport { ErrorBoundary } from '@/components/ui/ErrorBoundary';\r\nimport { CookieConsent } from '@/components/ui/CookieConsent';\r\nimport { WelcomeTour } from '@/components/onboarding/WelcomeTour';\r\nimport { toast, Toaster } from 'sonner';\r\nimport { AIContextProvider } from '@/components/providers/AIContext';\r\n\r\nfunction SidebarContent({ collapsed, mobileMenuOpen }: { collapsed: boolean; mobileMenuOpen: boolean }) {\r\n    const { user, loading, logout, signInWithGoogle } = useAuth();\r\n    const router = useRouter();\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            await logout();\r\n            toast.success('Signed out successfully');\r\n            router.push('/');\r\n        } catch (error) {\r\n            toast.error('Failed to sign out');\r\n        }\r\n    };\r\n\r\n    const handleSignIn = async () => {\r\n        try {\r\n            await signInWithGoogle();\r\n            toast.success('Signed in successfully!');\r\n        } catch (error: unknown) {\r\n            if (error instanceof Error && (error as any).code === 'auth/popup-closed-by-user') return;\r\n            toast.error('Failed to sign in');\r\n        }\r\n    };\r\n\r\n    const showLabel = !collapsed || mobileMenuOpen;\r\n\r\n    return (\r\n        <>\r\n            {/* Navigation */}\r\n            <nav className=\"flex-1 px-3 space-y-2 mt-4 overflow-y-auto overflow-x-hidden custom-scrollbar\">\r\n                <NavLink href=\"/\" icon={<LayoutDashboard size={20} />} label=\"Dashboard\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/leads\" icon={<Target size={20} />} label=\"Leads Pipeline\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/activities\" icon={<Activity size={20} />} label=\"Activities\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/resources\" icon={<Database size={20} />} label=\"Enablement\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/analytics\" icon={<BarChart3 size={20} />} label=\"Analytics\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/training\" icon={<GraduationCap size={20} />} label=\"Training\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                <NavLink href=\"/reality-link\" icon={<Activity size={20} />} label=\"Reality Link HUD\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n\r\n                {/* Settings - show only when logged in */}\r\n                {user && (\r\n                    <NavLink href=\"/settings\" icon={<Settings size={20} />} label=\"Settings\" collapsed={collapsed} mobile={mobileMenuOpen} />\r\n                )}\r\n            </nav>\r\n\r\n            {/* Footer / User */}\r\n            <div className=\"p-4 border-t border-white/5 overflow-x-hidden\">\r\n                {loading ? (\r\n                    <div className=\"flex items-center justify-center py-3\">\r\n                        <div className=\"w-5 h-5 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin\" />\r\n                    </div>\r\n                ) : user ? (\r\n                    <>\r\n                        {/* User Profile */}\r\n                        <div className={`flex items-center gap-3 mb-3 ${collapsed && !mobileMenuOpen ? 'justify-center' : ''}`}>\r\n                            {user.photoURL ? (\r\n                                <div className=\"relative w-9 h-9 flex-shrink-0\">\r\n                                    <Image\r\n                                        src={user.photoURL}\r\n                                        alt={user.displayName || 'User'}\r\n                                        fill\r\n                                        className=\"rounded-full border border-white/10 shadow-lg object-cover\"\r\n                                    />\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"w-9 h-9 flex-shrink-0 rounded-full bg-gradient-to-tr from-indigo-500 to-violet-500 border border-white/10 shadow-lg shadow-indigo-500/20 flex items-center justify-center text-white font-medium text-sm\">\r\n                                    {user.displayName?.charAt(0) || user.email?.charAt(0) || '?'}\r\n                                </div>\r\n                            )}\r\n                            {showLabel && (\r\n                                <div className=\"overflow-hidden flex-1 min-w-0\">\r\n                                    <div className=\"text-sm font-medium text-slate-200 truncate\">\r\n                                        {user.displayName || 'User'}\r\n                                    </div>\r\n                                    <div className=\"text-[10px] text-slate-500 truncate\">\r\n                                        {user.email}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Sign Out Button */}\r\n                        <button\r\n                            onClick={handleLogout}\r\n                            className={`w-full flex items-center gap-2 text-sm text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all ${showLabel ? 'px-3 py-2' : 'p-3 justify-center'\r\n                                }`}\r\n                            title={!showLabel ? 'Sign Out' : ''}\r\n                        >\r\n                            <LogOut size={18} />\r\n                            {showLabel && <span>Sign Out</span>}\r\n                        </button>\r\n                    </>\r\n                ) : (\r\n                    /* Sign In Button */\r\n                    <button\r\n                        onClick={handleSignIn}\r\n                        className={`w-full flex items-center gap-2 bg-gradient-to-r from-indigo-500 to-violet-500 hover:from-indigo-600 hover:to-violet-600 text-white font-medium rounded-xl transition-all shadow-lg shadow-indigo-500/25 ${showLabel ? 'px-4 py-3' : 'p-3 justify-center'\r\n                            }`}\r\n                        title={!showLabel ? 'Sign In' : ''}\r\n                    >\r\n                        <LogIn size={18} />\r\n                        {showLabel && <span>Sign In</span>}\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport function ClientLayout({ children }: { children: React.ReactNode }) {\r\n    const [collapsed, setCollapsed] = useState(false);\r\n    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            setMounted(true);\r\n        }, 0);\r\n        return () => clearTimeout(timeout);\r\n    }, []);\r\n\r\n    // Close mobile menu on route change\r\n    const pathname = usePathname();\r\n    useEffect(() => {\r\n        if (mobileMenuOpen) {\r\n            const timeout = setTimeout(() => {\r\n                setMobileMenuOpen(false);\r\n            }, 0);\r\n            return () => clearTimeout(timeout);\r\n        }\r\n    }, [pathname, mobileMenuOpen]);\r\n\r\n    // Simple loading state for SSR\r\n    if (!mounted) {\r\n        return (\r\n            <QueryProvider>\r\n                <AuthProvider>\r\n                    <AIContextProvider>\r\n                        <div className=\"flex min-h-screen\">\r\n                            <div className=\"hidden md:block w-64 bg-slate-900/40 border-r border-white/5 fixed h-full z-50\" />\r\n                            <main className=\"flex-1 md:ml-64 relative z-0\">{children}</main>\r\n                        </div>\r\n                        <Toaster position=\"top-right\" theme=\"dark\" closeButton richColors />\r\n                    </AIContextProvider>\r\n                </AuthProvider>\r\n            </QueryProvider>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <QueryProvider>\r\n            <AuthProvider>\r\n                <AIContextProvider>\r\n                    {/* Global Dark Background Base (Fix for App Hosting) */}\r\n                    <div className=\"fixed inset-0 bg-slate-950 z-[-2]\" />\r\n\r\n                    {/* Background Gradients (Global) */}\r\n                    <div className=\"fixed inset-0 pointer-events-none z-[-1]\">\r\n                        <div className=\"absolute top-0 left-[15%] w-[500px] h-[500px] bg-blue-500/10 rounded-full blur-[100px]\" />\r\n                        <div className=\"absolute bottom-0 right-[15%] w-[500px] h-[500px] bg-violet-500/10 rounded-full blur-[100px]\" />\r\n                    </div>\r\n\r\n                    {/* Mobile Menu Overlay */}\r\n                    {mobileMenuOpen && (\r\n                        <div\r\n                            className=\"fixed inset-0 bg-slate-950/80 backdrop-blur-sm z-[60] md:hidden animate-fade-in\"\r\n                            onClick={() => setMobileMenuOpen(false)}\r\n                        />\r\n                    )}\r\n\r\n                    {/* Sidebar */}\r\n                    <aside\r\n                        className={`\r\n                        fixed top-0 bottom-0 z-[70] flex flex-col glass-panel border-r border-white/5 border-t-0 border-b-0 border-l-0 transition-transform duration-300 ease-in-out\r\n                        md:left-0\r\n                        ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}\r\n                        ${collapsed ? 'md:w-20' : 'md:w-64'}\r\n                        w-64\r\n                        overflow-hidden md:overflow-visible\r\n                    `}\r\n                    >\r\n                        {/* Header / Logo */}\r\n                        <div className={`p-6 flex items-center ${collapsed ? 'md:justify-center' : 'justify-between'}`}>\r\n                            {(!collapsed || mobileMenuOpen) && (\r\n                                <Link href=\"/\" className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-violet-400 whitespace-nowrap overflow-hidden animate-fade-in\">\r\n                                    SalesTracker\r\n                                </Link>\r\n                            )}\r\n                            {collapsed && !mobileMenuOpen && (\r\n                                <Link href=\"/\" className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-violet-500 flex items-center justify-center font-bold text-white text-xs\">\r\n                                    ST\r\n                                </Link>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Sidebar Content with Auth */}\r\n                        <SidebarContent collapsed={collapsed} mobileMenuOpen={mobileMenuOpen} />\r\n\r\n                        {/* Collapse Toggle (Desktop Only) */}\r\n                        <button\r\n                            onClick={() => setCollapsed(!collapsed)}\r\n                            aria-label={collapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\r\n                            className=\"hidden md:flex absolute -right-3 top-24 w-6 h-6 rounded-full bg-slate-800 border border-slate-600 items-center justify-center text-slate-400 hover:text-white hover:border-white/50 transition-all shadow-lg z-50\"\r\n                        >\r\n                            {collapsed ? <ChevronRight size={14} /> : <ChevronLeft size={14} />}\r\n                        </button>\r\n                    </aside>\r\n\r\n                    {/* Main Content Area */}\r\n                    <main\r\n                        className={`\r\n                        flex-1 relative z-0 transition-all duration-300 ease-in-out min-h-screen flex flex-col\r\n                        ${collapsed ? 'md:ml-20' : 'md:ml-64'}\r\n                        ml-0\r\n                    `}\r\n                    >\r\n                        {/* Mobile Header */}\r\n                        <div className=\"md:hidden sticky top-0 z-40 bg-slate-900/80 backdrop-blur-md border-b border-white/5 p-4 flex items-center justify-between\">\r\n                            <div className=\"text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-violet-400\">\r\n                                SalesTracker\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setMobileMenuOpen(true)}\r\n                                aria-label=\"Open mobile menu\"\r\n                                className=\"p-2 text-slate-300 hover:text-white hover:bg-white/5 rounded-lg transition-colors\"\r\n                            >\r\n                                <Menu size={24} />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 w-full max-w-full overflow-x-hidden\">\r\n                            <ErrorBoundary>\r\n                                {children}\r\n                            </ErrorBoundary>\r\n                        </div>\r\n\r\n                        {/* Professional Footer */}\r\n                        <footer className=\"mt-auto border-t border-white/5 p-8 text-center md:text-left\">\r\n                            <div className=\"flex flex-col md:flex-row justify-between items-center gap-4\">\r\n                                <div className=\"text-sm text-slate-500\">\r\n                                     {new Date().getFullYear()} SalesTracker AI. All rights reserved.\r\n                                </div>\r\n                                <div className=\"flex items-center gap-6 text-sm\">\r\n                                    <Link href=\"/privacy\" className=\"text-slate-500 hover:text-indigo-400 transition-colors\">Privacy Policy</Link>\r\n                                    <Link href=\"/terms\" className=\"text-slate-500 hover:text-indigo-400 transition-colors\">Terms of Service</Link>\r\n                                    <a href=\"mailto:support@salestracker-ai.com\" className=\"text-slate-500 hover:text-indigo-400 transition-colors\">Support</a>\r\n                                </div>\r\n                            </div>\r\n                        </footer>\r\n                    </main>\r\n\r\n                    {/* Overlay components */}\r\n                    <CookieConsent />\r\n                    <WelcomeTour />\r\n\r\n                    {/* Toast notifications */}\r\n                    <Toaster position=\"top-right\" theme=\"dark\" closeButton richColors />\r\n                </AIContextProvider>\r\n            </AuthProvider>\r\n        </QueryProvider>\r\n    );\r\n}\r\n\r\nfunction NavLink({ href, icon, label, collapsed, mobile }: { href: string; icon: React.ReactNode; label: string; collapsed: boolean, mobile: boolean }) {\r\n    const pathname = usePathname();\r\n    const isActive = pathname === href;\r\n\r\n    const showLabel = !collapsed || mobile;\r\n\r\n    return (\r\n        <Link\r\n            href={href}\r\n            title={!showLabel ? label : ''}\r\n            aria-label={label}\r\n            className={`\r\n                group flex items-center rounded-xl transition-all duration-300 ease-out relative\r\n                ${!showLabel ? 'justify-center p-3' : 'px-4 py-3'}\r\n                ${isActive\r\n                    ? 'bg-gradient-to-r from-indigo-500/20 to-violet-500/5 text-indigo-300 border-l-2 border-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.15)]'\r\n                    : 'text-slate-400 hover:text-white hover:bg-white/5 border-l-2 border-transparent'}\r\n            `}\r\n        >\r\n            {/* Active Glow for Icon */}\r\n            {isActive && !showLabel && (\r\n                <div className=\"absolute inset-0 bg-indigo-500/20 rounded-xl blur-md\"></div>\r\n            )}\r\n\r\n            <span className={`relative z-10 transition-transform duration-200 ${isActive ? 'scale-110' : 'group-hover:scale-110'}`}>\r\n                {React.cloneElement(icon as React.ReactElement<any>, {\r\n                    className: isActive ? 'text-indigo-400 drop-shadow-[0_0_5px_rgba(99,102,241,0.5)]' : ''\r\n                })}\r\n            </span>\r\n\r\n            {showLabel && (\r\n                <span className={`ml-3 text-sm font-medium transition-opacity duration-200 ${isActive ? 'text-white' : ''}`}>\r\n                    {label}\r\n                </span>\r\n            )}\r\n\r\n            {/* Tooltip for collapsed state (Desktop only) */}\r\n            {!showLabel && (\r\n                <div className=\"absolute left-full ml-4 px-2 py-1 bg-slate-800 text-white text-xs rounded border border-white/10 opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50 shadow-xl hidden md:block\">\r\n                    {label}\r\n                </div>\r\n            )}\r\n        </Link>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\AddLeadModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\CallButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'callSid' is assigned a value but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Phone, PhoneOff, Loader2 } from 'lucide-react';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { toast } from 'sonner';\r\n\r\ninterface CallButtonProps {\r\n    leadId: string;\r\n    leadName: string;\r\n    leadPhone: string;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    variant?: 'primary' | 'ghost';\r\n}\r\n\r\ntype CallStatus = 'idle' | 'connecting' | 'ringing' | 'in-progress' | 'completed' | 'failed';\r\n\r\nexport function CallButton({\r\n    leadId,\r\n    leadName,\r\n    leadPhone,\r\n    size = 'md',\r\n    variant = 'primary'\r\n}: CallButtonProps) {\r\n    const { user: authUser } = useAuth();\r\n    // Fake user for testing if not logged in\r\n    const user = authUser || { uid: 'test-user', displayName: 'Test User' };\r\n\r\n    const [callStatus, setCallStatus] = useState<CallStatus>('idle');\r\n    const [callSid, setCallSid] = useState<string | null>(null);\r\n\r\n    const handleCall = async () => {\r\n        if (!leadPhone) {\r\n            toast.error('No phone number for this lead');\r\n            return;\r\n        }\r\n\r\n        setCallStatus('connecting');\r\n\r\n        try {\r\n            const response = await fetch('/api/twilio/call', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    leadPhone,\r\n                    userId: user.uid,\r\n                    leadId,\r\n                    leadName,\r\n                }),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Failed to initiate call');\r\n            }\r\n\r\n            setCallSid(data.callSid);\r\n            setCallStatus('ringing');\r\n            toast.success(`Calling ${leadName}...`);\r\n\r\n            // Simulate call progress (in production, use webhooks)\r\n            setTimeout(() => setCallStatus('in-progress'), 3000);\r\n\r\n        } catch (error) {\r\n            console.error('Call error:', error);\r\n            setCallStatus('failed');\r\n            toast.error(error instanceof Error ? error.message : 'Failed to initiate call');\r\n\r\n            // Reset after error\r\n            setTimeout(() => setCallStatus('idle'), 2000);\r\n        }\r\n    };\r\n\r\n    const handleEndCall = () => {\r\n        // In production, you'd call Twilio API to end the call\r\n        setCallStatus('completed');\r\n        toast.success('Call ended');\r\n\r\n        setTimeout(() => {\r\n            setCallStatus('idle');\r\n            setCallSid(null);\r\n        }, 1500);\r\n    };\r\n\r\n    const sizeClasses = {\r\n        sm: 'p-1.5',\r\n        md: 'p-2',\r\n        lg: 'p-3',\r\n    };\r\n\r\n    const iconSize = {\r\n        sm: 14,\r\n        md: 18,\r\n        lg: 22,\r\n    };\r\n\r\n    // Active call state\r\n    if (callStatus !== 'idle' && callStatus !== 'failed') {\r\n        return (\r\n            <div className=\"flex items-center gap-2\">\r\n                <button\r\n                    onClick={handleEndCall}\r\n                    className={`${sizeClasses[size]} rounded-lg bg-red-500 hover:bg-red-600 text-white transition-all shadow-lg animate-pulse`}\r\n                    title=\"End call\"\r\n                >\r\n                    <PhoneOff size={iconSize[size]} />\r\n                </button>\r\n                <span className=\"text-xs text-slate-400 capitalize\">\r\n                    {callStatus === 'connecting' && 'Connecting...'}\r\n                    {callStatus === 'ringing' && 'Ringing...'}\r\n                    {callStatus === 'in-progress' && 'In Progress'}\r\n                    {callStatus === 'completed' && 'Completed'}\r\n                </span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Idle/Failed state\r\n    const baseClasses = variant === 'primary'\r\n        ? 'bg-green-500 hover:bg-green-600 text-white shadow-lg shadow-green-500/20'\r\n        : 'text-slate-400 hover:text-green-400 hover:bg-white/5';\r\n\r\n    return (\r\n        <button\r\n            onClick={handleCall}\r\n            disabled={false}\r\n            className={`${sizeClasses[size]} rounded-lg ${baseClasses} transition-all disabled:opacity-50`}\r\n            title={`Call ${leadName}`}\r\n        >\r\n            <Phone size={iconSize[size]} />\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\EmailThreadsPanel.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadEmails'. Either include it or remove the dependency array.","line":35,"column":8,"nodeType":"ArrayExpression","endLine":35,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, lead.email, loadEmails]","fix":{"range":[1396,1416],"text":"[isOpen, lead.email, loadEmails]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":84,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Lead } from '@/types';\r\nimport { EmailRecord, getLeadEmails, syncEmailsForLead } from '@/lib/gmail/gmail-service';\r\nimport { analyzeEmail, analyzeEmailThread, EmailAnalysis } from '@/lib/gmail/email-analyzer';\r\nimport { toast } from 'sonner';\r\n\r\ninterface EmailThreadsPanelProps {\r\n    lead: Lead;\r\n    userId: string;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onDraftReply: (subject: string, body: string) => void;\r\n}\r\n\r\nexport function EmailThreadsPanel({ lead, userId, isOpen, onClose, onDraftReply }: EmailThreadsPanelProps) {\r\n    const [emails, setEmails] = useState<EmailRecord[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSyncing, setIsSyncing] = useState(false);\r\n    const [threadAnalysis, setThreadAnalysis] = useState<{\r\n        threadSummary: string;\r\n        overallSentiment: 'positive' | 'neutral' | 'negative';\r\n        engagementLevel: 'high' | 'medium' | 'low';\r\n        nextBestAction: string;\r\n        dealHealth: 'healthy' | 'at-risk' | 'stalled';\r\n    } | null>(null);\r\n    const [emailAnalyses, setEmailAnalyses] = useState<Record<string, EmailAnalysis>>({});\r\n    const [expandedEmailId, setExpandedEmailId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (isOpen && lead.email) {\r\n            loadEmails();\r\n        }\r\n    }, [isOpen, lead.email]);\r\n\r\n    const loadEmails = async () => {\r\n        setIsLoading(true);\r\n        try {\r\n            const data = await getLeadEmails(userId, lead.id);\r\n            setEmails(data);\r\n\r\n            // Analyze thread if we have emails\r\n            if (data.length > 0) {\r\n                const analysis = await analyzeEmailThread(data);\r\n                setThreadAnalysis(analysis);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading emails:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSync = async () => {\r\n        setIsSyncing(true);\r\n        try {\r\n            const synced = await syncEmailsForLead(userId, lead.email, lead.id);\r\n            setEmails(synced.sort((a, b) => b.timestamp - a.timestamp));\r\n            toast.success(`Synced ${synced.length} emails`);\r\n\r\n            // Re-analyze thread\r\n            if (synced.length > 0) {\r\n                const analysis = await analyzeEmailThread(synced);\r\n                setThreadAnalysis(analysis);\r\n            }\r\n        } catch (error: unknown) {\r\n            if (error instanceof Error && error.message === 'Gmail not connected') {\r\n                toast.error('Please connect Gmail in Settings first');\r\n            } else {\r\n                toast.error('Failed to sync emails');\r\n            }\r\n        } finally {\r\n            setIsSyncing(false);\r\n        }\r\n    };\r\n\r\n    const handleAnalyzeEmail = async (email: EmailRecord) => {\r\n        if (emailAnalyses[email.id]) return;\r\n\r\n        try {\r\n            const analysis = await analyzeEmail(email);\r\n            setEmailAnalyses(prev => ({ ...prev, [email.id]: analysis }));\r\n        } catch (error) {\r\n            toast.error('Failed to analyze email');\r\n        }\r\n    };\r\n\r\n    const getSentimentColor = (sentiment: string) => {\r\n        switch (sentiment) {\r\n            case 'positive': return 'text-green-400 bg-green-500/10 border-green-500/30';\r\n            case 'negative': return 'text-red-400 bg-red-500/10 border-red-500/30';\r\n            default: return 'text-slate-400 bg-slate-500/10 border-slate-500/30';\r\n        }\r\n    };\r\n\r\n    const getDealHealthColor = (health: string) => {\r\n        switch (health) {\r\n            case 'healthy': return 'text-green-400';\r\n            case 'at-risk': return 'text-amber-400';\r\n            default: return 'text-red-400';\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n            {/* Backdrop */}\r\n            <div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" onClick={onClose} />\r\n\r\n            {/* Panel */}\r\n            <div className=\"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-3xl max-h-[85vh] shadow-2xl flex flex-col\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-800\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-lg\">\r\n                                \r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-xl font-bold text-white\">Email History</h2>\r\n                                <p className=\"text-sm text-slate-400\">{lead.companyName}  {lead.email}</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <button\r\n                                onClick={handleSync}\r\n                                disabled={isSyncing}\r\n                                className=\"px-4 py-2 text-sm bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg text-slate-300 transition-colors flex items-center gap-2\"\r\n                            >\r\n                                {isSyncing ? (\r\n                                    <div className=\"w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full animate-spin\" />\r\n                                ) : (\r\n                                    <span></span>\r\n                                )}\r\n                                Sync Gmail\r\n                            </button>\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"text-slate-400 hover:text-white text-2xl px-2\"\r\n                            >\r\n                                \r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Thread Analysis Summary */}\r\n                    {threadAnalysis && (\r\n                        <div className=\"mt-4 p-4 bg-slate-800/50 rounded-lg border border-slate-700\">\r\n                            <div className=\"flex items-center justify-between mb-2\">\r\n                                <span className=\"text-sm text-slate-400\">AI Thread Analysis</span>\r\n                                <span className={`text-xs font-medium ${getDealHealthColor(threadAnalysis.dealHealth)}`}>\r\n                                    {threadAnalysis.dealHealth.toUpperCase()}\r\n                                </span>\r\n                            </div>\r\n                            <p className=\"text-sm text-slate-300 mb-2\">{threadAnalysis.threadSummary}</p>\r\n                            <div className=\"flex items-center gap-4 text-xs\">\r\n                                <span className={`px-2 py-1 rounded border ${getSentimentColor(threadAnalysis.overallSentiment)}`}>\r\n                                    {threadAnalysis.overallSentiment}\r\n                                </span>\r\n                                <span className=\"text-slate-500\">\r\n                                    Engagement: {threadAnalysis.engagementLevel}\r\n                                </span>\r\n                            </div>\r\n                            <div className=\"mt-2 flex items-center gap-2\">\r\n                                <span className=\"text-amber-400\"></span>\r\n                                <span className=\"text-sm text-amber-300\">{threadAnalysis.nextBestAction}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Email List */}\r\n                <div className=\"flex-1 overflow-y-auto p-6\">\r\n                    {isLoading ? (\r\n                        <div className=\"flex items-center justify-center py-12\">\r\n                            <div className=\"w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\r\n                        </div>\r\n                    ) : emails.length === 0 ? (\r\n                        <div className=\"text-center py-12\">\r\n                            <p className=\"text-slate-500 mb-4\">No emails found for this lead</p>\r\n                            <button\r\n                                onClick={handleSync}\r\n                                className=\"glass-button px-4 py-2\"\r\n                            >\r\n                                 Sync from Gmail\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {emails.map((email) => (\r\n                                <div\r\n                                    key={email.id}\r\n                                    className={`p-4 rounded-lg border transition-all cursor-pointer ${email.direction === 'sent'\r\n                                        ? 'bg-blue-500/5 border-blue-500/20 ml-8'\r\n                                        : 'bg-slate-800/50 border-slate-700 mr-8'\r\n                                        }`}\r\n                                    onClick={() => {\r\n                                        setExpandedEmailId(expandedEmailId === email.id ? null : email.id);\r\n                                        if (!emailAnalyses[email.id]) {\r\n                                            handleAnalyzeEmail(email);\r\n                                        }\r\n                                    }}\r\n                                >\r\n                                    <div className=\"flex items-start justify-between mb-2\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"text-lg\">\r\n                                                {email.direction === 'sent' ? '' : ''}\r\n                                            </span>\r\n                                            <span className=\"text-sm font-medium text-slate-300\">\r\n                                                {email.direction === 'sent' ? 'You' : lead.contactName}\r\n                                            </span>\r\n                                        </div>\r\n                                        <span className=\"text-xs text-slate-500\">\r\n                                            {new Date(email.timestamp).toLocaleString()}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    <p className=\"text-sm font-medium text-white mb-1\">{email.subject}</p>\r\n                                    <p className=\"text-sm text-slate-400\">\r\n                                        {expandedEmailId === email.id ? email.body : email.snippet}\r\n                                    </p>\r\n\r\n                                    {/* AI Analysis */}\r\n                                    {expandedEmailId === email.id && emailAnalyses[email.id] && (\r\n                                        <div className=\"mt-3 pt-3 border-t border-slate-700\">\r\n                                            <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                                                <span className={`text-xs px-2 py-1 rounded border ${getSentimentColor(emailAnalyses[email.id].sentiment)}`}>\r\n                                                    {emailAnalyses[email.id].sentiment}\r\n                                                </span>\r\n                                                <span className=\"text-xs px-2 py-1 rounded border border-slate-600 text-slate-400\">\r\n                                                    {emailAnalyses[email.id].intent}\r\n                                                </span>\r\n                                            </div>\r\n                                            <p className=\"text-xs text-slate-500 mb-2\">{emailAnalyses[email.id].summary}</p>\r\n                                            {emailAnalyses[email.id].dealSignals.length > 0 && (\r\n                                                <div className=\"flex flex-wrap gap-1\">\r\n                                                    {emailAnalyses[email.id].dealSignals.map((signal, i) => (\r\n                                                        <span key={i} className=\"text-xs px-2 py-0.5 bg-amber-500/10 text-amber-400 rounded\">\r\n                                                             {signal}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-6 border-t border-slate-800\">\r\n                    <button\r\n                        onClick={() => {\r\n                            const lastEmail = emails[0];\r\n                            onDraftReply(\r\n                                'Re: ' + (lastEmail?.subject || ''),\r\n                                ''\r\n                            );\r\n                            onClose();\r\n                        }}\r\n                        className=\"glass-button w-full py-2\"\r\n                    >\r\n                         Draft AI Reply\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\LogCallModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\LogMeetingModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\LogReplyModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4468,4471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4468,4471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Lead } from '@/types';\r\nimport { ActivitiesService, LeadsService } from '@/lib/firebase/services';\r\nimport { toast } from 'sonner';\r\n\r\ninterface LogReplyModalProps {\r\n    lead: Lead;\r\n    userId: string;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n}\r\n\r\nexport function LogReplyModal({ lead, userId, isOpen, onClose, onSuccess }: LogReplyModalProps) {\r\n    const [replyContent, setReplyContent] = useState('');\r\n    const [sentiment, setSentiment] = useState<'positive' | 'neutral' | 'negative'>('positive');\r\n    const [nextStep, setNextStep] = useState('');\r\n    const [isSaving, setIsSaving] = useState(false);\r\n\r\n    const handleSave = async () => {\r\n        if (!replyContent.trim()) {\r\n            toast.error('Please enter the reply content');\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            // Log the reply as an email activity\r\n            await ActivitiesService.logActivity(userId, {\r\n                type: 'email',\r\n                outcome: sentiment === 'positive' ? 'connected' : sentiment === 'negative' ? 'none' : 'connected',\r\n                leadId: lead.id,\r\n                notes: ` REPLY RECEIVED (${sentiment}): ${replyContent}`,\r\n                timestamp: Date.now(),\r\n                repId: userId\r\n            });\r\n\r\n            // Update lead\r\n            const updates: Partial<Lead> = {\r\n                lastContact: Date.now()\r\n            };\r\n\r\n            if (nextStep) {\r\n                updates.nextStep = nextStep;\r\n            }\r\n\r\n            // If positive reply and lead is New/Contacted, move to Contacted/Qualified\r\n            if (sentiment === 'positive') {\r\n                if (lead.status === 'New') {\r\n                    updates.status = 'Contacted';\r\n                } else if (lead.status === 'Contacted') {\r\n                    updates.status = 'Qualified';\r\n                }\r\n            }\r\n\r\n            await LeadsService.updateLead(userId, lead.id, updates);\r\n\r\n            toast.success('Reply logged! Lead updated.');\r\n            onSuccess();\r\n            onClose();\r\n\r\n            // Reset form\r\n            setReplyContent('');\r\n            setSentiment('positive');\r\n            setNextStep('');\r\n        } catch (error) {\r\n            console.error('Error logging reply:', error);\r\n            toast.error('Failed to log reply');\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\r\n            {/* Backdrop */}\r\n            <div className=\"absolute inset-0 bg-black/70 backdrop-blur-sm\" onClick={onClose} />\r\n\r\n            {/* Modal */}\r\n            <div className=\"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md shadow-2xl\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-800\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-lg\">\r\n                            \r\n                        </div>\r\n                        <div>\r\n                            <h2 className=\"text-xl font-bold text-white\">Log Email Reply</h2>\r\n                            <p className=\"text-sm text-slate-400\">{lead.companyName}  {lead.contactName}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 space-y-5\">\r\n                    {/* Sentiment */}\r\n                    <div>\r\n                        <label className=\"block text-sm text-slate-400 mb-2\">Reply Sentiment</label>\r\n                        <div className=\"flex gap-2\">\r\n                            {[\r\n                                { value: 'positive', label: 'Positive', icon: '', color: 'green' },\r\n                                { value: 'neutral', label: 'Neutral', icon: '', color: 'slate' },\r\n                                { value: 'negative', label: 'Negative', icon: '', color: 'red' },\r\n                            ].map((s) => (\r\n                                <button\r\n                                    key={s.value}\r\n                                    onClick={() => setSentiment(s.value as any)}\r\n                                    className={`flex-1 p-3 rounded-lg border text-center transition-all ${sentiment === s.value\r\n                                            ? `bg-${s.color}-500/20 border-${s.color}-500/50 text-${s.color}-300`\r\n                                            : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-700'\r\n                                        }`}\r\n                                    style={{\r\n                                        backgroundColor: sentiment === s.value\r\n                                            ? s.color === 'green' ? 'rgba(34, 197, 94, 0.2)'\r\n                                                : s.color === 'red' ? 'rgba(239, 68, 68, 0.2)'\r\n                                                    : 'rgba(100, 116, 139, 0.2)'\r\n                                            : undefined,\r\n                                        borderColor: sentiment === s.value\r\n                                            ? s.color === 'green' ? 'rgba(34, 197, 94, 0.5)'\r\n                                                : s.color === 'red' ? 'rgba(239, 68, 68, 0.5)'\r\n                                                    : 'rgba(100, 116, 139, 0.5)'\r\n                                            : undefined\r\n                                    }}\r\n                                >\r\n                                    <div className=\"text-xl mb-1\">{s.icon}</div>\r\n                                    <div className=\"text-xs\">{s.label}</div>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Reply Content */}\r\n                    <div>\r\n                        <label className=\"block text-sm text-slate-400 mb-2\">Reply Content or Summary</label>\r\n                        <textarea\r\n                            value={replyContent}\r\n                            onChange={(e) => setReplyContent(e.target.value)}\r\n                            className=\"glass-input w-full h-32 resize-none\"\r\n                            placeholder=\"Paste the reply or write a summary of what they said...\"\r\n                        />\r\n                        <p className=\"text-xs text-slate-500 mt-1\">Tip: Paste the email reply directly for full context</p>\r\n                    </div>\r\n\r\n                    {/* Next Step */}\r\n                    <div>\r\n                        <label className=\"block text-sm text-slate-400 mb-2\">Next Step</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={nextStep}\r\n                            onChange={(e) => setNextStep(e.target.value)}\r\n                            className=\"glass-input w-full\"\r\n                            placeholder=\"e.g., Schedule call, Send pricing\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-6 border-t border-slate-800 flex justify-end gap-3\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-4 py-2 text-slate-400 hover:text-white transition-colors\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSave}\r\n                        disabled={isSaving || !replyContent.trim()}\r\n                        className=\"glass-button px-6 py-2\"\r\n                    >\r\n                        {isSaving ? 'Saving...' : 'Log Reply'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\SMSChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":4,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used.","line":4,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addDoc' is defined but never used.","line":5,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'serverTimestamp' is defined but never used.","line":5,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":80},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[536,539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[536,539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3425,3428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3425,3428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { Send, Loader2, Phone, X, MoreVertical } from 'lucide-react';\r\nimport { collection, query, where, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '@/lib/firebase/config';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { toast } from 'sonner';\r\n\r\ninterface Message {\r\n    id: string;\r\n    body: string;\r\n    direction: 'inbound' | 'outbound';\r\n    status: string;\r\n    createdAt: any;\r\n    leadId: string;\r\n}\r\n\r\ninterface SMSChatWindowProps {\r\n    leadId: string;\r\n    leadName: string;\r\n    leadPhone: string;\r\n    onClose: () => void;\r\n}\r\n\r\nexport function SMSChatWindow({ leadId, leadName, leadPhone, onClose }: SMSChatWindowProps) {\r\n    const { user } = useAuth();\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [newMessage, setNewMessage] = useState('');\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSending, setIsSending] = useState(false);\r\n    const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Scroll to bottom on new messages\r\n    useEffect(() => {\r\n        if (scrollRef.current) {\r\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n        }\r\n    }, [messages]);\r\n\r\n    // Listen for messages\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        const q = query(\r\n            collection(db, 'users', user.uid, 'messages'),\r\n            where('leadId', '==', leadId),\r\n            orderBy('createdAt', 'asc')\r\n        );\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const msgs = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            })) as Message[];\r\n            setMessages(msgs);\r\n            setIsLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching messages:\", error);\r\n            setIsLoading(false);\r\n            // Index might be required\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, [user, leadId]);\r\n\r\n    const handleSend = async () => {\r\n        if (!newMessage.trim() || !user) return;\r\n\r\n        setIsSending(true);\r\n        try {\r\n            const response = await fetch('/api/twilio/sms', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    toNumber: leadPhone,\r\n                    message: newMessage.trim(),\r\n                    userId: user.uid,\r\n                    leadId,\r\n                }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || 'Failed to send');\r\n            }\r\n\r\n            setNewMessage('');\r\n            // Optimistic update handled by snapshot listener mostly, \r\n            // but we could add a temp message if needed. \r\n            // Twilio API is fast enough usually.\r\n        } catch (error) {\r\n            toast.error('Failed to send message');\r\n            console.error(error);\r\n        } finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            handleSend();\r\n        }\r\n    };\r\n\r\n    const formatTime = (timestamp: any) => {\r\n        if (!timestamp) return '';\r\n        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-[600px] w-full max-w-md bg-slate-900 rounded-2xl border border-slate-800 shadow-2xl overflow-hidden\">\r\n            {/* Header - Smartphone style */}\r\n            <div className=\"bg-slate-800/80 backdrop-blur-md p-4 flex items-center justify-between border-b border-white/5 z-10\">\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 font-bold\">\r\n                        {leadName.charAt(0)}\r\n                    </div>\r\n                    <div>\r\n                        <h3 className=\"font-semibold text-white text-sm\">{leadName}</h3>\r\n                        <p className=\"text-xs text-slate-400\">{leadPhone}</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/5 rounded-full text-slate-400 transition-colors\">\r\n                        <X size={18} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Chat Area */}\r\n            <div ref={scrollRef} className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-950/50 scroll-smooth\">\r\n                {isLoading && (\r\n                    <div className=\"flex justify-center py-8\">\r\n                        <Loader2 className=\"animate-spin text-slate-500\" />\r\n                    </div>\r\n                )}\r\n\r\n                {!isLoading && messages.length === 0 && (\r\n                    <div className=\"text-center py-8 text-slate-500 text-sm\">\r\n                        No messages yet. Start the conversation!\r\n                    </div>\r\n                )}\r\n\r\n                {messages.map((msg) => {\r\n                    const isOutbound = msg.direction === 'outbound';\r\n                    return (\r\n                        <div\r\n                            key={msg.id}\r\n                            className={`flex ${isOutbound ? 'justify-end' : 'justify-start'}`}\r\n                        >\r\n                            <div\r\n                                className={`max-w-[75%] px-4 py-2 rounded-2xl text-sm leading-relaxed ${isOutbound\r\n                                        ? 'bg-indigo-600 text-white rounded-br-none'\r\n                                        : 'bg-slate-800 text-slate-200 rounded-bl-none'\r\n                                    }`}\r\n                            >\r\n                                <p>{msg.body}</p>\r\n                                <div className={`text-[10px] mt-1 flex items-center gap-1 ${isOutbound ? 'text-indigo-200 justify-end' : 'text-slate-500'\r\n                                    }`}>\r\n                                    {formatTime(msg.createdAt)}\r\n                                    {isOutbound && (\r\n                                        <span>\r\n                                            {msg.status === 'delivered' ? '' : msg.status === 'sent' ? '' : ''}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Input Area */}\r\n            <div className=\"p-4 bg-slate-800/50 border-t border-white/5\">\r\n                <div className=\"flex items-end gap-2 bg-slate-900/50 p-2 rounded-xl border border-white/5 focus-within:border-indigo-500/50 transition-colors\">\r\n                    <textarea\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                        onKeyDown={handleKeyDown}\r\n                        placeholder=\"iMessage...\"\r\n                        className=\"flex-1 bg-transparent border-none text-white placeholder-slate-500 focus:ring-0 text-sm resize-none max-h-32 p-2\"\r\n                        rows={1}\r\n                        style={{ minHeight: '40px' }}\r\n                    />\r\n                    <button\r\n                        onClick={handleSend}\r\n                        disabled={!newMessage.trim() || isSending}\r\n                        className={`p-2 rounded-full mb-0.5 transition-all ${newMessage.trim()\r\n                                ? 'bg-indigo-500 text-white hover:bg-indigo-600'\r\n                                : 'bg-slate-800 text-slate-500'\r\n                            }`}\r\n                    >\r\n                        {isSending ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\SMSModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\leads\\VerifyNumberButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[262,265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[262,265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { ShieldCheck, Loader2, AlertCircle, CheckCircle2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\ninterface VerifyNumberButtonProps {\r\n    phoneNumber: string;\r\n    onVerified?: (data: any) => void;\r\n}\r\n\r\nexport function VerifyNumberButton({ phoneNumber, onVerified }: VerifyNumberButtonProps) {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [status, setStatus] = useState<'idle' | 'valid' | 'invalid'>('idle');\r\n    const [carrierInfo, setCarrierInfo] = useState<string | null>(null);\r\n\r\n    const handleVerify = async (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n\r\n        if (!phoneNumber) {\r\n            toast.error('No phone number to verify');\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        setStatus('idle');\r\n        setCarrierInfo(null);\r\n\r\n        try {\r\n            const response = await fetch('/api/twilio/lookup', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ phoneNumber }),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Verification failed');\r\n            }\r\n\r\n            if (data.valid) {\r\n                setStatus('valid');\r\n                const carrier = data.carrier?.name || 'Unknown Carrier';\r\n                const type = data.carrier?.type?.toUpperCase() || '';\r\n                const info = `${carrier} ${type ? `(${type})` : ''}`;\r\n                setCarrierInfo(info);\r\n                toast.success(`Number Verified: ${info}`);\r\n\r\n                if (onVerified) onVerified(data);\r\n            } else {\r\n                setStatus('invalid');\r\n                toast.error('Invalid phone number');\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('Verification error:', error);\r\n            setStatus('invalid');\r\n            toast.error('Verification failed');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    if (status === 'valid') {\r\n        return (\r\n            <div className=\"flex items-center gap-1.5 text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-full border border-emerald-500/20\" title={carrierInfo || 'Verified Valid'}>\r\n                <CheckCircle2 size={12} />\r\n                <span>Valid</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (status === 'invalid') {\r\n        return (\r\n            <div className=\"flex items-center gap-1.5 text-xs text-red-400 bg-red-500/10 px-2 py-1 rounded-full border border-red-500/20\" title=\"Number appears invalid\">\r\n                <AlertCircle size={12} />\r\n                <span>Invalid</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <button\r\n            onClick={handleVerify}\r\n            disabled={isLoading}\r\n            className={`\r\n                group flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium transition-all\r\n                ${isLoading\r\n                    ? 'bg-slate-800 text-slate-400 cursor-not-allowed'\r\n                    : 'bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 hover:text-indigo-300 border border-indigo-500/20 hover:border-indigo-500/40'\r\n                }\r\n            `}\r\n            title=\"Verify this number with Twilio Lookup\"\r\n        >\r\n            {isLoading ? (\r\n                <Loader2 size={12} className=\"animate-spin\" />\r\n            ) : (\r\n                <ShieldCheck size={12} />\r\n            )}\r\n            <span>{isLoading ? 'Verifying...' : 'Verify'}</span>\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\onboarding\\WelcomeTour.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used.","line":6,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { GlassCard } from '@/components/ui/GlassCard';\r\nimport { ShieldAlert, Target, Zap, Rocket, Check, ChevronRight, X } from 'lucide-react';\r\nimport confetti from 'canvas-confetti';\r\nimport { ProfileService } from '@/lib/firebase/services';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\n\r\ninterface TourStep {\r\n    title: string;\r\n    description: string;\r\n    icon: React.ReactNode;\r\n    color: string;\r\n}\r\n\r\nconst TOUR_STEPS: TourStep[] = [\r\n    {\r\n        title: \"Welcome to SalesTracker AI\",\r\n        description: \"Your new command center for high-stakes sales. We've built this to help you master every interaction using advanced enterprise telemetry.\",\r\n        icon: <Rocket className=\"w-8 h-8 text-blue-400\" />,\r\n        color: \"blue\"\r\n    },\r\n    {\r\n        title: \"The Intelligence Pipeline\",\r\n        description: \"Track your leads with sub-millisecond precision. Use the new Export feature to keep your data portable and secure.\",\r\n        icon: <Zap className=\"w-8 h-8 text-amber-400\" />,\r\n        color: \"amber\"\r\n    },\r\n    {\r\n        title: \"The Simulation Lab\",\r\n        description: \"Go beyond tracking. Enter the War Room or the Objection Dojo to wargame deals with aggressive AI buying committees.\",\r\n        icon: < ShieldAlert className=\"w-8 h-8 text-red-400\" />,\r\n        color: \"red\"\r\n    },\r\n    {\r\n        title: \"You're Ready to Scale\",\r\n        description: \"All enterprise guardrails are active. Your journey to venture-scale performance starts now.\",\r\n        icon: <Check className=\"w-8 h-8 text-green-400\" />,\r\n        color: \"green\"\r\n    }\r\n];\r\n\r\nexport function WelcomeTour() {\r\n    const { user, profile, refreshProfile } = useAuth();\r\n    const [currentStep, setCurrentStep] = useState(0);\r\n    const [isOpen, setIsOpen] = useState(true);\r\n\r\n    if (!profile || profile.onboarded || !isOpen) return null;\r\n\r\n    const handleNext = async () => {\r\n        if (currentStep < TOUR_STEPS.length - 1) {\r\n            setCurrentStep(currentStep + 1);\r\n        } else {\r\n            // Final step\r\n            confetti({\r\n                particleCount: 150,\r\n                spread: 70,\r\n                origin: { y: 0.6 },\r\n                colors: ['#6366f1', '#a855f7', '#ec4899']\r\n            });\r\n\r\n            if (user) {\r\n                await ProfileService.setOnboarded(user.uid);\r\n                await refreshProfile();\r\n            }\r\n            setIsOpen(false);\r\n        }\r\n    };\r\n\r\n    const handleSkip = async () => {\r\n        if (user) {\r\n            await ProfileService.setOnboarded(user.uid);\r\n            await refreshProfile();\r\n        }\r\n        setIsOpen(false);\r\n    };\r\n\r\n    const step = TOUR_STEPS[currentStep];\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[200] flex items-center justify-center p-6 bg-slate-950/60 backdrop-blur-sm\">\r\n            <motion.div\r\n                initial={{ opacity: 0, scale: 0.9, y: 20 }}\r\n                animate={{ opacity: 1, scale: 1, y: 0 }}\r\n                className=\"w-full max-w-lg\"\r\n            >\r\n                <GlassCard className=\"relative overflow-hidden border border-white/10 shadow-2xl\">\r\n                    {/* Background Glow */}\r\n                    <div className={`absolute -top-24 -right-24 w-48 h-48 bg-${step.color}-500/10 blur-[80px] rounded-full`} />\r\n\r\n                    <button\r\n                        onClick={handleSkip}\r\n                        className=\"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors p-2\"\r\n                    >\r\n                        <X size={20} />\r\n                    </button>\r\n\r\n                    <div className=\"p-8\">\r\n                        <AnimatePresence mode=\"wait\">\r\n                            <motion.div\r\n                                key={currentStep}\r\n                                initial={{ opacity: 0, x: 20 }}\r\n                                animate={{ opacity: 1, x: 0 }}\r\n                                exit={{ opacity: 0, x: -20 }}\r\n                                transition={{ duration: 0.3 }}\r\n                                className=\"text-center\"\r\n                            >\r\n                                <div className={`w-16 h-16 bg-${step.color}-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl`}>\r\n                                    {step.icon}\r\n                                </div>\r\n\r\n                                <h2 className=\"text-2xl font-bold text-white mb-4\">\r\n                                    {step.title}\r\n                                </h2>\r\n\r\n                                <p className=\"text-slate-400 leading-relaxed mb-8 min-h-[80px]\">\r\n                                    {step.description}\r\n                                </p>\r\n                            </motion.div>\r\n                        </AnimatePresence>\r\n\r\n                        <div className=\"flex items-center justify-between\">\r\n                            {/* Progress Dots */}\r\n                            <div className=\"flex gap-2\">\r\n                                {TOUR_STEPS.map((_, i) => (\r\n                                    <div\r\n                                        key={i}\r\n                                        className={`h-1.5 rounded-full transition-all duration-300 ${i === currentStep ? 'w-8 bg-indigo-500' : 'w-2 bg-slate-700'\r\n                                            }`}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleNext}\r\n                                className=\"group flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white rounded-xl font-semibold transition-all shadow-lg active:scale-95\"\r\n                            >\r\n                                {currentStep === TOUR_STEPS.length - 1 ? \"Get Started\" : \"Continue\"}\r\n                                <ChevronRight className=\"w-4 h-4 group-hover:translate-x-1 transition-transform\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </GlassCard>\r\n            </motion.div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\providers\\AIContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\providers\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\providers\\QueryProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\BoardroomRunner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mic' is defined but never used.","line":5,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MicOff' is defined but never used.","line":5,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used.","line":6,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":6,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n    X, Users, MessageSquare, Mic, MicOff,\r\n    BrainCircuit, AlertCircle, Play, Send\r\n} from 'lucide-react';\r\nimport Image from 'next/image';\r\nimport { GeminiService } from '@/lib/ai/gemini';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { AIBoardroomAgent, AIBoardroomTranscriptItem } from '@/types/ai';\r\nimport { TimeMachine } from '@/components/training/TimeMachine';\r\n\r\ninterface BoardroomRunnerProps {\r\n    onClose: () => void;\r\n}\r\n\r\ntype Agent = AIBoardroomAgent;\r\n\r\ntype TranscriptItem = AIBoardroomTranscriptItem;\r\n\r\nexport function BoardroomRunner({ onClose }: BoardroomRunnerProps) {\r\n    const { user } = useAuth();\r\n    const [status, setStatus] = useState<'init' | 'playing' | 'loading_turn' | 'time_machine'>('init');\r\n    const [agents, setAgents] = useState<Agent[]>([]);\r\n    const [transcript, setTranscript] = useState<TranscriptItem[]>([]);\r\n    const [inputValue, setInputValue] = useState(\"\");\r\n    const [outcome, setOutcome] = useState<'win' | 'loss'>('loss'); // Default to loss for drama\r\n    const transcriptEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    // --- INITIALIZATION ---\r\n    useEffect(() => {\r\n        async function init() {\r\n            try {\r\n                const token = await user?.getIdToken();\r\n                const scenario = await GeminiService.generateBoardroomScenario(token);\r\n                if (scenario && scenario.stakeholders) {\r\n                    setAgents(scenario.stakeholders);\r\n                    setStatus('playing');\r\n                    // Initial welcome message from the Champion\r\n                    const champion = scenario.stakeholders.find((s: AIBoardroomAgent) => s.archetype === 'Champion') || scenario.stakeholders[0];\r\n                    setTranscript([{\r\n                        id: 'init',\r\n                        speaker: champion.name,\r\n                        speakerId: champion.id,\r\n                        message: \"Thanks for coming in. We&apos;re all here. Why don&apos;t you kick us off?\",\r\n                        type: 'speech'\r\n                    }]);\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Failed to init boardroom\", e);\r\n            }\r\n        }\r\n        init();\r\n    }, [user]);\r\n\r\n    // --- SCROLL TO BOTTOM ---\r\n    useEffect(() => {\r\n        transcriptEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [transcript]);\r\n\r\n    // --- GAME LOOP ---\r\n    const handleTurn = async () => {\r\n        if (!inputValue.trim() || status === 'loading_turn') return;\r\n\r\n        const userMsg = inputValue;\r\n        setInputValue(\"\");\r\n        setStatus('loading_turn');\r\n\r\n        // 1. Add User Message\r\n        const newTranscript = [...transcript, {\r\n            id: Date.now().toString(),\r\n            speaker: 'You',\r\n            speakerId: 'user',\r\n            message: userMsg,\r\n            type: 'speech' as const\r\n        }];\r\n        setTranscript(newTranscript);\r\n\r\n        try {\r\n            const token = await user?.getIdToken();\r\n            const result = await GeminiService.evaluateBoardroomTurn(agents, userMsg, newTranscript, token);\r\n\r\n            if (result) {\r\n                const turnId = Date.now().toString();\r\n\r\n                // Add AI Responses to transcript\r\n                const updates: TranscriptItem[] = [];\r\n\r\n                // 2. Main Response\r\n                if (result.response) {\r\n                    const speaker = agents.find(a => a.id === result.mainSpeakerId);\r\n                    updates.push({\r\n                        id: `resp-${turnId}`,\r\n                        speaker: speaker?.name || 'Unknown',\r\n                        speakerId: result.mainSpeakerId,\r\n                        message: result.response,\r\n                        type: 'speech'\r\n                    });\r\n                }\r\n\r\n                // 3. Whispers (Thoughts)\r\n                if (result.whispers) {\r\n                    result.whispers.forEach((w: { agentId: string; thought: string }, idx: number) => {\r\n                        const agent = agents.find(a => a.id === w.agentId);\r\n                        updates.push({\r\n                            id: `whisp-${turnId}-${idx}`,\r\n                            speaker: agent?.name || 'Unknown',\r\n                            speakerId: w.agentId,\r\n                            message: w.thought,\r\n                            type: 'whisper'\r\n                        });\r\n                    });\r\n                }\r\n\r\n                // 4. Sidebar\r\n                if (result.sidebar) {\r\n                    const from = agents.find(a => a.id === result.sidebar!.fromId);\r\n                    const to = agents.find(a => a.id === result.sidebar!.toId);\r\n                    updates.push({\r\n                        id: `side-${turnId}`,\r\n                        speaker: from?.name || 'Unknown',\r\n                        speakerId: result.sidebar.fromId,\r\n                        targetId: result.sidebar.toId,\r\n                        message: `(to ${to?.name?.split(' ')[0]}): ${result.sidebar.message}`,\r\n                        type: 'sidebar'\r\n                    });\r\n                }\r\n\r\n                setTranscript(prev => [...prev, ...updates]);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Turn failed\", e);\r\n        } finally {\r\n            setStatus('playing');\r\n        }\r\n    };\r\n\r\n    const handleEndMeeting = () => {\r\n        // Simple heuristic: If average patience > 50, it's a win.\r\n        // In reality, this should be an AI evaluation.\r\n        const avgPatience = agents.reduce((acc, curr) => acc + curr.patience, 0) / agents.length;\r\n        setOutcome(avgPatience > 50 ? 'win' : 'loss');\r\n        setStatus('time_machine');\r\n    };\r\n\r\n    if (status === 'time_machine') {\r\n        return <TimeMachine transcript={transcript} outcome={outcome} onClose={onClose} />;\r\n    }\r\n\r\n    if (status === 'init') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 bg-slate-950 flex flex-col items-center justify-center p-4\">\r\n                <div className=\"w-16 h-16 border-4 border-blue-500/30 border-t-blue-500 rounded-full animate-spin mb-4\"></div>\r\n                <h2 className=\"text-xl font-bold text-white tracking-widest uppercase\">Assembling The Board...</h2>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 bg-slate-950 text-slate-200 font-sans flex flex-col\">\r\n\r\n            {/* HEADER */}\r\n            <div className=\"h-16 border-b border-white/10 bg-slate-900 flex items-center justify-between px-6 shrink-0 relative z-20\">\r\n                <h1 className=\"text-lg font-bold text-white uppercase tracking-wider flex items-center gap-2\">\r\n                    <Users className=\"text-blue-500\" /> The Boardroom\r\n                </h1>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <button\r\n                        onClick={handleEndMeeting}\r\n                        className=\"px-3 py-1 bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white rounded-full text-xs font-bold uppercase tracking-wider border border-red-500/20 transition-all\"\r\n                    >\r\n                        End Meeting\r\n                    </button>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full transition-colors\">\r\n                        <X size={20} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* MAIN STAGE (Isometric View Simulation) */}\r\n            <div className=\"flex-1 overflow-hidden relative bg-[#0f172a] perspective-1000\">\r\n\r\n                {/* Table Surface */}\r\n                <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[400px] bg-indigo-950/20 rounded-[100px] border border-indigo-500/20 shadow-[0_0_100px_rgba(79,70,229,0.1)] transform rotate-x-60\"></div>\r\n\r\n                {/* Agents */}\r\n                <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n                    {/* Left Agent (Champion) */}\r\n                    <div className=\"absolute left-[15%] top-[40%] text-center transform hover:scale-105 transition-transform duration-500 pointer-events-auto\">\r\n                        <AgentAvatar agent={agents[1]} isSpeaking={false} />\r\n                    </div>\r\n\r\n                    {/* Middle Agent (Decision Maker) */}\r\n                    <div className=\"absolute top-[20%] text-center transform hover:scale-105 transition-transform duration-500 pointer-events-auto\">\r\n                        <AgentAvatar agent={agents[2]} isSpeaking={false} />\r\n                    </div>\r\n\r\n                    {/* Right Agent (Blocker) */}\r\n                    <div className=\"absolute right-[15%] top-[40%] text-center transform hover:scale-105 transition-transform duration-500 pointer-events-auto\">\r\n                        <AgentAvatar agent={agents[0]} isSpeaking={false} />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Transcript Overlay (Floating HUD) */}\r\n                <div className=\"absolute bottom-24 left-1/2 -translate-x-1/2 w-full max-w-3xl h-[300px] pointer-events-auto\">\r\n                    <div className=\"h-full overflow-y-auto px-4 space-y-4 custom-scrollbar mask-image-linear-to-t\">\r\n                        {transcript.map(item => (\r\n                            <ChatBubble key={item.id} item={item} />\r\n                        ))}\r\n                        {status === 'loading_turn' && (\r\n                            <div className=\"flex justify-start\">\r\n                                <div className=\"bg-slate-800/50 rounded-lg px-4 py-2 text-xs text-slate-400 italic flex items-center gap-2\">\r\n                                    <BrainCircuit size={12} className=\"animate-pulse\" /> The Board is deliberating...\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <div ref={transcriptEndRef} />\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {/* INPUT AREA */}\r\n            <div className=\"h-20 bg-slate-900 border-t border-white/5 p-4 flex items-center justify-center gap-4 relative z-20\">\r\n                <div className=\"w-full max-w-3xl relative\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={inputValue}\r\n                        onChange={(e) => setInputValue(e.target.value)}\r\n                        onKeyDown={(e) => e.key === 'Enter' && handleTurn()}\r\n                        placeholder=\"Make your pitch...\"\r\n                        className=\"w-full bg-slate-950/50 border border-slate-700 rounded-full px-6 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all font-medium\"\r\n                        autoFocus\r\n                    />\r\n                    <button\r\n                        onClick={handleTurn}\r\n                        disabled={status === 'loading_turn' || !inputValue.trim()}\r\n                        className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        <Send size={18} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- SUBCOMPONENTS ---\r\n\r\nfunction AgentAvatar({ agent, isSpeaking }: { agent: Agent, isSpeaking: boolean }) {\r\n    if (!agent) return null;\r\n    return (\r\n        <div className=\"flex flex-col items-center group\">\r\n            <div className={`\r\n                w-24 h-24 rounded-full border-4 overflow-hidden bg-slate-800 shadow-2xl relative transition-all duration-300\r\n                ${agent.archetype === 'Blocker' ? 'border-red-500/30 group-hover:border-red-500' :\r\n                    agent.archetype === 'Champion' ? 'border-green-500/30 group-hover:border-green-500' :\r\n                        'border-blue-500/30 group-hover:border-blue-500'}\r\n                ${isSpeaking ? 'scale-110 shadow-[0_0_30px_rgba(255,255,255,0.2)]' : ''}\r\n            `}>\r\n                <Image\r\n                    src={agent.avatar}\r\n                    alt={agent.name}\r\n                    fill\r\n                    className=\"object-cover\"\r\n                />\r\n            </div>\r\n\r\n            {/* Nameplate */}\r\n            <div className=\"mt-4 bg-slate-900/80 backdrop-blur border border-white/10 px-4 py-2 rounded-lg text-center transform transition-transform group-hover:-translate-y-1\">\r\n                <div className=\"font-bold text-white text-sm\">{agent.name}</div>\r\n                <div className=\"text-[10px] uppercase tracking-wider font-mono text-slate-400\">{agent.role}</div>\r\n            </div>\r\n\r\n            {/* Hover Info */}\r\n            <div className=\"mt-2 opacity-0 group-hover:opacity-100 transition-opacity text-[10px] bg-black/60 px-2 py-1 rounded text-slate-300\">\r\n                {agent.archetype}  Dom: {agent.dominance}%\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction ChatBubble({ item }: { item: TranscriptItem }) {\r\n    if (item.type === 'whisper') {\r\n        return (\r\n            <div className=\"flex justify-center my-2\">\r\n                <div className=\"bg-slate-900/40 border border-slate-700/50 rounded-full px-4 py-1.5 flex items-center gap-2 max-w-lg backdrop-blur-sm animate-in fade-in zoom-in-95\">\r\n                    <BrainCircuit size={12} className=\"text-purple-400\" />\r\n                    <span className=\"text-[10px] font-bold text-purple-400 uppercase tracking-wider\">{item.speaker}&apos;s Thought:</span>\r\n                    <span className=\"text-xs text-slate-300 italic\">&ldquo;{item.message}&rdquo;</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (item.type === 'sidebar') {\r\n        return (\r\n            <div className=\"flex justify-center my-2\">\r\n                <div className=\"bg-amber-900/20 border border-amber-500/30 rounded-full px-4 py-1.5 flex items-center gap-2 max-w-lg backdrop-blur-sm animate-in fade-in zoom-in-95\">\r\n                    <MessageSquare size={12} className=\"text-amber-500\" />\r\n                    <span className=\"text-[10px] font-bold text-amber-500 uppercase tracking-wider\">Sidebar ({item.speaker}):</span>\r\n                    <span className=\"text-xs text-amber-200/80 italic\">&ldquo;{item.message}&rdquo;</span>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Standard Speech\r\n    const isUser = item.speakerId === 'user';\r\n    return (\r\n        <div className={`flex ${isUser ? 'justify-end' : 'justify-start'} animate-in slide-in-from-bottom-2 duration-300`}>\r\n            <div className={`max-w-md p-4 rounded-2xl shadow-lg border ${isUser\r\n                ? 'bg-blue-600 text-white rounded-br-none border-blue-500'\r\n                : 'bg-slate-800 text-slate-200 rounded-bl-none border-slate-700'\r\n                }`}>\r\n                {!isUser && <div className=\"text-xs font-bold text-slate-400 mb-1\">{item.speaker}</div>}\r\n                <div className=\"text-sm leading-relaxed\">{item.message}</div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\CourseViewerModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\DojoRunner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":4,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Database' is defined but never used.","line":4,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":89}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { X, Mic, Send, User, Bot, AlertCircle, CheckCircle, RefreshCw, Loader2, Database, FileText } from 'lucide-react';\r\nimport { GeminiService } from '@/lib/ai/gemini';\r\nimport { ResourcesService } from '@/lib/firebase/resources';\r\nimport { Resource } from '@/types';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { AIPersona } from '@/types/ai';\r\n\r\ninterface DojoRunnerProps {\r\n    onClose: () => void;\r\n}\r\n\r\ntype Message = {\r\n    id: string;\r\n    sender: 'user' | 'ai';\r\n    text: string;\r\n    timestamp: number;\r\n    score?: {\r\n        empathy: number;\r\n        clarity: number;\r\n        confidence: number;\r\n    };\r\n};\r\n\r\n// Default persona if generation fails\r\nconst DEFAULT_PERSONA: AIPersona = {\r\n    name: \"Marcus Steele\",\r\n    role: \"CFO\",\r\n    company: \"Nexus Financial\",\r\n    personality: \"Direct, skeptical, focused on bottom-line ROI. Impatient with fluff.\",\r\n    painPoints: [\"Rising operational costs\", \"Vendor sprawl\"],\r\n    hiddenAgenda: \"Looking to cut 10% of budget to meet Q4 targets\",\r\n    objections: [\"Price is too high\", \"Timing isn't right\"]\r\n};\r\n\r\nexport function DojoRunner({ onClose }: DojoRunnerProps) {\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [inputText, setInputText] = useState('');\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [isTyping, setIsTyping] = useState(false);\r\n    const [loadingPersona, setLoadingPersona] = useState(false); // Start false, wait for setup\r\n    const [persona, setPersona] = useState<AIPersona | null>(null);\r\n    const [status, setStatus] = useState<'setup' | 'playing'>('setup');\r\n\r\n    // Setup State\r\n    const [resources, setResources] = useState<Resource[]>([]);\r\n    const [selectedResourceId, setSelectedResourceId] = useState<string | null>(null);\r\n    const [loadingResources, setLoadingResources] = useState(false);\r\n    const [contextContent, setContextContent] = useState<string>(\"\");\r\n\r\n    const chatEndRef = useRef<HTMLDivElement>(null);\r\n    const { user } = useAuth();\r\n\r\n    // Fetch resources on mount\r\n    useEffect(() => {\r\n        setLoadingResources(true);\r\n        const fetchData = async () => {\r\n            try {\r\n                const companyData = await ResourcesService.getCompanyResources();\r\n                let userData: Resource[] = [];\r\n                if (user) {\r\n                    userData = await ResourcesService.getUserResources(user.uid);\r\n                }\r\n                const allData = [...companyData, ...userData];\r\n\r\n                // Filter for likely text-based files\r\n                const textBased = allData.filter(r => r.type === 'document' || r.type === 'sheet' || r.title.endsWith('.txt') || r.title.endsWith('.md'));\r\n                setResources(textBased);\r\n            } catch (err) {\r\n                console.error(err);\r\n            } finally {\r\n                setLoadingResources(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, [user]);\r\n\r\n    const startSession = async () => {\r\n        setStatus('playing');\r\n        setLoadingPersona(true);\r\n\r\n        try {\r\n            // 1. Fetch text if selected\r\n            let content = \"\";\r\n            if (selectedResourceId) {\r\n                const res = resources.find(r => r.id === selectedResourceId);\r\n                if (res?.url) {\r\n                    try {\r\n                        const response = await fetch(res.url);\r\n                        content = await response.text();\r\n                        setContextContent(content); // Save for replies\r\n                    } catch (e) { console.error(e); }\r\n                }\r\n            }\r\n\r\n            // 2. Generate Persona\r\n            const token = await user?.getIdToken();\r\n            const newPersona = await GeminiService.generatePersona(\"CFO\", \"SaaS Tech\", content, token);\r\n            const activePersona = newPersona || DEFAULT_PERSONA;\r\n\r\n            setPersona(activePersona);\r\n\r\n            // 3. Greeting\r\n            const greeting = await GeminiService.generateReply(activePersona, [], \"Start the conversation by stating your main objection immediately.\", content, token);\r\n\r\n            setMessages([{\r\n                id: 'welcome',\r\n                sender: 'ai',\r\n                text: greeting,\r\n                timestamp: Date.now()\r\n            }]);\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to init Dojo\", error);\r\n            setPersona(DEFAULT_PERSONA);\r\n        } finally {\r\n            setLoadingPersona(false);\r\n        }\r\n    };\r\n\r\n    // Auto-scroll to bottom\r\n    useEffect(() => {\r\n        chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    }, [messages, isTyping]);\r\n\r\n    const handleSend = async () => {\r\n        if (!inputText.trim() || !persona) return;\r\n\r\n        const newUserMsg: Message = {\r\n            id: Date.now().toString(),\r\n            sender: 'user',\r\n            text: inputText,\r\n            timestamp: Date.now(),\r\n        };\r\n\r\n        setMessages(prev => [...prev, newUserMsg]);\r\n        setInputText('');\r\n        setIsTyping(true);\r\n\r\n        try {\r\n            // Convert current messages to history format\r\n            const history = messages.map(m => ({\r\n                role: m.sender,\r\n                content: m.text\r\n            }));\r\n\r\n            // Add latest user message to context implicitly or explicitly\r\n            // Add latest user message to context implicitly or explicitly\r\n            const token = await user?.getIdToken();\r\n            const aiResponseText = await GeminiService.generateReply(persona, history, newUserMsg.text, contextContent, token);\r\n\r\n            const newAiMsg: Message = {\r\n                id: (Date.now() + 1).toString(),\r\n                sender: 'ai',\r\n                text: aiResponseText,\r\n                timestamp: Date.now(),\r\n                // Mock score for now until we add a specific \"Evaluate\" endpoint\r\n                score: {\r\n                    empathy: Math.floor(Math.random() * 20) + 70,\r\n                    clarity: Math.floor(Math.random() * 20) + 75,\r\n                    confidence: Math.floor(Math.random() * 20) + 80,\r\n                }\r\n            };\r\n\r\n            setMessages(prev => [...prev, newAiMsg]);\r\n        } catch (error) {\r\n            console.error(\"AI Reply Failed\", error);\r\n        } finally {\r\n            setIsTyping(false);\r\n        }\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault();\r\n            handleSend();\r\n        }\r\n    };\r\n\r\n    if (status === 'setup') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/95 backdrop-blur-md p-4\">\r\n                <div className=\"max-w-2xl w-full bg-slate-900 border border-slate-800 rounded-xl p-8 shadow-2xl relative overflow-hidden\">\r\n                    <div className=\"absolute top-0 right-0 w-64 h-64 bg-indigo-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none\"></div>\r\n\r\n                    <button onClick={onClose} className=\"absolute top-4 right-4 text-slate-500 hover:text-white\">\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n\r\n                    <div className=\"mb-8\">\r\n                        <h2 className=\"text-3xl font-bold text-white mb-2 flex items-center gap-3\">\r\n                            <span className=\"p-2 bg-indigo-600/20 rounded-lg text-indigo-400\"><Bot className=\"w-6 h-6\" /></span>\r\n                            Dojo Setup\r\n                        </h2>\r\n                        <p className=\"text-slate-400\">Configure your sparring partner. Upload enablement docs to practice against real objections.</p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-slate-300 mb-3 uppercase tracking-wider\">Enablement Context (Optional)</label>\r\n\r\n                            {loadingResources ? (\r\n                                <div className=\"flex items-center gap-2 text-slate-500 p-4 border border-dashed border-slate-800 rounded-lg\">\r\n                                    <Loader2 className=\"w-4 h-4 animate-spin\" /> Loading resources...\r\n                                </div>\r\n                            ) : resources.length === 0 ? (\r\n                                <div className=\"p-4 border border-dashed border-slate-800 rounded-lg text-slate-500 text-sm text-center\">\r\n                                    No text-based resources found. Upload documents in the Resources tab.\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar\">\r\n                                    {resources.map(res => (\r\n                                        <div\r\n                                            key={res.id}\r\n                                            onClick={() => setSelectedResourceId(selectedResourceId === res.id ? null : res.id)}\r\n                                            className={`\r\n                                                p-3 rounded-lg border cursor-pointer transition-all flex items-center gap-3\r\n                                                ${selectedResourceId === res.id\r\n                                                    ? 'bg-indigo-600/20 border-indigo-500 text-white shadow-[0_0_15px_rgba(99,102,241,0.2)]'\r\n                                                    : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-800 hover:border-slate-600'}\r\n                                            `}\r\n                                        >\r\n                                            <FileText className={`w-5 h-5 ${selectedResourceId === res.id ? 'text-indigo-400' : 'text-slate-500'}`} />\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"font-medium truncate text-sm\">{res.title}</div>\r\n                                                <div className=\"text-xs opacity-60 truncate\">{res.category}</div>\r\n                                            </div>\r\n                                            {selectedResourceId === res.id && <CheckCircle className=\"w-4 h-4 text-indigo-400\" />}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"pt-6 border-t border-slate-800 flex justify-end gap-3\">\r\n                            <button onClick={onClose} className=\"px-6 py-3 rounded-lg text-slate-400 font-medium hover:text-white transition-colors\">\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={startSession}\r\n                                className=\"px-8 py-3 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white font-bold shadow-lg shadow-indigo-900/20 flex items-center gap-2 transition-all transform hover:scale-[1.02]\"\r\n                            >\r\n                                <Bot className=\"w-5 h-5\" />\r\n                                Enter Dojo\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (loadingPersona || !persona) {\r\n        return (\r\n            <div className=\"fixed inset-0 left-64 z-50 flex items-center justify-center p-4 bg-slate-900/95 backdrop-blur-md\">\r\n                <div className=\"flex flex-col items-center gap-4 text-white\">\r\n                    <Loader2 size={48} className=\"animate-spin text-indigo-500\" />\r\n                    <div className=\"text-xl font-bold animate-pulse\">Summoning Prospect...</div>\r\n                    <div className=\"text-sm text-slate-400\">Generative AI is creating a unique persona</div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 left-64 z-50 flex items-center justify-center p-4 bg-slate-900/95 backdrop-blur-md\">\r\n            <div className=\"w-full max-w-5xl h-[90vh] flex gap-6\">\r\n\r\n                {/* Main Chat Area */}\r\n                <div className=\"flex-1 glass-card flex flex-col p-0 overflow-hidden relative\">\r\n                    {/* Header */}\r\n                    <div className=\"p-4 border-b border-white/10 flex justify-between items-center bg-indigo-900/20\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center border-2 border-indigo-400/30\">\r\n                                <Bot size={20} className=\"text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"font-bold text-white\">{persona.name}</h3>\r\n                                <div className=\"flex items-center gap-1 text-xs text-indigo-300\">\r\n                                    <span className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\"></span>\r\n                                    {persona.role} @ {persona.company}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full text-slate-400 hover:text-white transition-colors\">\r\n                            <X size={20} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Messages */}\r\n                    <div className=\"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar\">\r\n                        <div className=\"p-4 bg-indigo-500/10 border border-indigo-500/20 rounded-xl mb-6\">\r\n                            <h4 className=\"text-sm font-bold text-indigo-300 flex items-center gap-2 mb-1\">\r\n                                <User size={14} /> Application Context\r\n                            </h4>\r\n                            <p className=\"text-xs text-slate-300 italic\">\r\n                                &ldquo;{persona.personality}&rdquo;\r\n                                <br />\r\n                                <span className=\"opacity-75\">Agenda: {persona.painPoints[0]}</span>\r\n                            </p>\r\n                        </div>\r\n\r\n                        {messages.map((msg) => (\r\n                            <div key={msg.id} className={`flex gap-4 ${msg.sender === 'user' ? 'flex-row-reverse' : ''}`}>\r\n                                <div className={`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${msg.sender === 'user'\r\n                                    ? 'bg-fuchsia-600 text-white'\r\n                                    : 'bg-indigo-600 text-white'\r\n                                    }`}>\r\n                                    {msg.sender === 'user' ? <User size={14} /> : <Bot size={14} />}\r\n                                </div>\r\n\r\n                                <div className={`max-w-[70%] space-y-2`}>\r\n                                    <div className={`p-4 rounded-2xl ${msg.sender === 'user'\r\n                                        ? 'bg-fuchsia-600/20 border border-fuchsia-500/30 text-white rounded-tr-none'\r\n                                        : 'bg-indigo-600/20 border border-indigo-500/30 text-slate-100 rounded-tl-none'\r\n                                        }`}>\r\n                                        <p className=\"leading-relaxed text-sm md:text-base\">{msg.text}</p>\r\n                                    </div>\r\n\r\n                                    {/* Score Feedback */}\r\n                                    {msg.sender === 'ai' && msg.id !== 'welcome' && (\r\n                                        <div className=\"flex gap-2 text-xs\">\r\n                                            <span className=\"px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/20\">\r\n                                                Empathy: {msg.score?.empathy}%\r\n                                            </span>\r\n                                            <span className=\"px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400 border border-blue-500/20\">\r\n                                                Clarity: {msg.score?.clarity}%\r\n                                            </span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {isTyping && (\r\n                            <div className=\"flex gap-4\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center\">\r\n                                    <Bot size={14} className=\"text-white\" />\r\n                                </div>\r\n                                <div className=\"bg-indigo-600/20 border border-indigo-500/30 px-4 py-3 rounded-2xl rounded-tl-none flex gap-1 items-center\">\r\n                                    <span className=\"w-2 h-2 bg-indigo-400 rounded-full animate-bounce\"></span>\r\n                                    <span className=\"w-2 h-2 bg-indigo-400 rounded-full animate-bounce delay-75\"></span>\r\n                                    <span className=\"w-2 h-2 bg-indigo-400 rounded-full animate-bounce delay-150\"></span>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <div ref={chatEndRef} />\r\n                    </div>\r\n\r\n                    {/* Input Area */}\r\n                    <div className=\"p-4 bg-slate-900/50 border-t border-white/10\">\r\n                        <div className=\"flex gap-2\">\r\n                            <button\r\n                                className={`p-3 rounded-xl border border-slate-700 transition-colors ${isRecording\r\n                                    ? 'bg-red-500/20 border-red-500/50 text-red-500 animate-pulse'\r\n                                    : 'hover:bg-slate-800 text-slate-400 hover:text-white'\r\n                                    }`}\r\n                                onClick={() => setIsRecording(!isRecording)}\r\n                            >\r\n                                <Mic size={20} />\r\n                            </button>\r\n                            <div className=\"flex-1 relative\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={inputText}\r\n                                    onChange={(e) => setInputText(e.target.value)}\r\n                                    onKeyDown={handleKeyDown}\r\n                                    placeholder=\"Type your objection handler...\"\r\n                                    className=\"w-full bg-slate-800/50 border border-slate-700 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 placeholder:text-slate-600\"\r\n                                />\r\n                            </div>\r\n                            <button\r\n                                onClick={handleSend}\r\n                                disabled={!inputText.trim() || isTyping}\r\n                                className=\"p-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                <Send size={20} />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"text-center mt-2 text-xs text-slate-500\">\r\n                            Tip: Use &ldquo;Tactical Empathy&rdquo; to disarm the prospect.\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Right Sidebar: Real-time Analysis */}\r\n                <div className=\"w-80 glass-card p-6 flex flex-col hidden lg:flex\">\r\n                    <h3 className=\"font-bold text-white mb-6 flex items-center gap-2\">\r\n                        <AlertCircle size={18} className=\"text-indigo-400\" />\r\n                        Live Coaching\r\n                    </h3>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\r\n                            <div className=\"text-xs font-bold text-slate-400 uppercase mb-2\">Current Tone</div>\r\n                            <div className=\"flex items-center gap-2 text-emerald-400 font-semibold\">\r\n                                <CheckCircle size={16} /> Calm & Assertive\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <div className=\"flex justify-between text-xs text-slate-400 mb-2\">\r\n                                <span>Pacing</span>\r\n                                <span>120 wpm</span>\r\n                            </div>\r\n                            <div className=\"h-1 bg-slate-700 rounded-full overflow-hidden\">\r\n                                <div className=\"h-full bg-indigo-500 w-[60%]\"></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <div className=\"flex justify-between text-xs text-slate-400 mb-2\">\r\n                                <span>Sentiment</span>\r\n                                <span>Positive</span>\r\n                            </div>\r\n                            <div className=\"h-1 bg-slate-700 rounded-full overflow-hidden\">\r\n                                <div className=\"h-full bg-fuchsia-500 w-[75%]\"></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"mt-8\">\r\n                            <h4 className=\"font-bold text-white text-sm mb-3\">AI Suggestions</h4>\r\n                            <div className=\"space-y-2\">\r\n                                <button onClick={() => setInputText(\"It sounds like budget is a major concern specifically for Q4.\")} className=\"w-full text-left p-2 rounded hover:bg-white/5 text-xs text-slate-300 border border-transparent hover:border-indigo-500/30 transition-all\">\r\n                                    &ldquo;It sounds like budget is a major concern...&rdquo;\r\n                                </button>\r\n                                <button onClick={() => setInputText(\"What if we structured this to start billing in January?\")} className=\"w-full text-left p-2 rounded hover:bg-white/5 text-xs text-slate-300 border border-transparent hover:border-indigo-500/30 transition-all\">\r\n                                    &ldquo;What if we structured this to start billing in Jan?&rdquo;\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\EndlessQuizRunner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X, Trophy, Target, Award, BrainCircuit, ArrowRight, CheckCircle, XCircle } from 'lucide-react';\r\nimport { Question } from '@/types/learning';\r\nimport { generateQuizBatch } from '@/lib/ai/courseGenerator';\r\n\r\ninterface EndlessQuizRunnerProps {\r\n    onClose: () => void;\r\n}\r\n\r\ntype QuizState = 'setup' | 'playing' | 'checkpoint_summary';\r\n\r\nexport function EndlessQuizRunner({ onClose }: EndlessQuizRunnerProps) {\r\n    // Game Config & State\r\n    const [gameState, setGameState] = useState<QuizState>('setup');\r\n    const [checkpointSize, setCheckpointSize] = useState(10); // 10-50\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Session Stats\r\n    const [totalQuestionsAnswered, setTotalQuestionsAnswered] = useState(0);\r\n    const [totalCorrect, setTotalCorrect] = useState(0);\r\n    const [checkpointsPassed, setCheckpointsPassed] = useState(0);\r\n\r\n    // Current Batch State\r\n    const [questions, setQuestions] = useState<Question[]>([]);\r\n    const [currentIndex, setCurrentIndex] = useState(0);\r\n    const [selectedOption, setSelectedOption] = useState<number | null>(null);\r\n    const [batchCorrect, setBatchCorrect] = useState(0);\r\n    const [showExplanation, setShowExplanation] = useState(false);\r\n\r\n    // Start a new batch\r\n    const startCheckpoint = async () => {\r\n        setLoading(true);\r\n        const batch = await generateQuizBatch(checkpointSize);\r\n        setQuestions(batch);\r\n        setCurrentIndex(0);\r\n        setBatchCorrect(0);\r\n        setSelectedOption(null);\r\n        setShowExplanation(false);\r\n        setLoading(false);\r\n        setGameState('playing');\r\n    };\r\n\r\n    // Handle Answer Selection\r\n    const handleAnswer = (optionIndex: number) => {\r\n        if (selectedOption !== null) return; // Prevent double clicking\r\n\r\n        setSelectedOption(optionIndex);\r\n        setShowExplanation(true);\r\n\r\n        const isCorrect = optionIndex === questions[currentIndex].correctOptionIndex;\r\n        if (isCorrect) {\r\n            setBatchCorrect(prev => prev + 1);\r\n            setTotalCorrect(prev => prev + 1);\r\n        }\r\n        setTotalQuestionsAnswered(prev => prev + 1);\r\n    };\r\n\r\n    // Next Question or Checkpoint Summary\r\n    const handleNext = () => {\r\n        if (currentIndex < questions.length - 1) {\r\n            setCurrentIndex(prev => prev + 1);\r\n            setSelectedOption(null);\r\n            setShowExplanation(false);\r\n        } else {\r\n            // End of Batch\r\n            setCheckpointsPassed(prev => prev + 1);\r\n            setGameState('checkpoint_summary');\r\n        }\r\n    };\r\n\r\n    const overallAccuracy = totalQuestionsAnswered > 0\r\n        ? Math.round((totalCorrect / totalQuestionsAnswered) * 100)\r\n        : 0;\r\n\r\n    const batchAccuracy = questions.length > 0\r\n        ? Math.round((batchCorrect / questions.length) * 100)\r\n        : 0;\r\n\r\n    // --- SETUP SCREEN ---\r\n    if (gameState === 'setup') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm animate-in fade-in duration-200\">\r\n                <div className=\"glass-card w-full max-w-lg relative overflow-hidden p-8\">\r\n                    <button onClick={onClose} className=\"absolute top-4 right-4 text-slate-400 hover:text-white\">\r\n                        <X size={24} />\r\n                    </button>\r\n\r\n                    <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-fuchsia-500 to-indigo-500\"></div>\r\n\r\n                    <div className=\"text-center mb-10\">\r\n                        <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-fuchsia-600 to-indigo-600 flex items-center justify-center mx-auto mb-6 shadow-lg shadow-fuchsia-500/20\">\r\n                            <BrainCircuit size={32} className=\"text-white\" />\r\n                        </div>\r\n                        <h2 className=\"text-3xl font-bold text-white mb-2\">Endless Mastery</h2>\r\n                        <p className=\"text-slate-400\">\r\n                            Test your sales knowledge against an infinite stream of AI-generated scenarios.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-8\">\r\n                        <div>\r\n                            <div className=\"flex justify-between text-sm font-semibold mb-4\">\r\n                                <span className=\"text-slate-300\">Checkpoint Length</span>\r\n                                <span className=\"text-fuchsia-400\">{checkpointSize} Questions</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\"\r\n                                min=\"10\"\r\n                                max=\"50\"\r\n                                step=\"5\"\r\n                                value={checkpointSize}\r\n                                onChange={(e) => setCheckpointSize(parseInt(e.target.value))}\r\n                                className=\"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-fuchsia-500\"\r\n                            />\r\n                            <div className=\"flex justify-between text-xs text-slate-500 mt-2\">\r\n                                <span>Quick (10)</span>\r\n                                <span>Marathon (50)</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={startCheckpoint}\r\n                            disabled={loading}\r\n                            className=\"glass-button w-full py-4 text-lg font-bold flex items-center justify-center gap-2 group\"\r\n                        >\r\n                            {loading ? (\r\n                                <span className=\"animate-pulse\">Generating...</span>\r\n                            ) : (\r\n                                <>\r\n                                    Start Session <ArrowRight size={20} className=\"group-hover:translate-x-1 transition-transform\" />\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- PLAYING SCREEN ---\r\n    if (gameState === 'playing') {\r\n        const currentQ = questions[currentIndex];\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900 bg-opacity-95 backdrop-blur-md\">\r\n                <div className=\"w-full max-w-4xl max-h-[90vh] flex flex-col\">\r\n                    {/* Header HUD */}\r\n                    <div className=\"flex items-center justify-between mb-6 px-4\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className=\"glass-panel px-4 py-2 rounded-full flex items-center gap-2 text-sm font-semibold text-slate-300\">\r\n                                <Target size={16} className=\"text-fuchsia-400\" />\r\n                                <span>Progress: {currentIndex + 1} / {questions.length}</span>\r\n                            </div>\r\n                            <div className=\"glass-panel px-4 py-2 rounded-full flex items-center gap-2 text-sm font-semibold text-slate-300\">\r\n                                <Trophy size={16} className=\"text-amber-400\" />\r\n                                <span>Score: {batchCorrect}</span>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={onClose} className=\"p-2 rounded-full bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white transition-colors\">\r\n                            <X size={24} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Question Card */}\r\n                    <div className=\"glass-card flex-1 overflow-y-auto custom-scrollbar relative\">\r\n                        {/* Progress Bar */}\r\n                        <div className=\"absolute top-0 left-0 h-1 bg-gradient-to-r from-fuchsia-500 to-indigo-500 transition-all duration-300\" style={{ width: `${((currentIndex) / questions.length) * 100}%` }}></div>\r\n\r\n                        <div className=\"max-w-3xl mx-auto py-8\">\r\n                            <h3 className=\"text-2xl md:text-3xl font-bold text-white mb-8 leading-tight\">\r\n                                {currentQ.question}\r\n                            </h3>\r\n\r\n                            <div className=\"space-y-4\">\r\n                                {currentQ.options.map((option, idx) => {\r\n                                    const isSelected = selectedOption === idx;\r\n                                    const isCorrect = idx === currentQ.correctOptionIndex;\r\n\r\n                                    let buttonStyle = \"border-slate-700 hover:border-slate-500 hover:bg-slate-800/50\";\r\n                                    if (showExplanation) {\r\n                                        if (isCorrect) buttonStyle = \"border-green-500 bg-green-500/10 text-green-200\";\r\n                                        else if (isSelected) buttonStyle = \"border-red-500 bg-red-500/10 text-red-200\";\r\n                                        else buttonStyle = \"border-slate-800 opacity-50\";\r\n                                    } else if (isSelected) {\r\n                                        buttonStyle = \"border-fuchsia-500 bg-fuchsia-500/10 text-white\";\r\n                                    }\r\n\r\n                                    return (\r\n                                        <button\r\n                                            key={idx}\r\n                                            onClick={() => handleAnswer(idx)}\r\n                                            disabled={showExplanation}\r\n                                            className={`w-full text-left p-6 rounded-xl border-2 transition-all duration-200 text-lg ${buttonStyle}`}\r\n                                        >\r\n                                            <div className=\"flex items-start gap-4\">\r\n                                                <div className={`mt-1 min-w-[24px] h-6 rounded-full border-2 flex items-center justify-center text-xs font-bold ${showExplanation && isCorrect ? 'border-green-500 bg-green-500 text-black' :\r\n                                                    showExplanation && isSelected ? 'border-red-500 bg-red-500 text-white' :\r\n                                                        'border-slate-600 text-slate-400'\r\n                                                    }`}>\r\n                                                    {[\"A\", \"B\", \"C\", \"D\"][idx]}\r\n                                                </div>\r\n                                                <span>{option}</span>\r\n                                            </div>\r\n                                        </button>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n\r\n                            {/* Explanation & Next */}\r\n                            {showExplanation && (\r\n                                <div className=\"mt-8 animate-in slide-in-from-bottom-4 fade-in duration-300\">\r\n                                    <div className={`p-6 rounded-xl border mb-6 ${selectedOption === currentQ.correctOptionIndex\r\n                                        ? 'bg-green-950/30 border-green-500/30'\r\n                                        : 'bg-red-950/30 border-red-500/30'\r\n                                        }`}>\r\n                                        <div className=\"flex items-center gap-2 font-bold mb-2\">\r\n                                            {selectedOption === currentQ.correctOptionIndex ? (\r\n                                                <><CheckCircle className=\"text-green-400\" size={20} /> <span className=\"text-green-400\">Correct!</span></>\r\n                                            ) : (\r\n                                                <><XCircle className=\"text-red-400\" size={20} /> <span className=\"text-red-400\">Incorrect</span></>\r\n                                            )}\r\n                                        </div>\r\n                                        <p className=\"text-slate-300 leading-relaxed\">\r\n                                            {currentQ.explanation}\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={handleNext}\r\n                                        className=\"glass-button w-full py-4 text-lg font-bold flex items-center justify-center gap-2\"\r\n                                    >\r\n                                        {currentIndex < questions.length - 1 ? 'Next Question' : 'Finish Checkpoint'} <ArrowRight size={20} />\r\n                                    </button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- CHECKPOINT SUMMARY ---\r\n    if (gameState === 'checkpoint_summary') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-md\">\r\n                <div className=\"glass-card w-full max-w-lg text-center p-10 animate-in zoom-in-95 duration-300\">\r\n                    <div className=\"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-gradient-to-br from-amber-400 to-orange-500 shadow-xl shadow-orange-500/20\">\r\n                        <Award size={40} className=\"text-white\" />\r\n                    </div>\r\n\r\n                    <h2 className=\"text-3xl font-bold text-white mb-2\">Checkpoint Cleared!</h2>\r\n                    <p className=\"text-slate-400 mb-8\">Great work. Here&apos;s how you performed.</p>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4 mb-8\">\r\n                        <div className=\"glass-panel p-4 rounded-xl\">\r\n                            <div className=\"text-slate-400 text-sm mb-1\">Accuracy</div>\r\n                            <div className={`text-2xl font-bold ${batchAccuracy >= 80 ? 'text-green-400' : 'text-fuchsia-400'}`}>\r\n                                {batchAccuracy}%\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"glass-panel p-4 rounded-xl\">\r\n                            <div className=\"text-slate-400 text-sm mb-1\">Score</div>\r\n                            <div className=\"text-2xl font-bold text-white\">\r\n                                {batchCorrect} / {questions.length}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Overall Session Stats */}\r\n                    <div className=\"border-t border-white/10 pt-6 mb-8\">\r\n                        <div className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-4\">Session Total</div>\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"text-slate-400\">Total Questions</span>\r\n                            <span className=\"text-white font-mono\">{totalQuestionsAnswered}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-sm mt-2\">\r\n                            <span className=\"text-slate-400\">Avg Accuracy</span>\r\n                            <span className=\"text-white font-mono\">{overallAccuracy}%</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-sm mt-2\">\r\n                            <span className=\"text-slate-400\">Checkpoints</span>\r\n                            <span className=\"text-white font-mono\">{checkpointsPassed}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-4\">\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"flex-1 py-3 px-6 rounded-xl border border-slate-600 text-slate-300 hover:bg-slate-800 transition-colors font-semibold\"\r\n                        >\r\n                            End Session\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setGameState('setup')}\r\n                            className=\"flex-1 glass-button py-3 px-6 font-semibold\"\r\n                        >\r\n                            Continue\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\LMSPlayer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Module' is defined but never used.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lesson' is defined but never used.","line":4,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used.","line":5,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'score' is defined but never used.","line":167,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { Course, Module, Lesson } from '@/types/learning';\r\nimport { X, ChevronLeft, Layout, CheckCircle, Lock } from 'lucide-react';\r\nimport { SlideDeck } from './SlideDeck';\r\nimport { QuizComponent } from './QuizComponent';\r\nimport { SlideContent, QuizContent } from '@/types/learning';\r\nimport confetti from 'canvas-confetti';\r\n\r\ninterface LMSPlayerProps {\r\n    course: Course;\r\n    onClose: () => void;\r\n}\r\n\r\nexport function LMSPlayer({ course, onClose }: LMSPlayerProps) {\r\n    // Flatten lessons for simpler navigation logic for this MVP\r\n    // In a real app, we'd handle module boundaries more strictly\r\n    const allLessons = course.modules.flatMap(m => m.lessons);\r\n\r\n    const [currentLessonIndex, setCurrentLessonIndex] = useState(0);\r\n    const [completedLessons, setCompletedLessons] = useState<Set<string>>(new Set());\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(true);\r\n\r\n    const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);\r\n\r\n    const currentLesson = allLessons[currentLessonIndex];\r\n    const currentModule = course.modules.find(m => m.lessons.some(l => l.id === currentLesson.id));\r\n\r\n    const handleLessonComplete = () => {\r\n        const newCompleted = new Set(completedLessons);\r\n        newCompleted.add(currentLesson.id);\r\n        setCompletedLessons(newCompleted);\r\n\r\n        // Auto-advance if not last\r\n        if (currentLessonIndex < allLessons.length - 1) {\r\n            setTimeout(() => {\r\n                setCurrentLessonIndex(prev => prev + 1);\r\n            }, 1000);\r\n        } else {\r\n            // Course Complete!\r\n            confetti({\r\n                particleCount: 200,\r\n                spread: 100,\r\n                origin: { y: 0.6 }\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] bg-[#0b1121] text-white flex flex-col md:flex-row animate-fade-in\">\r\n\r\n            {/* Sidebar (Lesson Navigation) */}\r\n            <aside\r\n                className={`\r\n                    bg-slate-900 border-r border-white/5 flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out relative\r\n                    ${isSidebarOpen ? 'w-full md:w-80 h-[30vh] md:h-full opacity-100' : 'w-0 h-0 md:h-full opacity-0 overflow-hidden border-none'}\r\n                `}\r\n            >\r\n                <div className=\"p-4 border-b border-white/5 flex items-center justify-between gap-3\">\r\n                    <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/5 rounded-lg text-slate-400 hover:text-white transition-colors flex-shrink-0\">\r\n                            <X size={20} />\r\n                        </button>\r\n                        <h1 className=\"font-bold text-sm truncate whitespace-nowrap\" title={course.title}>{course.title}</h1>\r\n                    </div>\r\n                    {/* Unique Close Sidebar Button */}\r\n                    <button onClick={toggleSidebar} className=\"p-2 text-slate-400 hover:text-white md:hidden\">\r\n                        <Layout size={18} />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar whitespace-nowrap\">\r\n                    {course.modules.map((module) => (\r\n                        <div key={module.id}>\r\n                            <h3 className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 px-2\">\r\n                                {module.title}\r\n                            </h3>\r\n                            <div className=\"space-y-1\">\r\n                                {module.lessons.map((lesson, idx) => {\r\n                                    // Calculate global index for active state\r\n                                    const globalIdx = allLessons.findIndex(l => l.id === lesson.id);\r\n                                    const isActive = globalIdx === currentLessonIndex;\r\n                                    const isCompleted = completedLessons.has(lesson.id);\r\n                                    const isLocked = globalIdx > 0 && !completedLessons.has(allLessons[globalIdx - 1].id) && !isActive && !isCompleted;\r\n\r\n                                    return (\r\n                                        <button\r\n                                            key={lesson.id}\r\n                                            onClick={() => !isLocked && setCurrentLessonIndex(globalIdx)}\r\n                                            disabled={isLocked}\r\n                                            className={`w-full flex items-center gap-3 px-3 py-3 rounded-lg text-sm transition-all text-left\r\n                                                ${isActive ? 'bg-indigo-600/10 text-indigo-300 border border-indigo-500/20' : 'text-slate-400 hover:bg-white/5'}\r\n                                                ${isLocked ? 'opacity-50 cursor-not-allowed' : ''}\r\n                                            `}\r\n                                        >\r\n                                            <div className={`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 text-[10px] font-bold border\r\n                                                ${isCompleted ? 'bg-emerald-500 border-emerald-500 text-white' :\r\n                                                    isActive ? 'border-indigo-500 text-indigo-400' : 'border-slate-700 text-slate-600'}\r\n                                            `}>\r\n                                                {isCompleted ? <CheckCircle size={12} className=\"fill-emerald-500 text-white\" /> : (idx + 1)}\r\n                                            </div>\r\n                                            <span className=\"truncate flex-1\">{lesson.title}</span>\r\n                                            {isLocked && <Lock size={12} className=\"text-slate-600\" />}\r\n                                        </button>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Progress Footer */}\r\n                <div className=\"p-4 border-t border-white/5 bg-slate-950/30\">\r\n                    <div className=\"flex justify-between text-xs text-slate-400 mb-2\">\r\n                        <span>Course Progress</span>\r\n                        <span>{Math.round((completedLessons.size / allLessons.length) * 100)}%</span>\r\n                    </div>\r\n                    <div className=\"h-1.5 bg-slate-800 rounded-full overflow-hidden\">\r\n                        <div className=\"h-full bg-emerald-500 transition-all duration-500\" style={{ width: `${(completedLessons.size / allLessons.length) * 100}%` }} />\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* Main Content Player */}\r\n            <main className=\"flex-1 flex flex-col relative overflow-hidden bg-slate-950\">\r\n                {/* Top Bar for Context */}\r\n                <div className=\"h-16 border-b border-white/5 flex items-center justify-between px-4 md:px-8 bg-slate-900/50 backdrop-blur-md\">\r\n                    <div className=\"flex items-center gap-4 text-slate-400 text-sm overflow-hidden\">\r\n                        <button\r\n                            onClick={toggleSidebar}\r\n                            className=\"p-2 -ml-2 hover:bg-white/5 rounded-lg text-slate-400 hover:text-white transition-colors\"\r\n                            title={isSidebarOpen ? \"Collapse Sidebar\" : \"Expand Sidebar\"}\r\n                        >\r\n                            <Layout size={20} className={isSidebarOpen ? \"text-indigo-400\" : \"\"} />\r\n                        </button>\r\n\r\n                        <div className=\"flex items-center gap-2 truncate\">\r\n                            <span className=\"hidden md:inline\">{currentModule?.title}</span>\r\n                            <span className=\"text-slate-600 hidden md:inline\">/</span>\r\n                            <span className=\"text-white font-medium truncate\">{currentLesson.title}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Close Course Button (Visible when sidebar is closed) */}\r\n                    {!isSidebarOpen && (\r\n                        <button onClick={onClose} className=\"p-2 hover:bg-white/5 rounded-lg text-slate-400 hover:text-white transition-colors\">\r\n                            <X size={20} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content Render Area */}\r\n                <div className=\"flex-1 overflow-y-auto no-scrollbar relative\">\r\n                    {currentLesson.type === 'slide' && (\r\n                        <SlideDeck\r\n                            key={currentLesson.id} // Force remount on change\r\n                            slides={(currentLesson.content as SlideContent).slides}\r\n                            onComplete={handleLessonComplete}\r\n                        />\r\n                    )}\r\n\r\n                    {currentLesson.type === 'quiz' && (\r\n                        <QuizComponent\r\n                            key={currentLesson.id}\r\n                            content={currentLesson.content as QuizContent}\r\n                            onComplete={(score) => {\r\n                                handleLessonComplete();\r\n                            }}\r\n                        />\r\n                    )}\r\n\r\n                    {currentLesson.type === 'video' && (\r\n                        <div className=\"flex items-center justify-center h-full text-slate-500\">\r\n                            Video Player Implementation Pending...\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\PitchRecorder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":4,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":4,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[988,991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[988,991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1181,1184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1181,1184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1218,1221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1218,1221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1498,1501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1498,1501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { X, Mic, Square, Play, BarChart3, TrendingUp, AlertTriangle, CheckCircle2, Clock } from 'lucide-react';\r\nimport { GeminiService } from '@/lib/ai/gemini';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { AIPitchAnalysis } from '@/types/ai';\r\n\r\ninterface PitchRecorderProps {\r\n    onClose: () => void;\r\n}\r\n\r\ntype RecordingState = 'idle' | 'recording' | 'analyzing' | 'complete';\r\n\r\nexport function PitchRecorder({ onClose }: PitchRecorderProps) {\r\n    const [state, setState] = useState<RecordingState>('idle');\r\n    const [duration, setDuration] = useState(0);\r\n    const [transcript, setTranscript] = useState('');\r\n    const [analysis, setAnalysis] = useState<AIPitchAnalysis | null>(null);\r\n    const { user } = useAuth();\r\n\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n    const recognitionRef = useRef<any>(null); // SpeechRecognition type is erratic in standard TS configs\r\n\r\n    useEffect(() => {\r\n        if (typeof window !== 'undefined') {\r\n            const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n            if (SpeechRecognition) {\r\n                const recognition = new SpeechRecognition();\r\n                recognition.continuous = true;\r\n                recognition.interimResults = true;\r\n\r\n                recognition.onresult = (event: any) => {\r\n                    let currentTranscript = '';\r\n                    for (let i = event.resultIndex; i < event.results.length; i++) {\r\n                        currentTranscript += event.results[i][0].transcript;\r\n                    }\r\n                    setTranscript(prev => prev + ' ' + currentTranscript);\r\n                };\r\n\r\n                recognitionRef.current = recognition;\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // Simulated Waveform Animation (Visuals only for now)\r\n    useEffect(() => {\r\n        if (state !== 'recording' || !canvasRef.current) return;\r\n\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        let animationId: number;\r\n        const bars = 40;\r\n        const barWidth = canvas.width / bars;\r\n\r\n        const draw = () => {\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n            ctx.fillStyle = '#06b6d4'; // Cyan-500\r\n\r\n            for (let i = 0; i < bars; i++) {\r\n                // Generate random bar height\r\n                const height = Math.random() * (canvas.height * 0.8) + (canvas.height * 0.1);\r\n                const x = i * barWidth;\r\n                const y = (canvas.height - height) / 2;\r\n\r\n                ctx.beginPath();\r\n                ctx.roundRect(x + 2, y, barWidth - 4, height, 4);\r\n                ctx.fill();\r\n            }\r\n            animationId = requestAnimationFrame(draw);\r\n        };\r\n\r\n        draw();\r\n\r\n        return () => cancelAnimationFrame(animationId);\r\n    }, [state]);\r\n\r\n    // Timer Logic\r\n    useEffect(() => {\r\n        if (state === 'recording') {\r\n            timerRef.current = setInterval(() => {\r\n                setDuration(prev => prev + 1);\r\n            }, 1000);\r\n        } else if (state === 'idle') {\r\n            const timeout = setTimeout(() => {\r\n                setDuration(0);\r\n                setTranscript('');\r\n            }, 0);\r\n            return () => clearTimeout(timeout);\r\n        } else {\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n        }\r\n        return () => {\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n        }\r\n    }, [state]);\r\n\r\n    const startRecording = () => {\r\n        setTranscript('');\r\n        setState('recording');\r\n        if (recognitionRef.current) {\r\n            try {\r\n                recognitionRef.current.start();\r\n            } catch (e) {\r\n                console.error(\"Speech start error\", e);\r\n            }\r\n        } else {\r\n            alert(\"Speech Recognition not supported in this browser. Please use Chrome/Edge.\");\r\n        }\r\n    };\r\n\r\n    const stopRecording = async () => {\r\n        setState('analyzing');\r\n        if (recognitionRef.current) {\r\n            recognitionRef.current.stop();\r\n        }\r\n\r\n        // Send to AI\r\n        if (!transcript.trim()) {\r\n            // Fallback for demo if mic failed or silence\r\n            console.warn(\"No transcript captured. Using fallback.\");\r\n        }\r\n\r\n        // Wait a tiny bit for final transcript\r\n        await new Promise(r => setTimeout(r, 500));\r\n\r\n        const textToAnalyze = transcript.trim() || \"Hi, I'm calling from OmniStream to see if you have time to discuss your social media automation needs. Our tool is 20 percent cheaper than Hootsuite and has better analytics.\";\r\n\r\n        const token = await user?.getIdToken();\r\n        const result = await GeminiService.analyzePitch(textToAnalyze, token);\r\n        setAnalysis(result);\r\n        setState('complete');\r\n    };\r\n\r\n    const formatTime = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    // --- IDLE STATE ---\r\n    if (state === 'idle') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 z-[100] overflow-y-auto bg-slate-900/90 backdrop-blur-md\">\r\n                <div className=\"flex min-h-full items-center justify-center p-4\">\r\n                    <div className=\"glass-card w-full max-w-lg text-center p-12 relative overflow-hidden my-auto\">\r\n                        <button onClick={onClose} className=\"absolute top-4 right-4 text-slate-400 hover:text-white\">\r\n                            <X size={24} />\r\n                        </button>\r\n\r\n                        <div className=\"mx-auto w-24 h-24 rounded-full bg-cyan-900/30 border-2 border-cyan-500/50 flex items-center justify-center mb-8 relative\">\r\n                            <div className=\"absolute inset-0 bg-cyan-500/20 rounded-full animate-ping\"></div>\r\n                            <Mic size={48} className=\"text-cyan-400 relative z-10\" />\r\n                        </div>\r\n\r\n                        <h2 className=\"text-3xl font-bold text-white mb-4\">Pitch Perfect</h2>\r\n                        <p className=\"text-slate-400 mb-10 leading-relaxed\">\r\n                            Record your 30-second elevator pitch. Starts <b>listening</b> immediately.\r\n                        </p>\r\n\r\n                        <button\r\n                            onClick={startRecording}\r\n                            className=\"glass-button w-full py-4 text-lg font-bold bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 border-none\"\r\n                        >\r\n                            Start Recording\r\n                        </button>\r\n                        <div className=\"mt-4 text-xs text-slate-500 flex items-center justify-center gap-2\">\r\n                            <AlertTriangle size={12} /> Microphone access required\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- RECORDING STATE ---\r\n    if (state === 'recording') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 z-[100] overflow-y-auto bg-slate-900/90 backdrop-blur-md\">\r\n                <div className=\"flex min-h-full items-center justify-center p-4\">\r\n                    <div className=\"glass-card w-full max-w-lg text-center p-12 relative my-auto\">\r\n                        <div className=\"mb-4 text-cyan-400 font-mono text-2xl tracking-widest\">\r\n                            {formatTime(duration)} / 0:30\r\n                        </div>\r\n\r\n                        <div className=\"h-32 w-full bg-slate-900/50 rounded-xl mb-10 overflow-hidden relative border border-white/5\">\r\n                            <canvas ref={canvasRef} width={400} height={128} className=\"w-full h-full\" />\r\n                        </div>\r\n\r\n                        <div className=\"text-white text-lg font-medium mb-8 animate-pulse\">\r\n                            Listening...\r\n                        </div>\r\n                        {/* Live Transcript Preview */}\r\n                        <div className=\"text-slate-500 text-xs mb-4 h-10 overflow-hidden\">\r\n                            {transcript.slice(-50)}...\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={stopRecording}\r\n                            className=\"w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 flex items-center justify-center mx-auto shadow-lg shadow-red-500/30 transition-transform hover:scale-105\"\r\n                        >\r\n                            <Square size={32} className=\"text-white fill-white\" />\r\n                        </button>\r\n                        <div className=\"mt-4 text-xs text-slate-500 uppercase tracking-wider font-bold\">Stop Recording</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- ANALYZING STATE ---\r\n    if (state === 'analyzing') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 z-[100] overflow-y-auto bg-slate-900/90 backdrop-blur-md\">\r\n                <div className=\"flex min-h-full items-center justify-center p-4\">\r\n                    <div className=\"glass-card w-full max-w-md text-center p-12 my-auto\">\r\n                        <div className=\"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-6\"></div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-2\">Analyzing Pitch...</h3>\r\n                        <p className=\"text-slate-400 text-sm\">Gemini 2.5 is reviewing your tone, pace, and content.</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- COMPLETE STATE ---\r\n    if (state === 'complete' && analysis) {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 z-[100] overflow-y-auto bg-slate-900/90 backdrop-blur-md\">\r\n                <div className=\"flex min-h-full items-center justify-center p-4\">\r\n                    <div className=\"glass-card w-full max-w-2xl relative p-0 overflow-hidden animate-in zoom-in-95 duration-300 my-auto\">\r\n                        <button onClick={onClose} className=\"absolute top-4 right-4 z-10 text-slate-400 hover:text-white\">\r\n                            <X size={24} />\r\n                        </button>\r\n\r\n                        <div className=\"bg-gradient-to-r from-cyan-900 to-blue-900 p-8 text-center relative overflow-hidden\">\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"text-cyan-300 text-sm font-bold uppercase tracking-widest mb-2\">Analysis Complete</div>\r\n                                <h2 className=\"text-4xl font-bold text-white mb-2\">{analysis.score}/100</h2>\r\n                                <p className=\"text-cyan-200\">{analysis.oneLineFeedback}</p>\r\n                            </div>\r\n                            {/* Background Decor */}\r\n                            <div className=\"absolute top-0 left-0 w-full h-full bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20\"></div>\r\n                        </div>\r\n\r\n                        <div className=\"p-8 grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                            {/* Pace */}\r\n                            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 text-center\">\r\n                                <div className=\"mb-3 w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mx-auto text-blue-400\">\r\n                                    <Clock size={20} />\r\n                                </div>\r\n                                <div className=\"text-2xl font-bold text-white mb-1\">{analysis.pace || '~'}</div>\r\n                                <div className=\"text-xs text-slate-400 uppercase\">Words / Min</div>\r\n                                <div className=\"mt-2 text-xs text-green-400\">Estimated</div>\r\n                            </div>\r\n\r\n                            {/* Filler Words */}\r\n                            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 text-center\">\r\n                                <div className=\"mb-3 w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center mx-auto text-amber-400\">\r\n                                    <AlertTriangle size={20} />\r\n                                </div>\r\n                                <div className=\"text-2xl font-bold text-white mb-1\">{analysis.fillerWords?.length || 0}</div>\r\n                                <div className=\"text-xs text-slate-400 uppercase\">Filler Words</div>\r\n                                <div className=\"mt-2 text-xs text-amber-400\">{analysis.fillerWords?.join(', ') || 'None'}</div>\r\n                            </div>\r\n\r\n                            {/* Confidence */}\r\n                            <div className=\"p-4 rounded-xl bg-white/5 border border-white/10 text-center\">\r\n                                <div className=\"mb-3 w-10 h-10 rounded-full bg-fuchsia-500/20 flex items-center justify-center mx-auto text-fuchsia-400\">\r\n                                    <TrendingUp size={20} />\r\n                                </div>\r\n                                <div className=\"text-2xl font-bold text-white mb-1\">{analysis.confidence}</div>\r\n                                <div className=\"text-xs text-slate-400 uppercase\">Confidence</div>\r\n                                <div className=\"mt-2 text-xs text-green-400\">AI Analysis</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-8 pt-0\">\r\n                            <div className=\"p-4 rounded-xl bg-slate-900/50 border border-white/5 mb-6\">\r\n                                <h4 className=\"font-bold text-white mb-2 flex items-center gap-2\">\r\n                                    <CheckCircle2 size={16} className=\"text-green-500\" /> Key Strengths\r\n                                </h4>\r\n                                <ul className=\"text-sm text-slate-300 space-y-2 list-disc pl-5\">\r\n                                    {analysis.strengths?.map((s: string, i: number) => (\r\n                                        <li key={i}>{s}</li>\r\n                                    ))}\r\n                                </ul>\r\n                            </div>\r\n\r\n                            {analysis.improvements && (\r\n                                <div className=\"p-4 rounded-xl bg-slate-900/50 border border-white/5 mb-6\">\r\n                                    <h4 className=\"font-bold text-white mb-2 flex items-center gap-2\">\r\n                                        <AlertTriangle size={16} className=\"text-amber-500\" /> Improvements\r\n                                    </h4>\r\n                                    <ul className=\"text-sm text-slate-300 space-y-2 list-disc pl-5\">\r\n                                        {analysis.improvements.map((s: string, i: number) => (\r\n                                            <li key={i}>{s}</li>\r\n                                        ))}\r\n                                    </ul>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"flex gap-4\">\r\n                                <button onClick={() => setState('idle')} className=\"flex-1 glass-button py-3 text-sm font-bold\">Try Again</button>\r\n                                <button onClick={onClose} className=\"flex-1 py-3 border border-slate-700 rounded-xl text-slate-400 hover:text-white hover:bg-slate-800 transition-colors text-sm font-bold\">Close</button>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\QuizComponent.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'finalScore' is assigned a value but never used.","line":46,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState } from 'react';\r\nimport { QuizContent } from '@/types/learning';\r\nimport { CheckCircle, XCircle, AlertCircle, RotateCcw, Trophy } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport confetti from 'canvas-confetti';\r\n\r\ninterface QuizComponentProps {\r\n    content: QuizContent;\r\n    onComplete: (score: number) => void;\r\n}\r\n\r\nexport function QuizComponent({ content, onComplete }: QuizComponentProps) {\r\n    const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\r\n    const [selectedOption, setSelectedOption] = useState<number | null>(null);\r\n    const [isAnswered, setIsAnswered] = useState(false);\r\n    const [score, setScore] = useState(0);\r\n    const [showResults, setShowResults] = useState(false);\r\n\r\n    const question = content.questions[currentQuestionIndex];\r\n    const isCorrect = selectedOption === question.correctOptionIndex;\r\n\r\n    const handleSelectOption = (index: number) => {\r\n        if (isAnswered) return;\r\n        setSelectedOption(index);\r\n        setIsAnswered(true);\r\n\r\n        if (index === question.correctOptionIndex) {\r\n            setScore(s => s + 1);\r\n        }\r\n    };\r\n\r\n    const handleNext = () => {\r\n        if (currentQuestionIndex < content.questions.length - 1) {\r\n            setCurrentQuestionIndex(prev => prev + 1);\r\n            setSelectedOption(null);\r\n            setIsAnswered(false);\r\n        } else {\r\n            finishQuiz();\r\n        }\r\n    };\r\n\r\n    const finishQuiz = () => {\r\n        setShowResults(true);\r\n        const finalScore = Math.round(((score + (isCorrect ? 0 : 0)) / content.questions.length) * 100); // Wait, score is already updated? No, state update allows reading reliable next step.\r\n        // Actually, let's recalculate based on current state knowing we passed previous step\r\n        const calculateScore = Math.round((score / content.questions.length) * 100);\r\n\r\n        if (calculateScore >= content.passingScore) {\r\n            confetti({\r\n                particleCount: 150,\r\n                spread: 70,\r\n                origin: { y: 0.6 }\r\n            });\r\n        }\r\n        onComplete(calculateScore);\r\n    };\r\n\r\n    if (showResults) {\r\n        const percentage = Math.round((score / content.questions.length) * 100);\r\n        const passed = percentage >= content.passingScore;\r\n\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center h-full text-center p-8 animate-fade-in-up\">\r\n                <div className={`w-24 h-24 rounded-full flex items-center justify-center mb-6 shadow-2xl ${passed ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/50' : 'bg-red-500/20 text-red-400 border border-red-500/50'}`}>\r\n                    {passed ? <Trophy size={48} /> : <AlertCircle size={48} />}\r\n                </div>\r\n\r\n                <h2 className=\"text-3xl font-bold text-white mb-2\">{passed ? 'Quiz Passed!' : 'Needs Improvement'}</h2>\r\n                <p className=\"text-slate-400 mb-8 max-w-md\">\r\n                    {passed\r\n                        ? 'Great job demonstrating your knowledge. You have officially completed this module.'\r\n                        : 'You did not meet the passing score for this quiz. Review the material and try again to earn your XP.'}\r\n                </p>\r\n\r\n                <div className=\"text-6xl font-black text-white mb-2 tracking-tighter\">{percentage}%</div>\r\n                <div className=\"text-sm font-bold uppercase tracking-widest text-slate-500 mb-10\">Final Score</div>\r\n\r\n                <div className=\"flex gap-4\">\r\n                    {!passed && (\r\n                        <button\r\n                            onClick={() => {\r\n                                setCurrentQuestionIndex(0);\r\n                                setScore(0);\r\n                                setSelectedOption(null);\r\n                                setIsAnswered(false);\r\n                                setShowResults(false);\r\n                            }}\r\n                            className=\"glass-button flex items-center gap-2 px-6 py-3\"\r\n                        >\r\n                            <RotateCcw size={18} /> Retry Quiz\r\n                        </button>\r\n                    )}\r\n                    <button\r\n                        onClick={() => onComplete(percentage)} // Just close/finish\r\n                        className=\"bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-indigo-500/25 transition-all\"\r\n                    >\r\n                        Success\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto w-full py-10 px-4\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div className=\"text-sm font-bold text-slate-500 uppercase tracking-wider\">\r\n                    Question {currentQuestionIndex + 1} / {content.questions.length}\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-indigo-400 font-bold\">{score}</span>\r\n                    <span className=\"text-slate-600\">points</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Question Card */}\r\n            <div className=\"glass-card bg-slate-800/40 p-0 overflow-hidden border-none shadow-xl\">\r\n                <div className=\"p-8 border-b border-white/5 bg-slate-900/50\">\r\n                    <h3 className=\"text-xl md:text-2xl font-bold text-white leading-snug\">\r\n                        {question.question}\r\n                    </h3>\r\n                </div>\r\n\r\n                <div className=\"p-4 space-y-3\">\r\n                    {question.options.map((option, index) => {\r\n                        let statusClass = \"border-white/5 hover:bg-white/5 hover:border-white/20 text-slate-300\"; // Default\r\n\r\n                        if (isAnswered) {\r\n                            if (index === question.correctOptionIndex) {\r\n                                statusClass = \"bg-emerald-500/20 border-emerald-500/50 text-emerald-100 ring-1 ring-emerald-500/50\";\r\n                            } else if (index === selectedOption) {\r\n                                statusClass = \"bg-red-500/20 border-red-500/50 text-red-100\";\r\n                            } else {\r\n                                statusClass = \"opacity-50 border-transparent\";\r\n                            }\r\n                        }\r\n\r\n                        return (\r\n                            <button\r\n                                key={index}\r\n                                onClick={() => handleSelectOption(index)}\r\n                                disabled={isAnswered}\r\n                                className={`w-full text-left p-4 rounded-xl border transition-all duration-200 flex items-center justify-between group ${statusClass} ${selectedOption === index ? 'ring-2 ring-indigo-500/50' : ''}`}\r\n                            >\r\n                                <span className=\"font-medium text-lg\">{option}</span>\r\n                                {isAnswered && index === question.correctOptionIndex && (\r\n                                    <CheckCircle className=\"text-emerald-400\" size={20} />\r\n                                )}\r\n                                {isAnswered && index === selectedOption && index !== question.correctOptionIndex && (\r\n                                    <XCircle className=\"text-red-400\" size={20} />\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Feedback & Continue */}\r\n                <AnimatePresence>\r\n                    {isAnswered && (\r\n                        <motion.div\r\n                            initial={{ height: 0, opacity: 0 }}\r\n                            animate={{ height: 'auto', opacity: 1 }}\r\n                            className={`p-6 border-t ${isCorrect ? 'bg-emerald-900/20 border-emerald-500/20' : 'bg-red-900/20 border-red-500/20'}`}\r\n                        >\r\n                            <div className=\"flex items-start gap-4 mb-6\">\r\n                                <div className={`mt-1 p-2 rounded-full ${isCorrect ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}>\r\n                                    {isCorrect ? <CheckCircle size={24} /> : <AlertCircle size={24} />}\r\n                                </div>\r\n                                <div>\r\n                                    <h4 className={`font-bold mb-1 ${isCorrect ? 'text-emerald-300' : 'text-red-300'}`}>\r\n                                        {isCorrect ? 'Correct!' : 'Incorrect'}\r\n                                    </h4>\r\n                                    <p className=\"text-slate-300 leading-relaxed text-sm\">\r\n                                        {question.explanation}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end\">\r\n                                <button\r\n                                    onClick={handleNext}\r\n                                    className=\"px-8 py-3 bg-white text-slate-900 font-bold rounded-xl hover:bg-slate-200 transition-colors shadow-lg shadow-white/10\"\r\n                                >\r\n                                    {currentQuestionIndex === content.questions.length - 1 ? 'Finish Quiz' : 'Next Question'}\r\n                                </button>\r\n                            </div>\r\n                        </motion.div>\r\n                    )}\r\n                </AnimatePresence>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\SlideDeck.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\TimeMachine.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExternalLink' is defined but never used.","line":7,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Send' is defined but never used.","line":7,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":7,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":83},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":7,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":89},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[483,486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[483,486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { GeminiService } from '@/lib/ai/gemini';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { AIFutureArtifact, AIBoardroomTranscriptItem } from '@/types/ai';\r\nimport { X, ExternalLink, RefreshCw, Send, AlertTriangle, TrendingDown, TrendingUp, Lock } from 'lucide-react';\r\nimport Image from 'next/image';\r\n\r\ninterface TimeMachineProps {\r\n    transcript: AIBoardroomTranscriptItem[] | any[];\r\n    outcome: 'win' | 'loss';\r\n    onClose: () => void;\r\n}\r\n\r\nexport function TimeMachine({ transcript, outcome, onClose }: TimeMachineProps) {\r\n    const { user } = useAuth();\r\n    const [artifact, setArtifact] = useState<AIFutureArtifact | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [year, setYear] = useState(2025);\r\n\r\n    useEffect(() => {\r\n        // Animation to \"Travel Forward\"\r\n        const interval = setInterval(() => {\r\n            setYear(prev => {\r\n                if (prev >= 2026) {\r\n                    clearInterval(interval);\r\n                    return 2026;\r\n                }\r\n                return prev + 1;\r\n            });\r\n        }, 500);\r\n\r\n        async function fetchArtifact() {\r\n            try {\r\n                const token = await user?.getIdToken();\r\n                const result = await GeminiService.generateFutureArtifact(transcript, outcome, token);\r\n                setArtifact(result);\r\n            } catch (e) {\r\n                console.error(\"Time Machine Failed\", e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        }\r\n\r\n        fetchArtifact();\r\n        return () => clearInterval(interval);\r\n    }, [transcript, outcome, user]);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"fixed inset-0 z-[60] bg-black flex flex-col items-center justify-center overflow-hidden\">\r\n                <div className=\"text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 animate-pulse tracking-tighter\">\r\n                    {year}\r\n                </div>\r\n                <div className=\"mt-4 text-slate-500 font-mono text-sm tracking-widest uppercase animate-bounce\">\r\n                    Constructing Future Timeline...\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!artifact) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[60] bg-black/90 backdrop-blur-xl flex items-center justify-center p-4\">\r\n            <button onClick={onClose} className=\"absolute top-8 right-8 text-slate-500 hover:text-white transition-colors\">\r\n                <X size={32} />\r\n            </button>\r\n            <div className=\"max-w-4xl w-full animate-in zoom-in-95 duration-700\">\r\n                <div className=\"text-center mb-8\">\r\n                    <h2 className=\"text-2xl font-light text-slate-300 tracking-widest uppercase\">\r\n                        Timeline Status: <span className={outcome === 'win' ? \"text-green-400 font-bold\" : \"text-red-500 font-bold\"}>\r\n                            {outcome === 'win' ? 'OPTIMAL' : 'CRITICAL FAILURE'}\r\n                        </span>\r\n                    </h2>\r\n                    <p className=\"text-slate-500 text-sm mt-2\">6 Months into the future...</p>\r\n                </div>\r\n\r\n                {/* ARTIFACT RENDERING LOGIC */}\r\n                {artifact.type === 'news_article' && <NewsArtifact data={artifact} />}\r\n                {artifact.type === 'email' && <EmailArtifact data={artifact} />}\r\n                {artifact.type === 'slack' && <SlackArtifact data={artifact} />}\r\n                {artifact.type === 'stock' && <StockArtifact data={artifact} />}\r\n\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- ARTIFACT COMPONENTS ---\r\n\r\nfunction NewsArtifact({ data }: { data: AIFutureArtifact }) {\r\n    return (\r\n        <div className=\"bg-white text-black p-8 rounded-sm shadow-2xl skew-y-1 transform transition-all hover:skew-y-0\">\r\n            <div className=\"border-b-4 border-black pb-4 mb-6 flex justify-between items-end\">\r\n                <h1 className=\"text-4xl font-black tracking-tighter italic font-serif\">TechCrunch</h1>\r\n                <span className=\"font-mono text-sm text-gray-500\">{data.date}</span>\r\n            </div>\r\n            <h2 className=\"text-3xl font-bold leading-tight mb-4\">{data.headline}</h2>\r\n            <div className=\"flex gap-6\">\r\n                <div className=\"w-1/3 bg-gray-200 h-48 rounded-sm flex items-center justify-center overflow-hidden grayscale relative\">\r\n                    {data.imageUrl && (\r\n                        <Image\r\n                            src={data.imageUrl}\r\n                            alt=\"News\"\r\n                            fill\r\n                            className=\"object-cover mix-blend-multiply\"\r\n                        />\r\n                    )}\r\n                </div>\r\n                <div className=\"w-2/3 font-serif text-lg leading-relaxed text-gray-800\">\r\n                    <p className=\"first-letter:text-5xl first-letter:font-bold first-letter:mr-2 float-left\">\r\n                        {data.body?.charAt(0) || \"\"}\r\n                    </p>\r\n                    {data.body?.substring(1) || \"\"}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction EmailArtifact({ data }: { data: AIFutureArtifact }) {\r\n    return (\r\n        <div className=\"bg-white text-gray-900 rounded-lg shadow-2xl overflow-hidden border border-gray-200\">\r\n            <div className=\"bg-gray-100 p-2 border-b flex gap-2\">\r\n                <div className=\"w-3 h-3 rounded-full bg-red-400\"></div>\r\n                <div className=\"w-3 h-3 rounded-full bg-yellow-400\"></div>\r\n                <div className=\"w-3 h-3 rounded-full bg-green-400\"></div>\r\n            </div>\r\n            <div className=\"p-8\">\r\n                <div className=\"flex items-center justify-between mb-8\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xl\">\r\n                            {data.from?.charAt(0) || \"U\"}\r\n                        </div>\r\n                        <div>\r\n                            <div className=\"font-bold text-lg\">{data.from || \"Unknown Sender\"}</div>\r\n                            <div className=\"text-gray-500 text-sm\">to {data.to || \"User\"}</div>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"text-gray-400 text-sm\">{data.date}</div>\r\n                </div>\r\n                <div className=\"text-2xl font-bold mb-6\">{data.subject}</div>\r\n                <div className=\"text-lg leading-relaxed whitespace-pre-wrap font-sans text-gray-700\">\r\n                    {data.body}\r\n                </div>\r\n                <div className=\"mt-12 pt-8 border-t border-gray-100 text-gray-400 text-sm italic\">\r\n                    Sent from my iPhone\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction SlackArtifact({ data }: { data: AIFutureArtifact }) {\r\n    return (\r\n        <div className=\"bg-[#1a1d21] text-white rounded-lg shadow-2xl overflow-hidden border border-gray-800 w-full max-w-2xl mx-auto\">\r\n            <div className=\"bg-[#111315] p-4 border-b border-gray-800 flex items-center gap-3\">\r\n                <span className=\"text-gray-400 text-lg\">#</span>\r\n                <span className=\"font-bold\">{data.channel}</span>\r\n            </div>\r\n            <div className=\"p-6 space-y-6\">\r\n                {data.messages?.map((msg, idx) => (\r\n                    <div key={idx} className=\"flex gap-4 group\">\r\n                        <div className=\"w-10 h-10 rounded bg-gradient-to-tr from-purple-500 to-pink-500 flex items-center justify-center font-bold text-sm\">\r\n                            {msg.user.charAt(0)}\r\n                        </div>\r\n                        <div>\r\n                            <div className=\"flex items-baseline gap-2\">\r\n                                <span className=\"font-bold text-sm\">{msg.user}</span>\r\n                                <span className=\"text-xs text-gray-500\">10:4{idx} AM</span>\r\n                            </div>\r\n                            <p className=\"text-gray-300\">{msg.text}</p>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            <div className=\"p-4 bg-[#222529] border-t border-gray-800\">\r\n                <div className=\"bg-[#1a1d21] border border-gray-600 rounded p-2 text-gray-500 text-sm\">\r\n                    Message #{data.channel}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction StockArtifact({ data }: { data: AIFutureArtifact }) {\r\n    return (\r\n        <div className=\"bg-slate-900 border border-slate-800 rounded-xl p-8 shadow-2xl relative overflow-hidden\">\r\n            <div className=\"absolute top-0 right-0 p-32 bg-red-500/10 blur-[100px] rounded-full\"></div>\r\n\r\n            <div className=\"flex justify-between items-start mb-12 relative z-10\">\r\n                <div>\r\n                    <h1 className=\"text-6xl font-black text-white\">{data.ticker}</h1>\r\n                    <p className=\"text-slate-400 uppercase tracking-widest mt-2\">{data.ticker} Corp.</p>\r\n                </div>\r\n                <div className=\"text-right\">\r\n                    <h2 className=\"text-6xl font-bold text-red-500 flex items-center justify-end gap-2\">\r\n                        <TrendingDown size={48} /> {data.price}\r\n                    </h2>\r\n                    <p className=\"text-red-400 font-mono text-xl mt-2\">{data.change} Today</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Chart Line */}\r\n            <div className=\"h-32 w-full flex items-end gap-1 mb-8\">\r\n                {[...Array(20)].map((_, i) => (\r\n                    <div key={i} className=\"flex-1 bg-red-500/20 hover:bg-red-500/50 transition-colors\" style={{ height: `${(i * 13) % 60 + 20}%` }}></div>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"bg-red-500/10 border-l-4 border-red-500 p-6 rounded-r-lg relative z-10\">\r\n                <div className=\"flex items-center gap-3 mb-2\">\r\n                    <AlertTriangle className=\"text-red-500\" />\r\n                    <span className=\"text-red-500 font-bold uppercase text-sm tracking-widest\">Market Alert</span>\r\n                </div>\r\n                <p className=\"text-white text-xl font-bold leading-relaxed\">{data.news}</p>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\training\\WarRoomRunner.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Send' is defined but never used.","line":5,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Unlock' is defined but never used.","line":6,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":7,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":7,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":7,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RotateCcw' is defined but never used.","line":7,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":8,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used.","line":8,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DominanceLevel' is defined but never used.","line":14,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":51},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'gameState.scenario', 'gameState.status', and 'gameState.turnCount'. Either include them or remove the dependency array.","line":218,"column":8,"nodeType":"ArrayExpression","endLine":218,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [gameState.scenario, gameState.status, gameState.turnCount, user]","fix":{"range":[9004,9010],"text":"[gameState.scenario, gameState.status, gameState.turnCount, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n    X, Mail, ShieldAlert, CheckCircle, Send, Users,\r\n    Briefcase, Activity, Lock, Unlock, AlertTriangle,\r\n    TrendingUp, TrendingDown, Clock, Play, RotateCcw,\r\n    FileText, Phone, MessageSquare, Loader2, Database, ChevronRight\r\n} from 'lucide-react';\r\nimport { GeminiService } from '@/lib/ai/gemini';\r\nimport { ResourcesService } from '@/lib/firebase/resources';\r\nimport { LeadsService } from '@/lib/firebase/services';\r\nimport { Resource, Lead } from '@/types';\r\nimport { AIStakeholder, AIScenario, DominanceLevel } from '@/types/ai';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\n\r\ninterface WarRoomRunnerProps {\r\n    onClose: () => void;\r\n    initialContext?: {\r\n        company: string;\r\n        industry: string;\r\n        value: string;\r\n        stage?: string;\r\n        contact?: string;\r\n    };\r\n}\r\n\r\n// --- GAME TYPES ---\r\n\r\ntype Stakeholder = AIStakeholder & {\r\n    status: 'unlocked' | 'locked'; // locked until engaged?\r\n};\r\n\r\ntype ActionCard = {\r\n    id: string;\r\n    label: string;\r\n    icon: React.ReactNode;\r\n    risk: 'Low' | 'Medium' | 'High';\r\n    description: string;\r\n    cost: number; // Political capital cost?\r\n};\r\n\r\ntype LogEntry = {\r\n    id: string;\r\n    type: 'system' | 'email' | 'event';\r\n    title: string;\r\n    description: string;\r\n    timestamp: string;\r\n    impact?: number;\r\n    agentName?: string;\r\n};\r\n\r\ntype GameState = {\r\n    status: 'setup' | 'initializing' | 'playing' | 'won' | 'lost';\r\n    dealHealth: number;\r\n    scenario: Omit<AIScenario, 'stakeholders'> | null;\r\n    stakeholders: Stakeholder[];\r\n    logs: LogEntry[];\r\n    turnCount: number;\r\n    maxTurns: number;\r\n};\r\n\r\n// --- ACTION DECK ---\r\nconst ACTION_DECK: ActionCard[] = [\r\n    { id: 'whitepaper', label: 'Send Whitepaper', icon: <FileText size={16} />, risk: 'Low', description: 'Safe, standard move. Good for analytical types.', cost: 1 },\r\n    { id: 'demo', label: 'Schedule Demo', icon: <Play size={16} />, risk: 'Low', description: 'Show the product. effective if interest is real.', cost: 2 },\r\n    { id: 'social', label: 'Social Engineering', icon: <MessageSquare size={16} />, risk: 'Medium', description: 'Dig for hidden agendas via backchannels.', cost: 2 },\r\n    { id: 'ciso', label: 'CISO-to-CISO Call', icon: <Lock size={16} />, risk: 'Medium', description: 'High impact for security blockers.', cost: 3 },\r\n    { id: 'executive', label: 'Executive Override', icon: <Briefcase size={16} />, risk: 'High', description: 'Go over their head. Huge risk, huge reward.', cost: 4 },\r\n];\r\n\r\nexport function WarRoomRunner({ onClose, initialContext }: WarRoomRunnerProps) {\r\n    const [gameState, setGameState] = useState<GameState>({\r\n        status: 'setup',\r\n        dealHealth: 50,\r\n        scenario: null,\r\n        stakeholders: [],\r\n        logs: [],\r\n        turnCount: 1,\r\n        maxTurns: 8\r\n    });\r\n\r\n    const [selectedStakeholderId, setSelectedStakeholderId] = useState<string | null>(null);\r\n    const [isProcessingTurn, setIsProcessingTurn] = useState(false);\r\n    const logsEndRef = useRef<HTMLDivElement>(null);\r\n    const { user } = useAuth();\r\n\r\n    // Setup State\r\n    const [resources, setResources] = useState<Resource[]>([]);\r\n    const [leads, setLeads] = useState<Lead[]>([]);\r\n    const [selectedResourceId, setSelectedResourceId] = useState<string | null>(null);\r\n    const [selectedLeadId, setSelectedLeadId] = useState<string | null>(null);\r\n    const [loadingResources, setLoadingResources] = useState(false);\r\n\r\n    // Fetch resources and leads on mount\r\n    useEffect(() => {\r\n        setLoadingResources(true);\r\n        const fetchData = async () => {\r\n            try {\r\n                // Resources\r\n                const companyData = await ResourcesService.getCompanyResources();\r\n                let userData: Resource[] = [];\r\n                let userLeads: Lead[] = [];\r\n\r\n                if (user) {\r\n                    userData = await ResourcesService.getUserResources(user.uid);\r\n                    userLeads = await LeadsService.getLeads(user.uid);\r\n                }\r\n                const allData = [...companyData, ...userData];\r\n\r\n                // Filter for likely text-based files\r\n                const textBased = allData.filter(r => r.type === 'document' || r.type === 'sheet' || r.title.endsWith('.txt') || r.title.endsWith('.md'));\r\n                setResources(textBased);\r\n                setLeads(userLeads);\r\n            } catch (err) {\r\n                console.error(err);\r\n            } finally {\r\n                setLoadingResources(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, [user]);\r\n\r\n    // --- GAME START ---\r\n    const startGame = async () => {\r\n        setGameState(prev => ({ ...prev, status: 'initializing' }));\r\n\r\n        try {\r\n            // 1. Fetch Context Content if selected\r\n            let contextContent = \"\";\r\n            if (selectedResourceId) {\r\n                const res = resources.find(r => r.id === selectedResourceId);\r\n                if (res?.url) {\r\n                    try {\r\n                        const response = await fetch(res.url);\r\n                        contextContent = await response.text();\r\n                    } catch (e) {\r\n                        console.error(\"Failed to read resource text\", e);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // 2. Generate Scenario\r\n            const level = Math.random() > 0.5 ? 'Hard' : 'Extreme';\r\n            const token = await user?.getIdToken();\r\n\r\n            // Crisis Ops: Use Selected Lead Data if available\r\n            let leadContext = initialContext;\r\n            if (selectedLeadId) {\r\n                const lead = leads.find(l => l.id === selectedLeadId);\r\n                if (lead) {\r\n                    leadContext = {\r\n                        company: lead.companyName,\r\n                        industry: lead.industry || 'Tech',\r\n                        value: lead.value.toString(),\r\n                        // Additional context for the AI\r\n                        stage: lead.status,\r\n                        contact: lead.contactName\r\n                    };\r\n                }\r\n            }\r\n\r\n            const scenario = await GeminiService.generateDealScenario(level, leadContext, contextContent, token);\r\n\r\n            if (scenario) {\r\n                setGameState(prev => ({\r\n                    ...prev,\r\n                    status: 'playing',\r\n                    scenario: {\r\n                        company: scenario.company,\r\n                        industry: scenario.industry,\r\n                        dealValue: scenario.dealValue,\r\n                        description: scenario.description,\r\n                        difficulty: scenario.difficulty\r\n                    },\r\n                    stakeholders: (scenario.stakeholders || []).map((s: AIStakeholder) => ({ ...s, status: 'unlocked' as const })),\r\n                    dealHealth: 50, // Start neutral\r\n                    logs: [{\r\n                        id: 'init',\r\n                        type: 'system',\r\n                        title: 'MISSION START',\r\n                        description: `Target: ${scenario.company} (${scenario.industry}). Value: ${scenario.dealValue}. Mode: ${selectedLeadId ? 'CRISIS OPS (Real Deal)' : 'Standard Sim'}. Context: ${selectedResourceId ? 'Custom Data' : 'None'}.`,\r\n                        timestamp: 'Day 1'\r\n                    }]\r\n                }));\r\n                // Auto-select first stakeholder\r\n                if (scenario.stakeholders && scenario.stakeholders.length > 0) {\r\n                    setSelectedStakeholderId(scenario.stakeholders[0].id);\r\n                }\r\n            } else {\r\n                // Handle failure\r\n                setGameState(prev => ({ ...prev, status: 'setup' })); // Go back to setup?\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Failed to init game\", error);\r\n            setGameState(prev => ({ ...prev, status: 'setup' }));\r\n        }\r\n    };\r\n\r\n    // --- SCROLL TO BOTTOM OF LOGS ---\r\n    useEffect(() => {\r\n        if (logsEndRef.current) {\r\n            logsEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [gameState.logs]);\r\n\r\n    // Re-run init when user is available and we haven't started (optional protection)\r\n    useEffect(() => {\r\n        if (user && gameState.status === 'initializing' && !gameState.scenario && gameState.turnCount === 1) {\r\n            // We relying on the initial effect, but user might be null initially.\r\n            // However, initGame is called on mount. If user is null then, token is undefined.\r\n            // Service handles undefined token by not sending header (for now).\r\n            // But server WILL require it.\r\n            // We should reload initGame if user becomes available? \r\n            // Actually, let's just assume user is loaded or useAuth handles loading state.\r\n        }\r\n    }, [user]);\r\n\r\n    // --- GAME LOGIC ---\r\n\r\n    const handleAction = async (actionId: string) => {\r\n        if (!selectedStakeholderId || isProcessingTurn) return;\r\n\r\n        const actionCard = ACTION_DECK.find(a => a.id === actionId);\r\n        if (!actionCard) return;\r\n\r\n        setIsProcessingTurn(true);\r\n\r\n        // Optimistic UI Log\r\n        const turnId = Date.now().toString();\r\n        const target = gameState.stakeholders.find(s => s.id === selectedStakeholderId);\r\n\r\n        setGameState(prev => ({\r\n            ...prev,\r\n            logs: [...prev.logs, {\r\n                id: `cmd-${turnId}`,\r\n                type: 'system',\r\n                title: 'EXECUTING STRATEGY...',\r\n                description: `Action: ${actionCard.label} targeting ${target?.name}...`,\r\n                timestamp: `Day ${prev.turnCount}`\r\n            }]\r\n        }));\r\n\r\n        try {\r\n            // AI Evaluation\r\n            const result = await GeminiService.evaluateTurn(\r\n                {\r\n                    company: gameState.scenario?.company || 'Unknown',\r\n                    stakeholders: gameState.stakeholders\r\n                },\r\n                actionCard.label,\r\n                selectedStakeholderId,\r\n                await user?.getIdToken()\r\n            );\r\n\r\n            if (result) {\r\n                // Update State\r\n                setGameState(prev => {\r\n                    const newHealth = Math.max(0, Math.min(100, prev.dealHealth + (result.dealHealthDelta || 0)));\r\n                    const newStatus = newHealth <= 0 ? 'lost' : newHealth >= 100 ? 'won' : prev.turnCount >= prev.maxTurns ? 'lost' : 'playing';\r\n\r\n                    // Update specific stakeholder sentiment\r\n                    const updatedStakeholders = prev.stakeholders.map(s =>\r\n                        s.id === selectedStakeholderId\r\n                            ? { ...s, sentiment: Math.max(0, Math.min(100, s.sentiment + (result.sentimentDelta || 0))) }\r\n                            : s\r\n                    );\r\n\r\n                    return {\r\n                        ...prev,\r\n                        status: newStatus,\r\n                        dealHealth: newHealth,\r\n                        stakeholders: updatedStakeholders,\r\n                        turnCount: prev.turnCount + 1,\r\n                        logs: [...prev.logs, {\r\n                            id: `res-${turnId}`,\r\n                            type: 'email',\r\n                            title: result.outcomeTitle,\r\n                            description: result.outcomeDescription,\r\n                            timestamp: `Day ${prev.turnCount}`,\r\n                            impact: result.dealHealthDelta,\r\n                            agentName: result.emailResponse?.from\r\n                        }]\r\n                    };\r\n                });\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(\"Turn Error\", error);\r\n        } finally {\r\n            setIsProcessingTurn(false);\r\n        }\r\n    };\r\n\r\n    // --- RENDERING ---\r\n\r\n    // --- RENDERING ---\r\n\r\n    if (gameState.status === 'setup') {\r\n        return (\r\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/95 backdrop-blur-md p-4\">\r\n                <div className=\"max-w-2xl w-full bg-slate-900 border border-slate-800 rounded-xl p-8 shadow-2xl relative overflow-hidden\">\r\n                    {/* Decorative Background */}\r\n                    <div className=\"absolute top-0 right-0 w-64 h-64 bg-blue-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none\"></div>\r\n\r\n                    <button onClick={onClose} className=\"absolute top-4 right-4 text-slate-500 hover:text-white\">\r\n                        <X className=\"w-6 h-6\" />\r\n                    </button>\r\n\r\n                    <div className=\"mb-8\">\r\n                        <h2 className=\"text-3xl font-bold text-white mb-2 flex items-center gap-3\">\r\n                            <span className=\"p-2 bg-blue-600/20 rounded-lg text-blue-400\"><Database className=\"w-6 h-6\" /></span>\r\n                            Mission Parameters\r\n                        </h2>\r\n                        <p className=\"text-slate-400\">Configure your simulation environment. Run &ldquo;Crisis Ops&rdquo; on live deals or standard training.</p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-slate-300 mb-3 uppercase tracking-wider\">Enablement Context (Optional)</label>\r\n\r\n                            {loadingResources ? (\r\n                                <div className=\"flex items-center gap-2 text-slate-500 p-4 border border-dashed border-slate-800 rounded-lg\">\r\n                                    <Loader2 className=\"w-4 h-4 animate-spin\" /> Loading resources...\r\n                                </div>\r\n                            ) : resources.length === 0 ? (\r\n                                <div className=\"p-4 border border-dashed border-slate-800 rounded-lg text-slate-500 text-sm text-center\">\r\n                                    No text-based resources found. Upload documents in the Resources tab to use them here.\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar\">\r\n                                    {resources.map(res => (\r\n                                        <div\r\n                                            key={res.id}\r\n                                            onClick={() => setSelectedResourceId(selectedResourceId === res.id ? null : res.id)}\r\n                                            className={`\r\n                                                p-3 rounded-lg border cursor-pointer transition-all flex items-center gap-3\r\n                                                ${selectedResourceId === res.id\r\n                                                    ? 'bg-blue-600/20 border-blue-500 text-white shadow-[0_0_15px_rgba(59,130,246,0.2)]'\r\n                                                    : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-800 hover:border-slate-600'}\r\n                                            `}\r\n                                        >\r\n                                            <FileText className={`w-5 h-5 ${selectedResourceId === res.id ? 'text-blue-400' : 'text-slate-500'}`} />\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"font-medium truncate text-sm\">{res.title}</div>\r\n                                                <div className=\"text-xs opacity-60 truncate\">{res.category}</div>\r\n                                            </div>\r\n                                            {selectedResourceId === res.id && <CheckCircle className=\"w-4 h-4 text-blue-400\" />}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Crisis Ops Section */}\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-slate-300 mb-3 uppercase tracking-wider\">\r\n                                Crisis Ops (Wargame a Live Deal)\r\n                            </label>\r\n\r\n                            {leads.length === 0 ? (\r\n                                <div className=\"p-4 border border-dashed border-slate-800 rounded-lg text-slate-500 text-sm text-center\">\r\n                                    No active leads found in CRM.\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-40 overflow-y-auto pr-2 custom-scrollbar\">\r\n                                    {leads.map(lead => (\r\n                                        <div\r\n                                            key={lead.id}\r\n                                            onClick={() => setSelectedLeadId(selectedLeadId === lead.id ? null : lead.id)}\r\n                                            className={`\r\n                                                p-3 rounded-lg border cursor-pointer transition-all flex items-center gap-3\r\n                                                ${selectedLeadId === lead.id\r\n                                                    ? 'bg-red-900/40 border-red-500 text-white shadow-[0_0_15px_rgba(239,68,68,0.2)]'\r\n                                                    : 'bg-slate-800/50 border-slate-700 text-slate-400 hover:bg-slate-800 hover:border-slate-600'}\r\n                                            `}\r\n                                        >\r\n                                            <ShieldAlert className={`w-5 h-5 ${selectedLeadId === lead.id ? 'text-red-500' : 'text-slate-600'}`} />\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <div className=\"font-medium truncate text-sm\">{lead.companyName}</div>\r\n                                                <div className=\"text-xs opacity-60 truncate\">${lead.value?.toLocaleString()}  {lead.status}</div>\r\n                                            </div>\r\n                                            {selectedLeadId === lead.id && <CheckCircle className=\"w-4 h-4 text-red-500\" />}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"pt-6 border-t border-slate-800 flex justify-end gap-3\">\r\n                            <button\r\n                                onClick={onClose}\r\n                                className=\"px-6 py-3 rounded-lg text-slate-400 font-medium hover:text-white transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={startGame}\r\n                                className=\"px-8 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold shadow-lg shadow-blue-900/20 flex items-center gap-2 group transition-all transform hover:scale-[1.02]\"\r\n                            >\r\n                                <Play className=\"w-5 h-5 fill-current\" />\r\n                                Start Simulation\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (gameState.status === 'initializing') {\r\n        return (\r\n            <div className=\"fixed inset-0 left-64 z-50 flex items-center justify-center bg-slate-950\">\r\n                <div className=\"text-center space-y-4\">\r\n                    <div className=\"relative w-24 h-24 mx-auto\">\r\n                        <div className=\"absolute inset-0 border-4 border-orange-500/30 rounded-full animate-ping\"></div>\r\n                        <div className=\"absolute inset-0 border-4 border-t-orange-500 rounded-full animate-spin\"></div>\r\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                            <Activity className=\"text-orange-500 animate-pulse\" size={32} />\r\n                        </div>\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-white tracking-widest uppercase\">Initializing War Room</h2>\r\n                    <p className=\"text-orange-400 font-mono text-sm\">Generating Procedural Scenario via Gemini 2.5 Flash...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const activeStakeholder = gameState.stakeholders.find(s => s.id === selectedStakeholderId);\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 left-64 z-50 bg-slate-950 text-slate-200 font-sans overflow-hidden flex flex-col\">\r\n\r\n            {/* --- HEADER HUD --- */}\r\n            <div className=\"h-16 border-b border-orange-500/20 bg-slate-900/50 backdrop-blur-md flex items-center justify-between px-6 shrink-0 relative z-20\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"p-2 bg-orange-500/10 rounded border border-orange-500/20\">\r\n                        <ShieldAlert className=\"text-orange-500\" size={20} />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"font-bold text-white uppercase tracking-wider flex items-center gap-2\">\r\n                            {gameState.scenario?.company}\r\n                            <span className=\"text-xs bg-slate-800 px-2 py-0.5 rounded text-orange-400 border border-orange-500/20\">{gameState.scenario?.difficulty}</span>\r\n                        </h1>\r\n                        <div className=\"text-xs text-slate-500 font-mono\">VAL: {gameState.scenario?.dealValue}  IND: {gameState.scenario?.industry}</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-8\">\r\n                    {/* Deal Health Bar */}\r\n                    <div className=\"flex flex-col items-end w-64\">\r\n                        <div className=\"flex justify-between w-full text-xs font-bold uppercase mb-1\">\r\n                            <span className=\"text-slate-500\">Deal Probability</span>\r\n                            <span className={gameState.dealHealth > 50 ? 'text-green-500' : 'text-red-500'}>{gameState.dealHealth}%</span>\r\n                        </div>\r\n                        <div className=\"w-full h-2 bg-slate-800 rounded-full overflow-hidden relative\">\r\n                            <div\r\n                                className={`h-full transition-all duration-700 ease-out ${gameState.dealHealth > 66 ? 'bg-green-500' : gameState.dealHealth > 33 ? 'bg-amber-500' : 'bg-red-500'}`}\r\n                                style={{ width: `${gameState.dealHealth}%` }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Turn Counter */}\r\n                    <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-white font-mono\">{gameState.turnCount} <span className=\"text-slate-600 text-sm\">/ {gameState.maxTurns}</span></div>\r\n                        <div className=\"text-[10px] uppercase text-slate-500 tracking-widest\">Days Elapsed</div>\r\n                    </div>\r\n\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/10 rounded-full transition-colors\">\r\n                        <X size={24} className=\"text-slate-400 hover:text-white\" />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* --- MAIN CONTENT GRID --- */}\r\n            <div className=\"flex-1 overflow-hidden flex relative\">\r\n\r\n                {/* LEFT: STAKEHOLDERS (The Board) */}\r\n                <div className=\"w-1/3 border-r border-orange-500/10 bg-slate-900/30 flex flex-col p-6 overflow-y-auto\">\r\n                    <h3 className=\"text-xs font-bold uppercase text-slate-500 mb-4 flex items-center gap-2\">\r\n                        <Users size={14} /> Key Stakeholders\r\n                    </h3>\r\n\r\n                    <div className=\"space-y-4\">\r\n                        {gameState.stakeholders.map(stakeholder => (\r\n                            <div\r\n                                key={stakeholder.id}\r\n                                onClick={() => setSelectedStakeholderId(stakeholder.id)}\r\n                                className={`\r\n                                    relative p-4 rounded-xl border cursor-pointer transition-all duration-300 group\r\n                                    ${selectedStakeholderId === stakeholder.id\r\n                                        ? 'bg-orange-500/10 border-orange-500 shadow-[0_0_20px_rgba(249,115,22,0.15)]'\r\n                                        : 'bg-white/5 border-white/5 hover:bg-white/10 hover:border-white/20'}\r\n                                `}\r\n                            >\r\n                                <div className=\"flex justify-between items-start mb-2\">\r\n                                    <div>\r\n                                        <div className=\"font-bold text-slate-100\">{stakeholder.name}</div>\r\n                                        <div className=\"text-xs text-orange-400 font-mono\">{stakeholder.role}</div>\r\n                                    </div>\r\n                                    <div className={`\r\n                                        w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs\r\n                                        ${stakeholder.sentiment >= 70 ? 'bg-green-500/20 text-green-400' : stakeholder.sentiment <= 40 ? 'bg-red-500/20 text-red-400' : 'bg-amber-500/20 text-amber-400'}\r\n                                    `}>\r\n                                        {stakeholder.sentiment}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex flex-wrap gap-2 mt-3\">\r\n                                    {stakeholder.traits.map(trait => (\r\n                                        <span key={trait} className=\"px-2 py-0.5 rounded text-[10px] uppercase bg-black/30 text-slate-400 border border-white/5\">\r\n                                            {trait}\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n\r\n                                {selectedStakeholderId === stakeholder.id && (\r\n                                    <div className=\"absolute -right-1 top-1/2 -translate-y-1/2 w-2 h-12 bg-orange-500 rounded-l-full blur-[2px]\"></div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* MIDDLE: ACTION CENTER */}\r\n                <div className=\"flex-1 flex flex-col bg-slate-950 relative\">\r\n\r\n                    {/* Background Grid */}\r\n                    <div className=\"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px]\"></div>\r\n                    <div className=\"absolute inset-0 bg-gradient-to-b from-slate-950 via-transparent to-slate-950\"></div>\r\n\r\n                    {/* Active Target Info */}\r\n                    <div className=\"relative z-10 p-8 text-center border-b border-white/5 bg-slate-900/40 backdrop-blur-sm h-48 flex flex-col justify-center\">\r\n                        {activeStakeholder ? (\r\n                            <div className=\"animate-in fade-in zoom-in-95 duration-300\">\r\n                                <div className=\"text-sm text-orange-400 font-mono uppercase tracking-widest mb-2\">Target Locked</div>\r\n                                <h2 className=\"text-3xl font-bold text-white mb-2\">{activeStakeholder.name}</h2>\r\n                                <p className=\"text-slate-400 max-w-md mx-auto\">{gameState.status === 'playing' ? \"Select a strategic action below to influence this stakeholder.\" : \"Simulation Ended.\"}</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"text-slate-500 italic\">Select a stakeholder to target...</div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Action Deck */}\r\n                    <div className=\"flex-1 p-8 grid grid-cols-2 md:grid-cols-3 gap-4 content-start overflow-y-auto z-10\">\r\n                        {gameState.status === 'playing' && ACTION_DECK.map(card => (\r\n                            <button\r\n                                key={card.id}\r\n                                disabled={!selectedStakeholderId || isProcessingTurn}\r\n                                onClick={() => handleAction(card.id)}\r\n                                className={`\r\n                                    relative group p-4 rounded-xl border text-left transition-all duration-300\r\n                                    flex flex-col gap-3 overflow-hidden\r\n                                    ${!selectedStakeholderId\r\n                                        ? 'opacity-50 border-white/5 cursor-not-allowed grayscale'\r\n                                        : 'bg-slate-900/80 border-white/10 hover:border-orange-500/50 hover:bg-slate-800 hover:shadow-lg hover:-translate-y-1'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <div className=\"flex justify-between items-start w-full\">\r\n                                    <div className=\"p-2 rounded bg-white/5 text-orange-400 group-hover:text-white group-hover:bg-orange-500 transition-colors\">\r\n                                        {card.icon}\r\n                                    </div>\r\n                                    <span className={`text-[10px] uppercase font-bold px-2 py-0.5 rounded border ${card.risk === 'Low' ? 'border-green-500/30 text-green-400' :\r\n                                        card.risk === 'Medium' ? 'border-amber-500/30 text-amber-400' :\r\n                                            'border-red-500/30 text-red-400'\r\n                                        }`}>\r\n                                        {card.risk} Risk\r\n                                    </span>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"font-bold text-slate-200 group-hover:text-orange-100\">{card.label}</div>\r\n                                    <div className=\"text-xs text-slate-500 mt-1 leading-relaxed\">{card.description}</div>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* RIGHT: LIVE LOG (The \"Wire\") */}\r\n                <div className=\"w-80 border-l border-orange-500/10 bg-black/40 flex flex-col\">\r\n                    <div className=\"p-4 border-b border-white/10 bg-slate-900/50 backdrop-blur\">\r\n                        <h3 className=\"text-xs font-bold uppercase text-orange-500 flex items-center gap-2\">\r\n                            <Activity size={14} /> Mission Log\r\n                        </h3>\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-y-auto p-4 space-y-4 font-mono text-sm relative\">\r\n                        {gameState.logs.map((log) => (\r\n                            <div key={log.id} className=\"animate-in slide-in-from-right-4 fade-in duration-300\">\r\n                                <div className=\"flex items-center gap-2 text-[10px] text-slate-500 mb-1\">\r\n                                    <span>{log.timestamp}</span>\r\n                                    <div className=\"h-px bg-white/10 flex-1\"></div>\r\n                                </div>\r\n                                <div className={`p-3 rounded border border-l-2 ${log.type === 'system' ? 'border-slate-800 border-l-slate-500 bg-slate-900/50' :\r\n                                    (log.impact || 0) > 0 ? 'border-green-900/30 border-l-green-500 bg-green-950/10' :\r\n                                        'border-red-900/30 border-l-red-500 bg-red-950/10'\r\n                                    }`}>\r\n                                    <div className=\"font-bold text-slate-300 mb-1 flex justify-between\">\r\n                                        {log.title}\r\n                                        {log.impact && (\r\n                                            <span className={log.impact > 0 ? \"text-green-400\" : \"text-red-400\"}>\r\n                                                {log.impact > 0 ? '+' : ''}{log.impact}%\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"text-slate-400 text-xs leading-relaxed\">\r\n                                        {log.description}\r\n                                    </div>\r\n                                    {log.type === 'email' && (\r\n                                        <div className=\"mt-2 text-[10px] text-orange-400 flex items-center gap-1\">\r\n                                            <Mail size={10} /> From: {log.agentName}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                        <div ref={logsEndRef} />\r\n\r\n                        {isProcessingTurn && (\r\n                            <div className=\"flex items-center gap-2 text-xs text-orange-400 animate-pulse mt-4\">\r\n                                <div className=\"w-2 h-2 bg-orange-500 rounded-full\"></div>\r\n                                Awaiting response...\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {/* GAME OVER MODAL */}\r\n            {(gameState.status === 'won' || gameState.status === 'lost') && (\r\n                <div className=\"absolute inset-0 z-50 bg-slate-950/90 backdrop-blur-lg flex items-center justify-center animate-in fade-in duration-500\">\r\n                    <div className=\"max-w-md w-full glass-card p-8 text-center border-orange-500/30\">\r\n                        <div className={`w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-6 border-4 ${gameState.status === 'won' ? 'border-green-500/30 bg-green-500/10 text-green-400' : 'border-red-500/30 bg-red-500/10 text-red-500'}`}>\r\n                            {gameState.status === 'won' ? <CheckCircle size={40} /> : <AlertTriangle size={40} />}\r\n                        </div>\r\n                        <h2 className=\"text-4xl font-bold text-white mb-2\">{gameState.status === 'won' ? 'DEAL CLOSED' : 'DEAL LOST'}</h2>\r\n                        <p className=\"text-slate-400 mb-8\">\r\n                            {gameState.status === 'won'\r\n                                ? \"Excellent work. You successfully aligned the stakeholders.\"\r\n                                : \"The deal fell through. Review the logs to identify the breaking point.\"}\r\n                        </p>\r\n                        <button\r\n                            onClick={onClose}\r\n                            className=\"w-full py-4 rounded-lg bg-orange-600 hover:bg-orange-500 text-white font-bold transition-all\"\r\n                        >\r\n                            Debrief & Exit\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\CookieConsent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\GlassCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\PageHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\Sidebar.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":71,"column":33,"nodeType":"JSXOpeningElement","endLine":75,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport React, { useState } from 'react';\r\nimport { useAuth } from '@/components/providers/AuthProvider';\r\nimport { LogIn, LogOut, Settings, User } from 'lucide-react';\r\n\r\nexport function Sidebar() {\r\n    const { user, loading, signInWithGoogle, logout } = useAuth();\r\n    const [isLoggingIn, setIsLoggingIn] = useState(false);\r\n\r\n    const handleLogin = async () => {\r\n        setIsLoggingIn(true);\r\n        try {\r\n            await signInWithGoogle();\r\n        } catch (error) {\r\n            console.error('Login failed:', error);\r\n        } finally {\r\n            setIsLoggingIn(false);\r\n        }\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        try {\r\n            await logout();\r\n        } catch (error) {\r\n            console.error('Logout failed:', error);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <aside\r\n            className=\"w-64 glass-panel h-screen p-6 flex flex-col z-50 rounded-none border-l-0 border-t-0 border-b-0\"\r\n            style={{ position: 'fixed', left: 0, top: 0, width: '16rem', height: '100vh' }}\r\n        >\r\n            <div className=\"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400 mb-10 pl-2\">\r\n                SalesTracker\r\n            </div>\r\n            <nav className=\"flex-1 space-y-2\">\r\n                <NavLink href=\"/\">Dashboard</NavLink>\r\n                <NavLink href=\"/leads\">Leads Pipeline</NavLink>\r\n                <NavLink href=\"/activities\">Activities</NavLink>\r\n                <NavLink href=\"/resources\">Enablement & Resources</NavLink>\r\n                <NavLink href=\"/analytics\">Analytics</NavLink>\r\n                <NavLink href=\"/training\">Training</NavLink>\r\n\r\n                <div className=\"pt-4 mt-4 border-t border-slate-700/30\">\r\n                    <NavLink href=\"/settings\">\r\n                        <span className=\"flex items-center gap-2\">\r\n                            <Settings className=\"w-4 h-4\" />\r\n                            Settings\r\n                        </span>\r\n                    </NavLink>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* Auth Section */}\r\n            <div className=\"pt-6 border-t border-slate-700/50\">\r\n                {loading ? (\r\n                    <div className=\"flex items-center gap-3 pl-2\">\r\n                        <div className=\"w-10 h-10 rounded-full bg-slate-700 animate-pulse\" />\r\n                        <div className=\"flex-1\">\r\n                            <div className=\"h-4 bg-slate-700 rounded animate-pulse w-20 mb-1\" />\r\n                            <div className=\"h-3 bg-slate-700 rounded animate-pulse w-16\" />\r\n                        </div>\r\n                    </div>\r\n                ) : user ? (\r\n                    <div className=\"space-y-3\">\r\n                        <div className=\"flex items-center gap-3 pl-2\">\r\n                            {user.photoURL ? (\r\n                                <img\r\n                                    src={user.photoURL}\r\n                                    alt=\"Profile\"\r\n                                    className=\"w-10 h-10 rounded-full border border-white/10\"\r\n                                />\r\n                            ) : (\r\n                                <div className=\"w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 border border-white/10 flex items-center justify-center\">\r\n                                    <User className=\"w-5 h-5 text-white\" />\r\n                                </div>\r\n                            )}\r\n                            <div className=\"text-sm flex-1 min-w-0\">\r\n                                <div className=\"text-white font-medium truncate\">\r\n                                    {user.displayName || 'User'}\r\n                                </div>\r\n                                <div className=\"text-slate-500 text-xs truncate\">\r\n                                    {user.email}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleLogout}\r\n                            className=\"w-full flex items-center justify-center gap-2 px-4 py-2 text-sm text-slate-400 hover:text-white hover:bg-red-500/20 rounded-lg transition-colors\"\r\n                        >\r\n                            <LogOut className=\"w-4 h-4\" />\r\n                            Sign Out\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <button\r\n                        onClick={handleLogin}\r\n                        disabled={isLoggingIn}\r\n                        className=\"w-full flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 rounded-lg transition-all disabled:opacity-50\"\r\n                    >\r\n                        <LogIn className=\"w-4 h-4\" />\r\n                        {isLoggingIn ? 'Signing in...' : 'Sign in with Google'}\r\n                    </button>\r\n                )}\r\n            </div>\r\n        </aside>\r\n    );\r\n}\r\n\r\nfunction NavLink({ href, children }: { href: string; children: React.ReactNode }) {\r\n    return (\r\n        <Link\r\n            href={href}\r\n            className=\"block px-4 py-3 rounded-lg text-slate-400 hover:text-white hover:bg-white/5 transition-all text-sm font-medium hover:pl-5\"\r\n        >\r\n            {children}\r\n        </Link>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\ai\\courseGenerator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Module' is defined but never used.","line":1,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lesson' is defined but never used.","line":1,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPlaybook' is assigned a value but never used.","line":17,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Course, Module, Lesson, Question } from '@/types/learning';\r\nimport { Resource } from '@/types';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\n/**\r\n * Simulates an AI Engine that analyzes a document and produces a structured course.\r\n * In a real V2, this would call OpenAI/Anthropic with a prompt containing the resource content.\r\n */\r\nexport async function generateCourseFromResource(resource: Resource): Promise<Course> {\r\n    // Simulate API delay\r\n    await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n    const courseId = uuidv4();\r\n\r\n    // Template logic based on resource category\r\n    const isScript = resource.category === 'Prospecting' || resource.title.toLowerCase().includes('script');\r\n    const isPlaybook = resource.category === 'Playbook';\r\n\r\n    return {\r\n        id: courseId,\r\n        title: `Mastering: ${resource.title}`,\r\n        description: `An interactive deep-dive into the ${resource.title}. Learn the core concepts, study the material, and test your knowledge.`,\r\n        author: 'AI Enablement Engine',\r\n        duration: '25 min',\r\n        level: 'Intermediate',\r\n        totalXp: 500,\r\n        tags: [resource.category, 'AI Generated', 'Enablement'],\r\n        generatedFromId: resource.id,\r\n        modules: [\r\n            // Module 1: Understanding the Core Concept\r\n            {\r\n                id: uuidv4(),\r\n                title: 'Core Concepts',\r\n                description: 'Understanding the fundamental principles.',\r\n                lessons: [\r\n                    {\r\n                        id: uuidv4(),\r\n                        title: 'Introduction & Context',\r\n                        type: 'slide',\r\n                        duration: '5 min',\r\n                        content: {\r\n                            slides: [\r\n                                {\r\n                                    id: uuidv4(),\r\n                                    title: `Why ${resource.title} Matters`,\r\n                                    body: `This resource is a critical part of our ${resource.category} strategy.\\n\\nMastering this content will help you improve your efficiency and conversion rates.`,\r\n                                    bullets: [\r\n                                        'Understand the \"Why\" behind the document',\r\n                                        'Learn key terminology',\r\n                                        'Identify best use-cases'\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    id: uuidv4(),\r\n                                    title: 'Key Takeaways',\r\n                                    body: 'Before we dive in, here are the three things you need to remember:',\r\n                                    bullets: [\r\n                                        'Consistency is key',\r\n                                        'Always tailor to the prospect',\r\n                                        'Measure your results'\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            // Module 2: The Deep Dive (Script/Playbook specific)\r\n            {\r\n                id: uuidv4(),\r\n                title: 'Tactical Application',\r\n                description: 'How to apply this in the real world.',\r\n                lessons: [\r\n                    {\r\n                        id: uuidv4(),\r\n                        title: isScript ? 'Delivery & Tonality' : 'Execution Steps',\r\n                        type: 'slide',\r\n                        duration: '10 min',\r\n                        content: {\r\n                            slides: [\r\n                                {\r\n                                    id: uuidv4(),\r\n                                    title: isScript ? 'Perfecting the Delivery' : 'Step-by-Step Execution',\r\n                                    body: isScript\r\n                                        ? \"It's not just what you say, it's how you say it. Focus on:\\n\\n1. Pace (Not too fast)\\n2. Tone (Confident but curious)\\n3. Pauses (Let them think)\"\r\n                                        : \"Follow the playbook exactly to ensure success. Deviation creates variables we can't measure.\",\r\n                                    imageUrl: isScript\r\n                                        ? 'https://images.unsplash.com/photo-1557804506-669a67965ba0?auto=format&fit=crop&q=80&w=800'\r\n                                        : 'https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&q=80&w=800'\r\n                                }\r\n                            ]\r\n                        }\r\n                    }\r\n                ]\r\n            },\r\n            // Module 3: Knowledge Check\r\n            {\r\n                id: uuidv4(),\r\n                title: 'Certification',\r\n                description: 'Verify your understanding.',\r\n                lessons: [\r\n                    {\r\n                        id: uuidv4(),\r\n                        title: 'Final Assessment',\r\n                        type: 'quiz',\r\n                        duration: '10 min',\r\n                        content: {\r\n                            passingScore: 80,\r\n                            questions: [\r\n                                {\r\n                                    id: uuidv4(),\r\n                                    question: `What is the primary goal of the ${resource.title}?`,\r\n                                    options: [\r\n                                        'To confuse the prospect',\r\n                                        'To drive revenue and efficiency',\r\n                                        'To fill up time'\r\n                                    ],\r\n                                    correctOptionIndex: 1,\r\n                                    explanation: 'All our enablement resources are designed to drive core business metrics like revenue and efficiency.'\r\n                                },\r\n                                {\r\n                                    id: uuidv4(),\r\n                                    question: 'When should you apply these techniques?',\r\n                                    options: [\r\n                                        'Only on Fridays',\r\n                                        'Whenever you feel like it',\r\n                                        'Consistently across all relevant interactions'\r\n                                    ],\r\n                                    correctOptionIndex: 2,\r\n                                    explanation: 'Consistency reduces variables and allows us to optimize performance over time.'\r\n                                }\r\n                            ]\r\n                        }\r\n                    }\r\n                ]\r\n            }\r\n        ]\r\n    };\r\n}\r\n\r\n/**\r\n * Generates a batch of randomized, quality questions for \"Endless Mastery\" mode.\r\n */\r\nexport async function generateQuizBatch(count: number): Promise<Question[]> {\r\n    // Simulate API delay\r\n    await new Promise(resolve => setTimeout(resolve, 800));\r\n\r\n    const questions: Question[] = [];\r\n\r\n    // Pool of High-Quality Template Questions (Sales methodology focused)\r\n    // In V2, these would come from the AI analyzing the entire Resource library.\r\n    const questionTemplates = [\r\n        {\r\n            q: \"When a prospect says 'I need to think about it', what is the best immediate response?\",\r\n            o: [\"'Okay, call me next week.'\", \"'What specifically do you need to think about?'\", \"'I'll send you an email.'\", \"'Is it the price?'\"],\r\n            c: 1,\r\n            e: \"Isolating the objection is key. Asking 'What specifically...' forces the prospect to reveal the true blocker (Price, Authority, Timing).\"\r\n        },\r\n        {\r\n            q: \"Which metric is the most critical indicator of a healthy sales pipeline?\",\r\n            o: [\"Total number of leads\", \"Deal Velocity\", \"Number of calls made\", \"Email open rate\"],\r\n            c: 1,\r\n            e: \"Deal Velocity (how fast a deal moves through stages) is the best predictor of revenue. Stagnant deals, even if numerous, do not close.\"\r\n        },\r\n        {\r\n            q: \"In the MEDDIC qualification framework, what does the 'E' stand for?\",\r\n            o: [\"Energy\", \"Engagement\", \"Economic Buyer\", \"Enterprise\"],\r\n            c: 2,\r\n            e: \"The Economic Buyer is the person with the ultimate authority to release funds. Identifying them early is crucial.\"\r\n        },\r\n        {\r\n            q: \"What is the primary purpose of the 'Discovery' phase?\",\r\n            o: [\"To pitch your product features\", \"To qualify the prospect out\", \"To understand the prospect's pain and goals\", \"To build rapport only\"],\r\n            c: 2,\r\n            e: \"Discovery is about uncovering 'Pain' and 'Goals'. Features should only be discussed as solutions to specific pains found in Discovery.\"\r\n        },\r\n        {\r\n            q: \"When conducting a demo, you should...\",\r\n            o: [\"Show every single feature\", \"Focus only on the features that solve the prospect's identified pain\", \"Let the prospect drive the screen\", \"Save the pricing for the very end\"],\r\n            c: 1,\r\n            e: \"Feature-dumping kills deals. Only show what solves the specific problems you identified during discovery.\"\r\n        },\r\n        {\r\n            q: \"What is the optimal length for a cold email subject line?\",\r\n            o: [\"1-3 words\", \"10+ words\", \"Full sentence\", \"No subject line\"],\r\n            c: 0,\r\n            e: \"Data shows that short, vague subject lines (e.g., 'Quick question', 'Thoughts?') yield higher open rates than long, descriptive ones.\"\r\n        },\r\n        {\r\n            q: \"A 'Champion' in a deal is someone who...\",\r\n            o: [\"Signs the contract\", \"Blocks your access\", \"Sells on your behalf internally\", \"Ignores your emails\"],\r\n            c: 2,\r\n            e: \"A Champion is your internal advocate who sells your solution when you aren't in the room. They have power and influence.\"\r\n        },\r\n        {\r\n            q: \"If a prospect goes dark after a proposal, effective 'break-up' emails rely on...\",\r\n            o: [\"Guilt\", \"Anger\", \"Loss Aversion / Negative Reverse Selling\", \"Desperation\"],\r\n            c: 2,\r\n            e: \"Negative Reverse Selling (e.g., 'Have you given up on this project?') triggers loss aversion and often gets a response.\"\r\n        },\r\n        {\r\n            q: \"What is the difference between specific and implied needs?\",\r\n            o: [\"They are the same\", \"Implied is a statement of dissatisfaction; Specific is a statement of desire for a solution\", \"Implied is stronger\", \"Specific needs don't matter\"],\r\n            c: 1,\r\n            e: \"SPIN Selling teaches that 'Implied needs' (I have a headache) must be developed into 'Specific needs' (I need aspirin) before pitching.\"\r\n        },\r\n        {\r\n            q: \"The 'Upfront Contract' technique is primarily used to...\",\r\n            o: [\"Force a sale\", \"Set clear expectations for the meeting's agenda and outcome\", \"Trick the prospect\", \"Sign a legal document\"],\r\n            c: 1,\r\n            e: \"Sandler's Upfront Contract ensures both parties agree on the purpose, time, and possible outcomes (Yes, No, Next Step) of a meeting.\"\r\n        }\r\n    ];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        // Randomly select, but try to cycle through them\r\n        const template = questionTemplates[Math.floor(Math.random() * questionTemplates.length)];\r\n\r\n        questions.push({\r\n            id: uuidv4(),\r\n            question: template.q,\r\n            options: template.o,\r\n            correctOptionIndex: template.c,\r\n            explanation: template.e\r\n        });\r\n    }\r\n\r\n    return questions;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\ai\\gemini.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\ai\\rag-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[716,719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[716,719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '@/lib/firebase/config';\r\nimport { getAI, getGenerativeModel, VertexAIBackend, AI, GenerativeModel } from 'firebase/ai';\r\n\r\n/**\r\n * Enterprise-grade Managed RAG Service (Dec 2025)\r\n * Interfaces with Gemini File Search (Vertex AI) to ground AI responses in personal docs.\r\n */\r\n\r\nexport interface RAGResult {\r\n    content: string;\r\n    source: string;\r\n    score: number;\r\n}\r\n\r\nexport class RAGService {\r\n    private static ai: AI = getAI(app, { backend: new VertexAIBackend('us-central1') });\r\n    private static model: GenerativeModel = getGenerativeModel(this.ai, {\r\n        model: 'gemini-2.0-flash',\r\n        // Enable File Search tool for Managed RAG\r\n        tools: [{ fileSearch: {} } as any]\r\n    });\r\n\r\n    /**\r\n     * Query the managed document corpus for relevant context.\r\n     * In a production environment, this would search across indexed Playbooks/Pdfs.\r\n     */\r\n    static async queryContext(query: string): Promise<string> {\r\n        try {\r\n            // Dec 2025 Best Practice: Managed RAG handles retrieval + generation in one pass \r\n            // by referencing the tool-enabled model.\r\n            const prompt = `Use the available file search tool to find information related to: \"${query}\". \r\n            If no specific documents match, provide general best practices based on our sales enablement philosophy.`;\r\n\r\n            const result = await this.model.generateContent(prompt);\r\n            return result.response.text();\r\n        } catch (error) {\r\n            console.error('RAG Query Failed:', error);\r\n            return 'Fallback: Unable to retrieve personalized document context.';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Note: In a live environment, you would use the Vertex AI Admin SDK or \r\n     * a dedicated API endpoint to upload and index files into the 'Search Store'.\r\n     * This service facilitates the retrieval side.\r\n     */\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\analytics\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsEvent' is defined but never used.","line":6,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Lightweight Analytics Service for tracking user events.\r\n * This can be easily connected to PostHog, Amplitude, or Google Analytics.\r\n */\r\n\r\ntype AnalyticsEvent = {\r\n    name: string;\r\n    properties?: Record<string, unknown>;\r\n    userId?: string;\r\n};\r\n\r\nclass AnalyticsService {\r\n    private isEnabled: boolean = typeof window !== 'undefined';\r\n\r\n    public track(name: string, properties?: Record<string, unknown>) {\r\n        if (!this.isEnabled) return;\r\n\r\n        // In a real app, this would send to PostHog/Amplitude\r\n        console.log(`[Analytics] Event: ${name}`, properties);\r\n\r\n        // You can integrate a real provider here:\r\n        // posthog.capture(name, properties);\r\n    }\r\n\r\n    public identify(userId: string, properties?: Record<string, unknown>) {\r\n        if (!this.isEnabled) return;\r\n        console.log(`[Analytics] Identify User: ${userId}`, properties);\r\n        // posthog.identify(userId, properties);\r\n    }\r\n\r\n    public pageView(url: string) {\r\n        if (!this.isEnabled) return;\r\n        console.log(`[Analytics] Page View: ${url}`);\r\n        // posthog.capture('$pageview', { $current_url: url });\r\n    }\r\n}\r\n\r\nexport const analytics = new AnalyticsService();\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\api\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\api\\hooks\\useActivities.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\api\\hooks\\useLeads.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\auth\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\auth\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\firebase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\firebase\\ai-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lead' is defined but never used.","line":234,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":234,"endColumn":82}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from './config';\r\nimport { getAI, getGenerativeModel, VertexAIBackend, AI, GenerativeModel } from 'firebase/ai';\r\nimport { Lead, Resource, Activity } from '@/types';\r\nimport { MOCK_RESOURCES } from '@/lib/mock-data/resources';\r\nimport { RAGService } from '@/lib/ai/rag-service';\r\n\r\n// Initialize Firebase AI with Vertex AI backend (Gemini)\r\n// Note: User has Vertex AI Gemini API enabled in Firebase Console\r\nlet ai: AI | null = null;\r\nlet model: GenerativeModel | null = null;\r\nlet aiInitError: Error | null = null;\r\n\r\ntry {\r\n    // Using VertexAIBackend with us-central1 region (default)\r\n    ai = getAI(app, { backend: new VertexAIBackend('us-central1') });\r\n    model = getGenerativeModel(ai, { model: 'gemini-2.0-flash' });\r\n} catch (e) {\r\n    aiInitError = e instanceof Error ? e : new Error('Firebase AI initialization failed');\r\n    console.warn('Firebase AI not initialized - will use fallback templates:', aiInitError.message);\r\n}\r\n\r\n// Helper to check AI status - use this in UI to show meaningful errors\r\nexport function getAIStatus(): { available: boolean; error?: string } {\r\n    if (model) return { available: true };\r\n    return {\r\n        available: false,\r\n        error: aiInitError?.message || 'Firebase AI Logic is not enabled. Please enable it in the Firebase Console  AI Logic  Get Started.'\r\n    };\r\n}\r\n\r\n// Email generation types\r\nexport type EmailType = 'introduction' | 'follow-up' | 'discovery' | 'proposal' | 'closing' | 'onboarding' | 're-engagement';\r\nexport type EnhancementAction = 'shorter' | 'professional' | 'friendly' | 'urgency' | 'social-proof';\r\n\r\n// Map lead status to email type\r\nfunction getEmailTypeFromStatus(status: string): EmailType {\r\n    const mapping: Record<string, EmailType> = {\r\n        'New': 'introduction',\r\n        'Contacted': 'follow-up',\r\n        'Qualified': 'discovery',\r\n        'Proposal': 'proposal',\r\n        'Negotiation': 'closing',\r\n        'Closed': 'onboarding',\r\n        'Lost': 're-engagement'\r\n    };\r\n    return mapping[status] || 'introduction';\r\n}\r\n\r\n// Build company context from enablement resources\r\nfunction buildCompanyContext(resources: Resource[]): string {\r\n    const sections: string[] = [];\r\n\r\n    // Group resources by category\r\n    const playbooks = resources.filter(r => r.category === 'Playbook');\r\n    const templates = resources.filter(r => r.category === 'Templates');\r\n    const competitive = resources.filter(r => r.category === 'Competitive');\r\n    const prospecting = resources.filter(r => r.category === 'Prospecting');\r\n\r\n    if (playbooks.length > 0) {\r\n        sections.push(`\r\nSALES PLAYBOOKS & SCRIPTS:\r\n${playbooks.map(p => `- ${p.title}: ${p.description}`).join('\\n')}\r\n`);\r\n    }\r\n\r\n    if (templates.length > 0) {\r\n        sections.push(`\r\nEMAIL TEMPLATES & PATTERNS:\r\n${templates.map(t => `- ${t.title}: ${t.description}`).join('\\n')}\r\n`);\r\n    }\r\n\r\n    if (competitive.length > 0) {\r\n        sections.push(`\r\nCOMPETITIVE POSITIONING:\r\n${competitive.map(c => `- ${c.title}: ${c.description}`).join('\\n')}\r\n`);\r\n    }\r\n\r\n    if (prospecting.length > 0) {\r\n        sections.push(`\r\nPROSPECTING & VALUE PROPOSITIONS:\r\n${prospecting.map(p => `- ${p.title}: ${p.description}`).join('\\n')}\r\n`);\r\n    }\r\n\r\n    return sections.join('\\n');\r\n}\r\n\r\n// Build lead context from lead data\r\nfunction buildLeadContext(lead: Lead): string {\r\n    const daysSinceContact = lead.lastContact\r\n        ? Math.floor((Date.now() - lead.lastContact) / (1000 * 60 * 60 * 24))\r\n        : null;\r\n\r\n    return `\r\nLEAD INFORMATION:\r\n- Company: ${lead.companyName}\r\n- Contact: ${lead.contactName}\r\n- Email: ${lead.email}\r\n- Phone: ${lead.phone || 'Not provided'}\r\n- Industry: ${lead.industry || 'Not specified'}\r\n- Deal Value: $${lead.value?.toLocaleString() || 'Unknown'}\r\n- Current Status: ${lead.status}\r\n- Probability: ${lead.probability || 'Not set'}%\r\n- Notes: ${lead.notes || 'None'}\r\n- Tags: ${lead.tags?.join(', ') || 'None'}\r\n- Next Step: ${lead.nextStep || 'Not defined'}\r\n${daysSinceContact !== null ? `- Days Since Last Contact: ${daysSinceContact}` : ''}\r\n`;\r\n}\r\n\r\n// Analyze lead intelligence (health, sentiment, closing signal)\r\nexport async function analyzeLeadIntelligence(\r\n    lead: Lead,\r\n    activities: Activity[]\r\n): Promise<{ score: number; signal: string; justification: string }> {\r\n\r\n    if (!model) {\r\n        return {\r\n            score: 50,\r\n            signal: 'Neutral',\r\n            justification: 'AI intelligence currently offline. Scoring based on activity metadata.'\r\n        };\r\n    }\r\n\r\n    const leadContext = buildLeadContext(lead);\r\n    const activityContext = activities.length > 0\r\n        ? `RECENT ACTIVITIES:\\n${activities.slice(0, 5).map(a => `- ${a.type} (${a.outcome}): ${a.notes || 'No notes'}`).join('\\n')}`\r\n        : 'No recent activity recorded.';\r\n\r\n    const prompt = `You are a high-level Sales Intelligence AI. Analyze this lead and their recent activity to determine their \"Closing Signal\" strength.\r\n    \r\n    ${leadContext}\r\n    \r\n    ${activityContext}\r\n    \r\n    TASK:\r\n    - Assess the sentiment of the last few interactions.\r\n    - Identify potential \"Closing Signals\" (budget confirmed, decision maker involved, timeline stated).\r\n    - Identify \"Deal Blockers\" (no response, technical hurdle, competitor mentioned).\r\n    \r\n    OUTPUT FORMAT:\r\n    Return ONLY a JSON object:\r\n    {\"score\": number (0-100), \"signal\": \"Strong Buy\" | \"Interested\" | \"Neutral\" | \"At Risk\" | \"Stalled\", \"justification\": \"One sentence summarizing why.\"}`;\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        const text = result.response.text();\r\n        const cleanText = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n        const parsed = JSON.parse(cleanText);\r\n\r\n        return {\r\n            score: typeof parsed.score === 'number' ? parsed.score : 50,\r\n            signal: parsed.signal || 'Neutral',\r\n            justification: parsed.justification || 'Analysis complete.'\r\n        };\r\n    } catch (error) {\r\n        console.error('AI Intelligence analysis failed:', error);\r\n        return { score: 50, signal: 'Neutral', justification: 'Critical analysis failure. Verify lead data.' };\r\n    }\r\n}\r\n\r\n// Generate email draft using Gemini with full context\r\nexport async function generateEmail(\r\n    lead: Lead,\r\n    senderName: string,\r\n    customPrompt?: string\r\n): Promise<{ subject: string; body: string }> {\r\n\r\n    if (!model) {\r\n        // Fallback if AI not available\r\n        return {\r\n            subject: `Following up - ${lead.companyName}`,\r\n            body: getDefaultEmailBody(lead, senderName)\r\n        };\r\n    }\r\n\r\n    const emailType = getEmailTypeFromStatus(lead.status);\r\n\r\n    // 2025 Best Practice: Augment mock resources with Real RAG context from personal playbooks\r\n    const ragContext = await RAGService.queryContext(`Sales strategy for ${lead.companyName} in ${lead.industry} at stage ${lead.status}`);\r\n\r\n    const companyContext = buildCompanyContext(MOCK_RESOURCES) + `\\n\\nPROPRIETARY STRATEGY (RAG):\\n${ragContext}`;\r\n    const leadContext = buildLeadContext(lead);\r\n\r\n    const prompt = `You are an expert sales email writer for our company. Use the following context about our company and sales approach to craft highly personalized emails.\r\n\r\n${companyContext}\r\n\r\n${leadContext}\r\n\r\nEMAIL TYPE: ${emailType}\r\nSENDER NAME: ${senderName}\r\n\r\n${customPrompt ? `USER REQUEST: ${customPrompt}` : ''}\r\n\r\nINSTRUCTIONS:\r\n- Write a ${emailType} sales email personalized to this specific lead\r\n- Use insights from our sales playbooks and scripts\r\n- Reference our value propositions naturally\r\n- Keep it concise (under 150 words)\r\n- Include a clear, specific call-to-action\r\n- Match the tone to the lead's industry\r\n- If there are notes about the lead, reference them subtly\r\n\r\nOUTPUT FORMAT:\r\nReturn ONLY a JSON object with exactly this structure (no markdown, no code blocks):\r\n{\"subject\": \"Your subject line here\", \"body\": \"Your email body here\"}`;\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        const text = result.response.text();\r\n\r\n        // Parse the JSON response\r\n        const cleanText = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n        const parsed = JSON.parse(cleanText);\r\n\r\n        return {\r\n            subject: parsed.subject || `Following up - ${lead.companyName}`,\r\n            body: parsed.body || getDefaultEmailBody(lead, senderName)\r\n        };\r\n    } catch (error) {\r\n        console.error('AI email generation failed:', error);\r\n        // Fallback to template\r\n        return {\r\n            subject: `Following up - ${lead.companyName}`,\r\n            body: getDefaultEmailBody(lead, senderName)\r\n        };\r\n    }\r\n}\r\n\r\n// Enhance existing email with AI (with company context)\r\nexport async function enhanceEmail(email: string, action: EnhancementAction, lead?: Lead): Promise<string> {\r\n    if (!model) return email;\r\n\r\n    const companyContext = buildCompanyContext(MOCK_RESOURCES);\r\n\r\n    const prompts: Record<EnhancementAction, string> = {\r\n        'shorter': `Make this email more concise while keeping the key message. Reduce to under 100 words:\\n\\n${email}`,\r\n        'professional': `Rewrite this email in a more formal, professional business tone. Maintain our company's positioning:\\n\\n${companyContext}\\n\\nEmail to rewrite:\\n${email}`,\r\n        'friendly': `Rewrite this email in a warmer, more friendly and conversational tone while staying professional:\\n\\n${email}`,\r\n        'urgency': `Add subtle urgency to this email (time-sensitive language, limited availability) without being pushy. Keep it authentic:\\n\\n${email}`,\r\n        'social-proof': `Add social proof elements to this email naturally. Reference success with similar companies, results, or credibility signals. Use our competitive positioning:\\n\\n${companyContext}\\n\\nEmail to enhance:\\n${email}`\r\n    };\r\n\r\n    try {\r\n        const result = await model.generateContent(prompts[action] + '\\n\\nReturn ONLY the rewritten email text, nothing else.');\r\n        return result.response.text().trim();\r\n    } catch (error) {\r\n        console.error('AI enhancement failed:', error);\r\n        return email; // Return original on error\r\n    }\r\n}\r\n\r\n// Generate email with custom user prompt\r\nexport async function generateCustomEmail(\r\n    lead: Lead,\r\n    senderName: string,\r\n    userPrompt: string\r\n): Promise<{ subject: string; body: string }> {\r\n    return generateEmail(lead, senderName, userPrompt);\r\n}\r\n\r\n// Default fallback email body\r\nfunction getDefaultEmailBody(lead: Lead, senderName: string): string {\r\n    const firstName = lead.contactName.split(' ')[0];\r\n    const templates: Record<string, string> = {\r\n        'New': `Hi ${firstName},\r\n\r\nI hope this email finds you well! I wanted to reach out and introduce myself  I'm excited about the opportunity to connect with ${lead.companyName}.\r\n\r\nI understand that companies in the ${lead.industry || 'technology'} space are constantly looking for ways to improve efficiency and drive growth. I'd love to learn more about your current challenges and share how we might be able to help.\r\n\r\nWould you be open to a brief 15-minute call this week?\r\n\r\nBest regards,\r\n${senderName}`,\r\n\r\n        'Contacted': `Hi ${firstName},\r\n\r\nGreat connecting with you! I wanted to follow up on our conversation and share some thoughts on how we can support ${lead.companyName}.\r\n\r\nBased on what you shared, I think there are real opportunities for us to create value together. Would you have time for a quick call to dive deeper?\r\n\r\nLooking forward to hearing from you!\r\n\r\nBest,\r\n${senderName}`,\r\n\r\n        'Qualified': `Hi ${firstName},\r\n\r\nThank you for taking the time to discuss your needs. I'm genuinely excited about the potential partnership between our companies.\r\n\r\nI'm confident we can help ${lead.companyName} achieve the outcomes you're looking for. I'll prepare a customized proposal addressing your specific requirements.\r\n\r\nWhat does your calendar look like this week?\r\n\r\nBest,\r\n${senderName}`,\r\n\r\n        'Negotiation': `Hi ${firstName},\r\n\r\nThank you for your feedback on the proposal. I appreciate your transparency about the considerations.\r\n\r\nI've spoken with our team, and we may have some flexibility. Let's find a solution that works for everyone.\r\n\r\nCan we schedule a call to finalize the details?\r\n\r\nBest regards,\r\n${senderName}`\r\n    };\r\n\r\n    return templates[lead.status] || templates['New'];\r\n}\r\n\r\nexport { getEmailTypeFromStatus };\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\firebase\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\firebase\\resources.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'where' is defined but never used.","line":3,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { db, storage } from '@/lib/firebase/config';\r\nimport { collection, addDoc, query, where, getDocs, deleteDoc, doc, orderBy } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\r\nimport { Resource } from '@/types';\r\n\r\nexport const ResourcesService = {\r\n    // Upload a new resource\r\n    async uploadResource(userId: string, file: File, category: string, description: string, visibility: 'private' | 'company' = 'private'): Promise<string> {\r\n        // 1. Upload to Storage\r\n        const path = visibility === 'company' ? `resources/${Date.now()}_${file.name}` : `users/${userId}/resources/${Date.now()}_${file.name}`;\r\n        const fileRef = ref(storage, path);\r\n        const snapshot = await uploadBytes(fileRef, file);\r\n        const downloadUrl = await getDownloadURL(snapshot.ref);\r\n\r\n        // 2. Save Metadata to Firestore\r\n        const resourcesRef = visibility === 'company'\r\n            ? collection(db, 'resources')\r\n            : collection(db, 'users', userId, 'resources');\r\n        const now = new Date().toISOString();\r\n\r\n        const docRef = await addDoc(resourcesRef, {\r\n            title: file.name,\r\n            description: description || 'No description provided',\r\n            type: determineFileType(file.type),\r\n            category: category,\r\n            url: downloadUrl,\r\n            storagePath: snapshot.ref.fullPath,\r\n            createdAt: now,\r\n            updatedAt: now,\r\n            createdBy: userId,\r\n            visibility\r\n        });\r\n\r\n        return docRef.id;\r\n    },\r\n\r\n    // Get company-wide resources\r\n    async getCompanyResources(): Promise<Resource[]> {\r\n        const resourcesRef = collection(db, 'resources'); // Top-level collection\r\n        const q = query(resourcesRef, orderBy('createdAt', 'desc'));\r\n\r\n        const snapshot = await getDocs(q);\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        })) as Resource[];\r\n    },\r\n\r\n    // Get all resources for a user\r\n    async getUserResources(userId: string): Promise<Resource[]> {\r\n        const resourcesRef = collection(db, 'users', userId, 'resources');\r\n        const q = query(resourcesRef, orderBy('createdAt', 'desc'));\r\n\r\n        const snapshot = await getDocs(q);\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data()\r\n        })) as Resource[];\r\n    },\r\n\r\n    // Delete a resource\r\n    async deleteResource(userId: string, resourceId: string, storagePath: string): Promise<void> {\r\n        // 1. Delete from Firestore\r\n        await deleteDoc(doc(db, 'users', userId, 'resources', resourceId));\r\n\r\n        // 2. Delete from Storage\r\n        if (storagePath) {\r\n            const fileRef = ref(storage, storagePath);\r\n            await deleteObject(fileRef).catch(e => console.warn('File already deleted or not found', e));\r\n        }\r\n    }\r\n};\r\n\r\nfunction determineFileType(mimeType: string): 'video' | 'deck' | 'sheet' | 'document' | 'link' {\r\n    if (mimeType.includes('pdf')) return 'document';\r\n    if (mimeType.includes('video')) return 'video';\r\n    if (mimeType.includes('spreadsheet') || mimeType.includes('excel') || mimeType.includes('csv')) return 'sheet';\r\n    if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return 'deck';\r\n    return 'document'; // default\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\firebase\\services.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\gmail\\email-analyzer.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { app } from '@/lib/firebase/config';\r\nimport { getAI, getGenerativeModel, VertexAIBackend, GenerativeModel } from 'firebase/ai';\r\nimport { EmailRecord, EmailAnalysis } from './gmail-service';\r\n\r\nexport type { EmailAnalysis };\r\n\r\n// Initialize Firebase AI with Vertex AI backend\r\nlet model: GenerativeModel | null = null;\r\ntry {\r\n    const ai = getAI(app, { backend: new VertexAIBackend('us-central1') });\r\n    model = getGenerativeModel(ai, { model: 'gemini-2.0-flash' });\r\n} catch (e) {\r\n    console.warn('Firebase AI not initialized for email analysis');\r\n}\r\n\r\n/**\r\n * Analyze an email using AI to extract sentiment, intent, and insights\r\n */\r\nexport async function analyzeEmail(email: EmailRecord): Promise<EmailAnalysis> {\r\n    if (!model) {\r\n        return getDefaultAnalysis();\r\n    }\r\n\r\n    const prompt = `Analyze this sales email and extract key insights.\r\n\r\nEMAIL:\r\nDirection: ${email.direction === 'sent' ? 'Sent by sales rep' : 'Received from prospect'}\r\nSubject: ${email.subject}\r\nContent: ${email.body.substring(0, 2000)}\r\n\r\nAnalyze and return a JSON object with exactly this structure (no markdown, no code blocks):\r\n{\r\n    \"sentiment\": \"positive\" | \"neutral\" | \"negative\",\r\n    \"intent\": \"interested\" | \"objection\" | \"question\" | \"scheduling\" | \"not_interested\" | \"unknown\",\r\n    \"summary\": \"One sentence summary of the email\",\r\n    \"keyPoints\": [\"Key point 1\", \"Key point 2\"],\r\n    \"suggestedNextStep\": \"What the sales rep should do next\",\r\n    \"dealSignals\": [\"Any buying signals or red flags detected\"]\r\n}\r\n\r\nRules:\r\n- sentiment: Is the overall tone positive, neutral, or negative?\r\n- intent: What is the prospect trying to communicate?\r\n  - interested: Showing genuine interest\r\n  - objection: Raising concerns or pushback\r\n  - question: Asking for more information\r\n  - scheduling: Trying to set up a meeting\r\n  - not_interested: Declining or unsubscribing\r\n  - unknown: Can't determine intent\r\n- dealSignals: Look for phrases like \"budget approved\", \"decision maker\", \"timeline\", \"competitor mentioned\", etc.`;\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        const text = result.response.text();\r\n        const cleanText = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n        return JSON.parse(cleanText);\r\n    } catch (error) {\r\n        console.error('Email analysis failed:', error);\r\n        return getDefaultAnalysis();\r\n    }\r\n}\r\n\r\n/**\r\n * Analyze a full email thread to get conversation summary\r\n */\r\nexport async function analyzeEmailThread(emails: EmailRecord[]): Promise<{\r\n    threadSummary: string;\r\n    overallSentiment: 'positive' | 'neutral' | 'negative';\r\n    engagementLevel: 'high' | 'medium' | 'low';\r\n    nextBestAction: string;\r\n    dealHealth: 'healthy' | 'at-risk' | 'stalled';\r\n}> {\r\n    if (!model || emails.length === 0) {\r\n        return {\r\n            threadSummary: 'No emails to analyze',\r\n            overallSentiment: 'neutral',\r\n            engagementLevel: 'low',\r\n            nextBestAction: 'Send initial outreach',\r\n            dealHealth: 'stalled',\r\n        };\r\n    }\r\n\r\n    const threadContent = emails\r\n        .sort((a, b) => a.timestamp - b.timestamp)\r\n        .map(e => `[${e.direction.toUpperCase()}] ${e.subject}\\n${e.body.substring(0, 500)}`)\r\n        .join('\\n\\n---\\n\\n');\r\n\r\n    const prompt = `Analyze this email thread between a sales rep and prospect.\r\n\r\nEMAIL THREAD (${emails.length} emails):\r\n${threadContent.substring(0, 4000)}\r\n\r\nReturn a JSON object with exactly this structure:\r\n{\r\n    \"threadSummary\": \"2-3 sentence summary of the conversation\",\r\n    \"overallSentiment\": \"positive\" | \"neutral\" | \"negative\",\r\n    \"engagementLevel\": \"high\" | \"medium\" | \"low\",\r\n    \"nextBestAction\": \"Specific action the sales rep should take\",\r\n    \"dealHealth\": \"healthy\" | \"at-risk\" | \"stalled\"\r\n}\r\n\r\nConsider:\r\n- Response times (quick = engaged)\r\n- Number of back-and-forth exchanges\r\n- Questions being asked\r\n- Positive vs negative language`;\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        const text = result.response.text();\r\n        const cleanText = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n        return JSON.parse(cleanText);\r\n    } catch (error) {\r\n        console.error('Thread analysis failed:', error);\r\n        return {\r\n            threadSummary: 'Analysis unavailable',\r\n            overallSentiment: 'neutral',\r\n            engagementLevel: 'medium',\r\n            nextBestAction: 'Follow up with the prospect',\r\n            dealHealth: 'at-risk',\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a reply suggestion based on the email thread\r\n */\r\nexport async function suggestReply(emails: EmailRecord[], customContext?: string): Promise<{\r\n    subject: string;\r\n    body: string;\r\n}> {\r\n    if (!model) {\r\n        return {\r\n            subject: 'Re: ' + (emails[0]?.subject || 'Follow up'),\r\n            body: 'Thanks for your email. I wanted to follow up...',\r\n        };\r\n    }\r\n\r\n    const lastEmail = emails[0];\r\n    const threadContext = emails\r\n        .slice(0, 5)\r\n        .map(e => `[${e.direction}] ${e.body.substring(0, 300)}`)\r\n        .join('\\n\\n');\r\n\r\n    const prompt = `Generate a reply to this email thread.\r\n\r\nRECENT EMAILS:\r\n${threadContext}\r\n\r\n${customContext ? `ADDITIONAL CONTEXT: ${customContext}` : ''}\r\n\r\nGenerate a professional, helpful reply. Return JSON:\r\n{\r\n    \"subject\": \"Re: Original Subject\",\r\n    \"body\": \"The email body\"\r\n}\r\n\r\nKeep the reply:\r\n- Concise (under 150 words)\r\n- Professional but friendly\r\n- Include a clear next step or call to action`;\r\n\r\n    try {\r\n        const result = await model.generateContent(prompt);\r\n        const text = result.response.text();\r\n        const cleanText = text.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\r\n        return JSON.parse(cleanText);\r\n    } catch (error) {\r\n        console.error('Reply suggestion failed:', error);\r\n        return {\r\n            subject: 'Re: ' + (lastEmail?.subject || 'Follow up'),\r\n            body: 'Thanks for your message. I wanted to follow up on our conversation.',\r\n        };\r\n    }\r\n}\r\n\r\nfunction getDefaultAnalysis(): EmailAnalysis {\r\n    return {\r\n        sentiment: 'neutral',\r\n        intent: 'unknown',\r\n        summary: 'Analysis unavailable',\r\n        keyPoints: [],\r\n        suggestedNextStep: 'Review email manually',\r\n        dealSignals: [],\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\gmail\\gmail-auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\gmail\\gmail-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addDoc' is defined but never used.","line":3,"column":77,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":83},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toEmail' is assigned a value but never used.","line":213,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GmailMessage, GmailThread, GmailTokens, refreshAccessToken } from './gmail-auth';\r\nimport { db } from '@/lib/firebase/config';\r\nimport { doc, getDoc, setDoc, updateDoc, collection, query, where, getDocs, addDoc } from 'firebase/firestore';\r\n\r\n// ============================================\r\n// TOKEN MANAGEMENT\r\n// ============================================\r\n\r\nexport async function getValidAccessToken(userId: string): Promise<string | null> {\r\n    const tokenDoc = await getDoc(doc(db, 'users', userId, 'integrations', 'gmail'));\r\n\r\n    if (!tokenDoc.exists()) {\r\n        return null;\r\n    }\r\n\r\n    const tokens = tokenDoc.data() as GmailTokens;\r\n\r\n    // Check if token is expired (with 5 min buffer)\r\n    if (tokens.expiresAt < Date.now() + 300000) {\r\n        try {\r\n            const refreshed = await refreshAccessToken(tokens.refreshToken);\r\n            await updateDoc(doc(db, 'users', userId, 'integrations', 'gmail'), {\r\n                accessToken: refreshed.accessToken,\r\n                expiresAt: refreshed.expiresAt,\r\n            });\r\n            return refreshed.accessToken;\r\n        } catch (error) {\r\n            console.error('Failed to refresh token:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return tokens.accessToken;\r\n}\r\n\r\nexport async function saveGmailTokens(userId: string, tokens: GmailTokens): Promise<void> {\r\n    await setDoc(doc(db, 'users', userId, 'integrations', 'gmail'), tokens);\r\n}\r\n\r\nexport async function isGmailConnected(userId: string): Promise<boolean> {\r\n    const tokenDoc = await getDoc(doc(db, 'users', userId, 'integrations', 'gmail'));\r\n    return tokenDoc.exists();\r\n}\r\n\r\n// ============================================\r\n// EMAIL FETCHING\r\n// ============================================\r\n\r\nexport async function fetchEmails(\r\n    accessToken: string,\r\n    query: string,\r\n    maxResults: number = 50\r\n): Promise<GmailMessage[]> {\r\n    const params = new URLSearchParams({\r\n        q: query,\r\n        maxResults: maxResults.toString(),\r\n    });\r\n\r\n    const response = await fetch(\r\n        `https://gmail.googleapis.com/gmail/v1/users/me/messages?${params}`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n\r\n    if (!response.ok) {\r\n        throw new Error('Failed to fetch messages');\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (!data.messages) return [];\r\n\r\n    // Fetch full message details for each\r\n    const messages = await Promise.all(\r\n        data.messages.slice(0, maxResults).map(async (msg: { id: string }) => {\r\n            const msgResponse = await fetch(\r\n                `https://gmail.googleapis.com/gmail/v1/users/me/messages/${msg.id}`,\r\n                { headers: { Authorization: `Bearer ${accessToken}` } }\r\n            );\r\n            return msgResponse.json();\r\n        })\r\n    );\r\n\r\n    return messages;\r\n}\r\n\r\nexport async function fetchThread(accessToken: string, threadId: string): Promise<GmailThread> {\r\n    const response = await fetch(\r\n        `https://gmail.googleapis.com/gmail/v1/users/me/threads/${threadId}`,\r\n        { headers: { Authorization: `Bearer ${accessToken}` } }\r\n    );\r\n\r\n    if (!response.ok) {\r\n        throw new Error('Failed to fetch thread');\r\n    }\r\n\r\n    return response.json();\r\n}\r\n\r\n// ============================================\r\n// EMAIL PARSING\r\n// ============================================\r\n\r\nexport function parseEmailHeaders(headers: { name: string; value: string }[]): {\r\n    from: string;\r\n    to: string;\r\n    subject: string;\r\n    date: string;\r\n} {\r\n    const getHeader = (name: string) =>\r\n        headers.find(h => h.name.toLowerCase() === name.toLowerCase())?.value || '';\r\n\r\n    return {\r\n        from: getHeader('From'),\r\n        to: getHeader('To'),\r\n        subject: getHeader('Subject'),\r\n        date: getHeader('Date'),\r\n    };\r\n}\r\n\r\nexport function extractEmailAddress(headerValue: string): string {\r\n    const match = headerValue.match(/<(.+?)>/) || headerValue.match(/([^\\s<>]+@[^\\s<>]+)/);\r\n    return match ? match[1] : headerValue;\r\n}\r\n\r\nexport function decodeBase64(data: string): string {\r\n    try {\r\n        // Gmail uses URL-safe base64 - convert to standard base64\r\n        const base64 = data.replace(/-/g, '+').replace(/_/g, '/');\r\n        // Add padding if needed\r\n        const padded = base64 + '='.repeat((4 - base64.length % 4) % 4);\r\n        // Use atob for browser compatibility (works in both Node 16+ and browsers)\r\n        const decoded = atob(padded);\r\n        // Handle UTF-8 encoding\r\n        return decodeURIComponent(\r\n            decoded.split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join('')\r\n        );\r\n    } catch (error) {\r\n        console.warn('Base64 decoding failed:', error);\r\n        return '';\r\n    }\r\n}\r\n\r\nexport function getEmailBody(message: GmailMessage): string {\r\n    // Try to get body from payload directly\r\n    if (message.payload.body?.data) {\r\n        return decodeBase64(message.payload.body.data);\r\n    }\r\n\r\n    // Try to get from parts (multipart email)\r\n    if (message.payload.parts) {\r\n        const textPart = message.payload.parts.find(p => p.mimeType === 'text/plain');\r\n        if (textPart?.body?.data) {\r\n            return decodeBase64(textPart.body.data);\r\n        }\r\n        const htmlPart = message.payload.parts.find(p => p.mimeType === 'text/html');\r\n        if (htmlPart?.body?.data) {\r\n            // Strip HTML tags for plain text\r\n            return decodeBase64(htmlPart.body.data).replace(/<[^>]*>/g, '');\r\n        }\r\n    }\r\n\r\n    return message.snippet || '';\r\n}\r\n\r\n// ============================================\r\n// SYNC EMAILS FOR LEADS\r\n// ============================================\r\n\r\nexport interface EmailRecord {\r\n    id: string;\r\n    threadId: string;\r\n    leadId: string;\r\n    direction: 'sent' | 'received';\r\n    from: string;\r\n    to: string;\r\n    subject: string;\r\n    snippet: string;\r\n    body: string;\r\n    timestamp: number;\r\n    aiAnalysis?: EmailAnalysis;\r\n}\r\n\r\nexport interface EmailAnalysis {\r\n    sentiment: 'positive' | 'neutral' | 'negative';\r\n    intent: 'interested' | 'objection' | 'question' | 'scheduling' | 'not_interested' | 'unknown';\r\n    summary: string;\r\n    keyPoints: string[];\r\n    suggestedNextStep: string;\r\n    dealSignals: string[];\r\n}\r\n\r\nexport async function syncEmailsForLead(\r\n    userId: string,\r\n    leadEmail: string,\r\n    leadId: string\r\n): Promise<EmailRecord[]> {\r\n    const accessToken = await getValidAccessToken(userId);\r\n    if (!accessToken) {\r\n        throw new Error('Gmail not connected');\r\n    }\r\n\r\n    // Search for emails to/from this lead\r\n    const query = `from:${leadEmail} OR to:${leadEmail}`;\r\n    const messages = await fetchEmails(accessToken, query, 30);\r\n\r\n    const userDoc = await getDoc(doc(db, 'users', userId, 'integrations', 'gmail'));\r\n    const userEmail = userDoc.exists() ? userDoc.data().email : '';\r\n\r\n    const emailRecords: EmailRecord[] = [];\r\n\r\n    for (const message of messages) {\r\n        const headers = parseEmailHeaders(message.payload.headers);\r\n        const fromEmail = extractEmailAddress(headers.from);\r\n        const toEmail = extractEmailAddress(headers.to);\r\n\r\n        const direction = fromEmail.toLowerCase() === userEmail.toLowerCase() ? 'sent' : 'received';\r\n\r\n        const record: EmailRecord = {\r\n            id: message.id,\r\n            threadId: message.threadId,\r\n            leadId,\r\n            direction,\r\n            from: headers.from,\r\n            to: headers.to,\r\n            subject: headers.subject,\r\n            snippet: message.snippet,\r\n            body: getEmailBody(message),\r\n            timestamp: parseInt(message.internalDate),\r\n        };\r\n\r\n        emailRecords.push(record);\r\n\r\n        // Save to Firebase\r\n        await setDoc(\r\n            doc(db, 'users', userId, 'emailMessages', message.id),\r\n            record\r\n        );\r\n    }\r\n\r\n    return emailRecords;\r\n}\r\n\r\n// ============================================\r\n// GET EMAILS FOR A LEAD\r\n// ============================================\r\n\r\nexport async function getLeadEmails(userId: string, leadId: string): Promise<EmailRecord[]> {\r\n    const emailsRef = collection(db, 'users', userId, 'emailMessages');\r\n    const q = query(emailsRef, where('leadId', '==', leadId));\r\n    const snapshot = await getDocs(q);\r\n\r\n    const emails = snapshot.docs.map(doc => doc.data() as EmailRecord);\r\n    return emails.sort((a, b) => b.timestamp - a.timestamp);\r\n}\r\n\r\n// ============================================\r\n// SEND EMAIL VIA GMAIL API\r\n// ============================================\r\n\r\nexport async function sendEmail(\r\n    userId: string,\r\n    to: string,\r\n    subject: string,\r\n    body: string,\r\n    leadId: string\r\n): Promise<string> {\r\n    const accessToken = await getValidAccessToken(userId);\r\n    if (!accessToken) {\r\n        throw new Error('Gmail not connected');\r\n    }\r\n\r\n    // Get user's email for From header\r\n    const userDoc = await getDoc(doc(db, 'users', userId, 'integrations', 'gmail'));\r\n    const userEmail = userDoc.exists() ? userDoc.data().email : '';\r\n\r\n    // Create RFC 2822 formatted email with From header\r\n    const email = [\r\n        `From: ${userEmail}`,\r\n        `To: ${to}`,\r\n        `Subject: ${subject}`,\r\n        'Content-Type: text/plain; charset=utf-8',\r\n        'MIME-Version: 1.0',\r\n        '',\r\n        body\r\n    ].join('\\r\\n');\r\n\r\n    // Base64 encode (URL-safe) - using btoa for browser compatibility\r\n    const encodedEmail = btoa(unescape(encodeURIComponent(email)))\r\n        .replace(/\\+/g, '-')\r\n        .replace(/\\//g, '_')\r\n        .replace(/=+$/, '');\r\n\r\n    const response = await fetch(\r\n        'https://gmail.googleapis.com/gmail/v1/users/me/messages/send',\r\n        {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: `Bearer ${accessToken}`,\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({ raw: encodedEmail }),\r\n        }\r\n    );\r\n\r\n    if (!response.ok) {\r\n        const error = await response.text();\r\n        throw new Error(`Failed to send email: ${error}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    // Log the sent email (reuse userEmail from earlier)\r\n\r\n    await setDoc(doc(db, 'users', userId, 'emailMessages', result.id), {\r\n        id: result.id,\r\n        threadId: result.threadId,\r\n        leadId,\r\n        direction: 'sent',\r\n        from: userEmail,\r\n        to,\r\n        subject,\r\n        snippet: body.substring(0, 200),\r\n        body,\r\n        timestamp: Date.now(),\r\n    });\r\n\r\n    return result.id;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\mock-data\\courses.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\mock-data\\leads.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\mock-data\\resources.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\stripe\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\stripe\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\twilio\\call-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\twilio\\lookup-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\twilio\\sms-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\twilio\\twilio-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\twilio\\twilio-service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'callbackUrl' is defined but never used.","line":73,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TWILIO_CONFIG, isTwilioConfigured, SMSMessage, SMSResult, CallResult, TwilioCredentials, getTwilioClient } from './twilio-config';\r\nimport { db } from '@/lib/firebase/config';\r\nimport { doc, getDoc, setDoc, addDoc, collection } from 'firebase/firestore';\r\n\r\n// Twilio Client is now managed via twilio-config.ts helper\r\n\r\n// ============================================\r\n// SMS FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Send an SMS message via Twilio\r\n */\r\nexport async function sendSMS(message: SMSMessage): Promise<SMSResult> {\r\n    try {\r\n        const client = await getTwilioClient();\r\n\r\n        const result = await client.messages.create({\r\n            body: message.body,\r\n            from: TWILIO_CONFIG.phoneNumber,\r\n            to: message.to,\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            messageSid: result.sid,\r\n        };\r\n    } catch (error: unknown) {\r\n        console.error('Twilio SMS error:', error);\r\n        return {\r\n            success: false,\r\n            error: error instanceof Error ? error.message : 'Failed to send SMS',\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Send SMS and log activity to Firebase\r\n */\r\nexport async function sendSMSWithLogging(\r\n    userId: string,\r\n    leadId: string,\r\n    to: string,\r\n    body: string\r\n): Promise<SMSResult> {\r\n    const result = await sendSMS({ to, body, leadId });\r\n\r\n    // Log activity regardless of success\r\n    await addDoc(collection(db, 'users', userId, 'activities'), {\r\n        type: 'social', // Using 'social' as SMS type since it's close\r\n        outcome: result.success ? 'connected' : 'no_answer',\r\n        timestamp: Date.now(),\r\n        repId: userId,\r\n        leadId,\r\n        notes: result.success\r\n            ? `SMS sent: ${body.substring(0, 100)}...`\r\n            : `SMS failed: ${result.error}`,\r\n        channel: 'sms',\r\n        messageSid: result.messageSid,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\n// ============================================\r\n// CALL FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Initiate an outbound call via Twilio\r\n * Note: This creates a call but requires TwiML for call handling\r\n */\r\nexport async function initiateCall(to: string, callbackUrl?: string): Promise<CallResult> {\r\n    try {\r\n        const client = await getTwilioClient();\r\n\r\n        // Basic call - will need TwiML App or URL for full functionality\r\n        const result = await client.calls.create({\r\n            to,\r\n            from: TWILIO_CONFIG.phoneNumber,\r\n            // For now, just play a message - in production, you'd use a webhook\r\n            twiml: '<Response><Say>Connecting your call...</Say><Dial>' + to + '</Dial></Response>',\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            callSid: result.sid,\r\n        };\r\n    } catch (error: unknown) {\r\n        console.error('Twilio call error:', error);\r\n        return {\r\n            success: false,\r\n            error: error instanceof Error ? error.message : 'Failed to initiate call',\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Initiate call and log activity to Firebase\r\n */\r\nexport async function initiateCallWithLogging(\r\n    userId: string,\r\n    leadId: string,\r\n    to: string\r\n): Promise<CallResult> {\r\n    const result = await initiateCall(to);\r\n\r\n    // Log activity\r\n    await addDoc(collection(db, 'users', userId, 'activities'), {\r\n        type: 'call',\r\n        outcome: result.success ? 'connected' : 'no_answer',\r\n        timestamp: Date.now(),\r\n        repId: userId,\r\n        leadId,\r\n        notes: result.success\r\n            ? `Call initiated to ${to}`\r\n            : `Call failed: ${result.error}`,\r\n        callSid: result.callSid,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\n// ============================================\r\n// CREDENTIAL MANAGEMENT\r\n// ============================================\r\n\r\n/**\r\n * Save Twilio credentials for a user (for per-user Twilio accounts)\r\n */\r\nexport async function saveTwilioCredentials(\r\n    userId: string,\r\n    credentials: Omit<TwilioCredentials, 'connected' | 'connectedAt'>\r\n): Promise<void> {\r\n    await setDoc(doc(db, 'users', userId, 'integrations', 'twilio'), {\r\n        ...credentials,\r\n        connected: true,\r\n        connectedAt: Date.now(),\r\n    });\r\n}\r\n\r\n/**\r\n * Get Twilio connection status for a user\r\n */\r\nexport async function getTwilioStatus(userId: string): Promise<TwilioCredentials | null> {\r\n    // First check if user has their own Twilio credentials\r\n    const userDoc = await getDoc(doc(db, 'users', userId, 'integrations', 'twilio'));\r\n\r\n    if (userDoc.exists()) {\r\n        return userDoc.data() as TwilioCredentials;\r\n    }\r\n\r\n    // Fall back to checking environment configuration\r\n    if (isTwilioConfigured()) {\r\n        return {\r\n            accountSid: TWILIO_CONFIG.accountSid,\r\n            authToken: '***hidden***',\r\n            phoneNumber: TWILIO_CONFIG.phoneNumber,\r\n            connected: true,\r\n        };\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\n/**\r\n * Check if Twilio is connected for a user\r\n */\r\nexport async function isTwilioConnected(userId: string): Promise<boolean> {\r\n    const status = await getTwilioStatus(userId);\r\n    return status?.connected ?? false;\r\n}\r\n\r\n/**\r\n * Disconnect Twilio for a user\r\n */\r\nexport async function disconnectTwilio(userId: string): Promise<void> {\r\n    await setDoc(doc(db, 'users', userId, 'integrations', 'twilio'), {\r\n        connected: false,\r\n        disconnectedAt: Date.now(),\r\n    });\r\n}\r\n\r\n// ============================================\r\n// UTILITY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Format phone number to E.164 format\r\n */\r\nexport function formatPhoneE164(phone: string): string {\r\n    // Remove all non-digit characters\r\n    const digits = phone.replace(/\\D/g, '');\r\n\r\n    // Add +1 if US number without country code\r\n    if (digits.length === 10) {\r\n        return `+1${digits}`;\r\n    }\r\n\r\n    // Already has country code\r\n    if (digits.length === 11 && digits.startsWith('1')) {\r\n        return `+${digits}`;\r\n    }\r\n\r\n    // Return with + prefix\r\n    return `+${digits}`;\r\n}\r\n\r\n/**\r\n * Validate phone number format\r\n */\r\nexport function isValidPhoneNumber(phone: string): boolean {\r\n    const digits = phone.replace(/\\D/g, '');\r\n    return digits.length >= 10 && digits.length <= 15;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\utils\\forecasting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\utils\\formatters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\lib\\utils\\scoring.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\types\\ai.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\src\\types\\learning.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"c:\\Users\\tryst\\Downloads\\leadTrackingApp\\vitest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
